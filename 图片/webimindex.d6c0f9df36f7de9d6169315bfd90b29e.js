/* resmerge themes/mall/default/styles/default/js/jquery.fancybox-1.3.4.pack.js start */
(function(a){var n,t,u,e,B,m,C,h,y,z,r=0,d={},p=[],q=0,c={},k=[],E=null,v=new Image,G=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,R=/[^\.]\.(swf)\s*$/i,H,I=1,x=0,w="",s,g,l=!1,A=a.extend(a("<div/>")[0],{prop:0}),J=a.browser.msie&&7>a.browser.version&&!window.XMLHttpRequest,K=function(){t.hide();v.onerror=v.onload=null;E&&E.abort();n.empty()},L=function(){!1===d.onError(p,r,d)?(t.hide(),l=!1):(d.titleShow=!1,d.width="auto",d.height="auto",n.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>'),
D())},F=function(){var b=p[r],f,c,e,g,k,h;K();d=a.extend({},a.fn.fancybox.defaults,"undefined"==typeof a(b).data("fancybox")?d:a(b).data("fancybox"));h=d.onStart(p,r,d);if(!1===h)l=!1;else{"object"==typeof h&&(d=a.extend(d,h));e=d.title||(b.nodeName?a(b).attr("title"):b.title)||"";b.nodeName&&!d.orig&&(d.orig=a(b).children("img:first").length?a(b).children("img:first"):a(b));""===e&&d.orig&&d.titleFromAlt&&(e=d.orig.attr("alt"));f=d.href||(b.nodeName?a(b).attr("href"):b.href)||null;if(/^(?:javascript)/i.test(f)||
"#"==f)f=null;d.type?(c=d.type,f||(f=d.content)):d.content?c="html":f&&(c=f.match(G)?"image":f.match(R)?"swf":a(b).hasClass("iframe")?"iframe":0===f.indexOf("#")?"inline":"ajax");if(c)switch("inline"==c&&(b=f.substr(f.indexOf("#")),c=0<a(b).length?"inline":"ajax"),d.type=c,d.href=f,d.title=e,d.autoDimensions&&("html"==d.type||"inline"==d.type||"ajax"==d.type?(d.width="auto",d.height="auto"):d.autoDimensions=!1),d.modal&&(d.overlayShow=!0,d.hideOnOverlayClick=!1,d.hideOnContentClick=!1,d.enableEscapeButton=
!1,d.showCloseButton=!1),d.padding=parseInt(d.padding,10),d.margin=parseInt(d.margin,10),n.css("padding",d.padding+d.margin),a(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){a(this).replaceWith(m.children())}),c){case "html":n.html(d.content);D();break;case "inline":if(!0===a(b).parent().is("#fancybox-content")){l=!1;break}a('<div class="fancybox-inline-tmp" />').hide().insertBefore(a(b)).bind("fancybox-cleanup",function(){a(this).replaceWith(m.children())}).bind("fancybox-cancel",
function(){a(this).replaceWith(n.children())});a(b).appendTo(n);D();break;case "image":l=!1;a.fancybox.showActivity();v=new Image;v.onerror=function(){L()};v.onload=function(){l=!0;v.onerror=v.onload=null;d.width=v.width;d.height=v.height;a("<img />").attr({id:"fancybox-img",src:v.src,alt:d.title}).appendTo(n);M()};v.src=f;break;case "swf":d.scrolling="no";g='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+d.width+'" height="'+d.height+'"><param name="movie" value="'+f+'"></param>';
k="";a.each(d.swf,function(b,a){g+='<param name="'+b+'" value="'+a+'"></param>';k+=" "+b+'="'+a+'"'});g+='<embed src="'+f+'" type="application/x-shockwave-flash" width="'+d.width+'" height="'+d.height+'"'+k+"></embed></object>";n.html(g);D();break;case "ajax":l=!1;a.fancybox.showActivity();d.ajax.win=d.ajax.success;E=a.ajax(a.extend({},d.ajax,{url:f,data:d.ajax.data||{},error:function(b){0<b.status&&L()},success:function(b,a,c){if(200==("object"==typeof c?c:E).status){if("function"==typeof d.ajax.win){h=
d.ajax.win(f,b,a,c);if(!1===h){t.hide();return}if("string"==typeof h||"object"==typeof h)b=h}n.html(b);D()}}}));break;case "iframe":M()}else L()}},D=function(){var b=d.width,c=d.height,b=-1<b.toString().indexOf("%")?parseInt((a(window).width()-2*d.margin)*parseFloat(b)/100,10)+"px":"auto"==b?"auto":b+"px",c=-1<c.toString().indexOf("%")?parseInt((a(window).height()-2*d.margin)*parseFloat(c)/100,10)+"px":"auto"==c?"auto":c+"px";n.wrapInner('<div style="width:'+b+";height:"+c+";overflow: "+("auto"==
d.scrolling?"auto":"yes"==d.scrolling?"scroll":"hidden")+';position:relative;"></div>');d.width=n.width();d.height=n.height();M()},M=function(){var b,f;t.hide();if(e.is(":visible")&&!1===c.onCleanup(k,q,c))a.event.trigger("fancybox-cancel"),l=!1;else{l=!0;a(m.add(u)).unbind();a(window).unbind("resize.fb scroll.fb");a(document).unbind("keydown.fb");e.is(":visible")&&"outside"!==c.titlePosition&&e.css("height",e.height());k=p;q=r;c=d;c.overlayShow?(u.css({"background-color":c.overlayColor,opacity:c.overlayOpacity,
cursor:c.hideOnOverlayClick?"pointer":"auto",height:a(document).height()}),u.is(":visible")||(J&&a("select:not(#fancybox-tmp select)").filter(function(){return"hidden"!==this.style.visibility}).css({visibility:"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"}),u.show())):u.hide();g=S();w=c.title||"";x=0;h.empty().removeAttr("style").removeClass();if(!1!==c.titleShow&&(w=b=a.isFunction(c.titleFormat)?c.titleFormat(w,k,q,c):w&&w.length?"float"==c.titlePosition?'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+
w+'</td><td id="fancybox-title-float-right"></td></tr></table>':'<div id="fancybox-title-'+c.titlePosition+'">'+w+"</div>":!1)&&""!==w)switch(h.addClass("fancybox-title-"+c.titlePosition).html(w).appendTo("body").show(),c.titlePosition){case "inside":h.css({width:g.width-2*c.padding,marginLeft:c.padding,marginRight:c.padding});x=h.outerHeight(!0);h.appendTo(B);g.height+=x;break;case "over":h.css({marginLeft:c.padding,width:g.width-2*c.padding,bottom:c.padding}).appendTo(B);break;case "float":h.css("left",
-1*parseInt((h.width()-g.width-40)/2,10)).appendTo(e);break;default:h.css({width:g.width-2*c.padding,paddingLeft:c.padding,paddingRight:c.padding}).appendTo(e)}h.hide();e.is(":visible")?(a(C.add(y).add(z)).hide(),b=e.position(),s={top:b.top,left:b.left,width:e.width(),height:e.height()},f=s.width==g.width&&s.height==g.height,m.fadeTo(c.changeFade,.3,function(){var b=function(){m.html(n.contents()).fadeTo(c.changeFade,1,N)};a.event.trigger("fancybox-change");m.empty().removeAttr("filter").css({"border-width":c.padding,
width:g.width-2*c.padding,height:d.autoDimensions?"auto":g.height-x-2*c.padding});f?b():(A.prop=0,a(A).animate({prop:1},{duration:c.changeSpeed,easing:c.easingChange,step:O,complete:b}))})):(e.removeAttr("style"),m.css("border-width",c.padding),"elastic"==c.transitionIn?(s=Q(),m.html(n.contents()),e.show(),c.opacity&&(g.opacity=0),A.prop=0,a(A).animate({prop:1},{duration:c.speedIn,easing:c.easingIn,step:O,complete:N})):("inside"==c.titlePosition&&0<x&&h.show(),m.css({width:g.width-2*c.padding,height:d.autoDimensions?
"auto":g.height-x-2*c.padding}).html(n.contents()),e.css(g).fadeIn("none"==c.transitionIn?0:c.speedIn,N)))}},T=function(){(c.enableEscapeButton||c.enableKeyboardNav)&&a(document).bind("keydown.fb",function(b){27==b.keyCode&&c.enableEscapeButton?(b.preventDefault(),a.fancybox.close()):37!=b.keyCode&&39!=b.keyCode||!c.enableKeyboardNav||"INPUT"===b.target.tagName||"TEXTAREA"===b.target.tagName||"SELECT"===b.target.tagName||(b.preventDefault(),a.fancybox[37==b.keyCode?"prev":"next"]())});c.showNavArrows?
((c.cyclic&&1<k.length||0!==q)&&y.show(),(c.cyclic&&1<k.length||q!=k.length-1)&&z.show()):(y.hide(),z.hide())},N=function(){a.support.opacity||(m.get(0).style.removeAttribute("filter"),e.get(0).style.removeAttribute("filter"));d.autoDimensions&&m.css("height","auto");e.css("height","auto");w&&w.length&&h.show();c.showCloseButton&&C.show();T();c.hideOnContentClick&&m.bind("click",a.fancybox.close);c.hideOnOverlayClick&&u.bind("click",a.fancybox.close);a(window).bind("resize.fb",a.fancybox.resize);
c.centerOnScroll&&a(window).bind("scroll.fb",a.fancybox.center);"iframe"==c.type&&a('<iframe id="fancybox-frame" name="fancybox-frame'+(new Date).getTime()+'" frameborder="0" hspace="0" '+(a.browser.msie?'allowtransparency="true""':"")+' scrolling="'+d.scrolling+'" src="'+c.href+'"></iframe>').appendTo(m);e.show();l=!1;a.fancybox.center();c.onComplete(k,q,c);var b,f;k.length-1>q&&(b=k[q+1].href,"undefined"!==typeof b&&b.match(G)&&(f=new Image,f.src=b));0<q&&(b=k[q-1].href,"undefined"!==typeof b&&
b.match(G)&&(f=new Image,f.src=b))},O=function(b){var a={width:parseInt(s.width+(g.width-s.width)*b,10),height:parseInt(s.height+(g.height-s.height)*b,10),top:parseInt(s.top+(g.top-s.top)*b,10),left:parseInt(s.left+(g.left-s.left)*b,10)};"undefined"!==typeof g.opacity&&(a.opacity=.5>b?.5:b);e.css(a);m.css({width:a.width-2*c.padding,height:a.height-x*b-2*c.padding})},P=function(){return[a(window).width()-2*c.margin,a(window).height()-2*c.margin,a(document).scrollLeft()+c.margin,a(document).scrollTop()+
c.margin]},S=function(){var b=P(),a={},e=c.autoScale,g=2*c.padding;a.width=-1<c.width.toString().indexOf("%")?parseInt(b[0]*parseFloat(c.width)/100,10):c.width+g;a.height=-1<c.height.toString().indexOf("%")?parseInt(b[1]*parseFloat(c.height)/100,10):c.height+g;e&&(a.width>b[0]||a.height>b[1])&&("image"==d.type||"swf"==d.type?(e=c.width/c.height,a.width>b[0]&&(a.width=b[0],a.height=parseInt((a.width-g)/e+g,10)),a.height>b[1]&&(a.height=b[1],a.width=parseInt((a.height-g)*e+g,10))):(a.width=Math.min(a.width,
b[0]),a.height=Math.min(a.height,b[1])));a.top=parseInt(Math.max(b[3]-20,b[3]+.5*(b[1]-a.height-40)),10);a.left=parseInt(Math.max(b[2]-20,b[2]+.5*(b[0]-a.width-40)),10);return a},Q=function(){var b=d.orig?a(d.orig):!1,f={};b&&b.length?(f=b.offset(),f.top+=parseInt(b.css("paddingTop"),10)||0,f.left+=parseInt(b.css("paddingLeft"),10)||0,f.top+=parseInt(b.css("border-top-width"),10)||0,f.left+=parseInt(b.css("border-left-width"),10)||0,f.width=b.width(),f.height=b.height(),f={width:f.width+2*c.padding,
height:f.height+2*c.padding,top:f.top-c.padding-20,left:f.left-c.padding-20}):(b=P(),f={width:2*c.padding,height:2*c.padding,top:parseInt(b[3]+.5*b[1],10),left:parseInt(b[2]+.5*b[0],10)});return f},U=function(){t.is(":visible")?(a("div",t).css("top",-40*I+"px"),I=(I+1)%12):clearInterval(H)};a.fn.fancybox=function(b){if(!a(this).length)return this;a(this).data("fancybox",a.extend({},b,a.metadata?a(this).metadata():{})).unbind("click.fb").bind("click.fb",function(b){b.preventDefault();l||(l=!0,a(this).blur(),
p=[],r=0,(b=a(this).attr("rel")||"")&&""!=b&&"nofollow"!==b?(p=a("a[rel="+b+"], area[rel="+b+"]"),r=p.index(this)):p.push(this),F())});return this};a.fancybox=function(b,c){var d;if(!l){l=!0;d="undefined"!==typeof c?c:{};p=[];r=parseInt(d.index,10)||0;if(a.isArray(b)){for(var e=0,g=b.length;e<g;e++)"object"==typeof b[e]?a(b[e]).data("fancybox",a.extend({},d,b[e])):b[e]=a({}).data("fancybox",a.extend({content:b[e]},d));p=jQuery.merge(p,b)}else"object"==typeof b?a(b).data("fancybox",a.extend({},d,b)):
b=a({}).data("fancybox",a.extend({content:b},d)),p.push(b);if(r>p.length||0>r)r=0;F()}};a.fancybox.showActivity=function(){clearInterval(H);t.show();H=setInterval(U,66)};a.fancybox.hideActivity=function(){t.hide()};a.fancybox.next=function(){return a.fancybox.pos(q+1)};a.fancybox.prev=function(){return a.fancybox.pos(q-1)};a.fancybox.pos=function(a){l||(a=parseInt(a),p=k,-1<a&&a<k.length?(r=a,F()):c.cyclic&&1<k.length&&(r=a>=k.length?0:k.length-1,F()))};a.fancybox.cancel=function(){l||(l=!0,a.event.trigger("fancybox-cancel"),
K(),d.onCancel(p,r,d),l=!1)};a.fancybox.close=function(){function b(){u.fadeOut("fast");h.empty().hide();e.hide();a.event.trigger("fancybox-cleanup");m.empty();c.onClosed(k,q,c);k=d=[];q=r=0;c=d={};l=!1}if(!l&&!e.is(":hidden"))if(l=!0,c&&!1===c.onCleanup(k,q,c))l=!1;else if(K(),a(C.add(y).add(z)).hide(),a(m.add(u)).unbind(),a(window).unbind("resize.fb scroll.fb"),a(document).unbind("keydown.fb"),m.find("iframe").attr("src",J&&/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank"),
"inside"!==c.titlePosition&&h.empty(),e.stop(),"elastic"==c.transitionOut){s=Q();var f=e.position();g={top:f.top,left:f.left,width:e.width(),height:e.height()};c.opacity&&(g.opacity=1);h.empty().hide();A.prop=1;a(A).animate({prop:0},{duration:c.speedOut,easing:c.easingOut,step:O,complete:b})}else e.fadeOut("none"==c.transitionOut?0:c.speedOut,b)};a.fancybox.resize=function(){u.is(":visible")&&u.css("height",a(document).height());a.fancybox.center(!0)};a.fancybox.center=function(a){var d,g;l||(g=!0===
a?1:0,d=P(),!g&&(e.width()>d[0]||e.height()>d[1])||e.stop().animate({top:parseInt(Math.max(d[3]-20,d[3]+.5*(d[1]-m.height()-40)-c.padding)),left:parseInt(Math.max(d[2]-20,d[2]+.5*(d[0]-m.width()-40)-c.padding))},"number"==typeof a?a:200))};a.fancybox.init=function(){a("#fancybox-wrap").length||(a("body").append(n=a('<div id="fancybox-tmp"></div>'),t=a('<div id="fancybox-loading"><div></div></div>'),u=a('<div id="fancybox-overlay"></div>'),e=a('<div id="fancybox-wrap"></div>')),B=a('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(e),
B.append(m=a('<div id="fancybox-content"></div>'),C=a('<a id="fancybox-close"></a>'),h=a('<div id="fancybox-title"></div>'),y=a('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),z=a('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>')),C.click(a.fancybox.close),t.click(a.fancybox.cancel),y.click(function(b){b.preventDefault();a.fancybox.prev()}),z.click(function(b){b.preventDefault();a.fancybox.next()}),
a.fn.mousewheel&&e.bind("mousewheel.fb",function(b,c){if(l)b.preventDefault();else if(0==a(b.target).get(0).clientHeight||a(b.target).get(0).scrollHeight===a(b.target).get(0).clientHeight)b.preventDefault(),a.fancybox[0<c?"prev":"next"]()}),a.support.opacity||e.addClass("fancybox-ie"),J&&(t.addClass("fancybox-ie6"),e.addClass("fancybox-ie6"),a('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank")+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(B)))};
a.fn.fancybox.defaults={padding:10,margin:40,opacity:!1,modal:!1,cyclic:!1,scrolling:"auto",width:560,height:340,autoScale:!0,autoDimensions:!0,centerOnScroll:!1,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:!0,hideOnContentClick:!1,overlayShow:!0,overlayOpacity:.7,overlayColor:"#777",titleShow:!0,titlePosition:"float",titleFormat:null,titleFromAlt:!1,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:!0,
showNavArrows:!0,enableEscapeButton:!0,enableKeyboardNav:!0,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};a(document).ready(function(){a.fancybox.init()})})(jQuery);

/* resmerge themes/mall/default/styles/default/js/jquery.fancybox-1.3.4.pack.js end */
/* resmerge includes/libraries/javascript/orginjs/foot_mark_orgin.js start */
$.fn.extend({wait:function(a,b){return this.queue(b||"fx",function(){var b=$(this);setTimeout(function(){b.dequeue()},a||1E3)})}});
$(function(){$(".e_t_wrap li a").attr("href","javascript:void(0);");$(".e_t_b_title s").bind("click",function(){1<=$(".t_footmark,.t_goods,.t_news:visible").length&&($(".t_footmark,.t_goods,.t_news:visible").hide(),$(".e_t_wrap li").removeClass("setall"),$(".e_t_wrap li").removeClass("setthis"),1==$("#icn-news").find("em").length&&$("#icn-news").show())});$("#history_store_bar").click(function(){re_button_statu($(this));$("#view_store_con").show();ajax_request(SITE_URL+"/index.php?app=foot_mark&act=footmark_list&m=store",
"history_store_list","html",function(){dir_marquee("all_store","s_left","s_right","history_store_list","view_store_con")})});$("#history_bar").click(function(){re_button_statu($(this));$("#history_list_con").show()});$("#collect_bar").click(function(){re_button_statu($(this));$("#collect_con_list").show();ajax_request(SITE_URL+"/index.php?app=my_favorite&type=goodsList&req=collection&ajax=1","collection_goods_part","html",function(){dir_marquee("collect_gsp","coe_left","coe_right","collection_goods_part",
"collect_con_list")});$("#collection_store_part").hide();btnchange($("#collection_gd"))});$("#you_like").click(function(){re_button_statu($(this));$("#like_con").show();ajax_request(SITE_URL+"/index.php?app=foot_mark&act=find_like","like_list","html")});$("#collection_gd").click(function(){btnchange($(this));$("#collection_store_part").hide();$("#collection_goods_part").show();dir_marquee("collect_gsp","coe_left","coe_right","collection_goods_part","collect_con_list")});$("li.e_toolbar_begin").click(function(){if(0<
$(".e_t_wrap li:hidden").length)$(this).unbind("mouseover").unbind("mouseout"),$(".e_toolbar_begin span").removeClass("recovetb").addClass("switch-mini-tip"),$(".switch-mini").remove(),$(this).css("background-position","-53px -165px"),$(".e_t_wrap li").each(function(){$(this).show()});else{var a=$(this);$(this).css("background-position","-72px -165px");$(this).addClass("hover");setTimeout(function(){a.removeClass("hover")},2E3);$(".e_t_wrap li").not($(this)).each(function(){$(this).hide()});$("#e_mark .e_t_wrap li").removeClass("setall");
$("#e_mark .e_t_wrap li").removeClass("setthis");$(".t_news,.t_footmark,.t_goods").each(function(){$(this).hide()});a.attr("title","");a.mouseover(function(){$(".e_toolbar_begin span").removeClass("switch-mini-tip").addClass("recovetb")}).mouseout(function(){$(".e_toolbar_begin span").removeClass("recovetb").addClass("switch-mini-tip")});$(".e_t_wrap").prepend($("<li class='switch-mini'></li>"))}});$("#collection_dp").click(function(){btnchange($(this));$("#collection_goods_part").hide();$("#collection_store_part").show();
ajax_request(SITE_URL+"/index.php?app=my_favorite&type=store&req=collection&ajax=1","collection_store_part","html",function(){dir_marquee("collect_gs","co_left","co_right","collection_store_part","collect_con_list")})});$("#history_list_con span.tabbtn").bind("click",function(){var a="."+$(this).attr("name").toString();$("#history_list_con span.tabbtn").removeClass("tabcur");$(this).addClass("tabcur");$(".all_vis,.td_vis,.one_vis,.two_vis,.three_vis,.week_vis").hide();dir_marquee($(this).attr("name").toString(),
"t_left","t_right","history_ft_list","history_list_con");$(a).show()});$("#view_store_con span.tabbtn").bind("click",function(){var a="."+$(this).attr("name").toString();$("#view_store_con span.tabbtn").removeClass("tabcur");$(this).addClass("tabcur");$(".all_store,.td_store,.one_store,.two_store,.three_store,.week_store").hide();dir_marquee($(this).attr("name").toString(),"s_left","s_right","history_store_list","view_store_con");$(a).show()});$(".t_my_news").click(function(){var a=$(this);a.siblings("li").removeClass("selected , cselected");
a.toggleClass("selected");a=SITE_URL+"/index.php?app=info&act=toolbar_list";null!=$.get_url_param("from")&&(a+="&from="+$.get_url_param("from"));ajax_request(a,"t_n_c_news","json");$(".t_footmark").is(":hidden")?$(".t_news").toggle().siblings(".t_footmark").css("display","none"):$(".t_news").toggle().siblings(".t_footmark").toggle();0<parseInt($("#icn-news em").text())&&$("#icn-news").toggle()});$(".i-mod-title-info").click(function(){0<parseInt($("#icn-news em").text())&&$("#icn-news").show()});
$(".tb-info-read").click(function(){$.ajax({url:SITE_URL+"/index.php?app=info&act=set_read",async:!1,dataType:"json",success:function(a){try{a.done?($(".t_my_news").removeClass("selected"),$(".t_n_c_news").html(""),$(".t_news").hide(),$(".t_my_news").unbind("click")):alert(a.msg)}catch(b){}}});return!1});1.4>parseFloat($.fn.jquery.substring(0,3))?$(".tb-info-de a").live("click",function(){toolbar_info_list($(this));return!1}):$(document).delegate(".tb-info-de a","click",function(){toolbar_info_list($(this));
return!1})});
function toolbar_info_list(a){var b=a.parents(".tb-info-de").attr("data-id");$.ajax({url:"index.php?app=info&act=set_read",type:"post",dataType:"json",data:{id:b},async:!1,success:function(c){try{if(c.done){var d=a.attr("href");a.parents("li").remove();var e=parseInt($("#icn-news em").text())-1;0>=e||isNaN(e)?($("#icn-news em").html(0),$("#icn-news").hide()):$("#icn-news em").html(e);if(0<$("#info-list-"+b).length){var f=$("#info-list-"+b);f.addClass("pass");0<f.find(".in-status").length&&f.find(".in-status").html("\u5df2\u8bfb")}window.open(d)}else alert(c.msg)}catch(g){alert("\u5f53\u524d\u7f51\u7edc\u7e41\u5fd9\uff0c\u8bf7\u91cd\u65b0\u5c1d\u8bd5")}}});
return!1}function loading_gif(a,b){$("#"+a).html("<img src='"+ldgif_url+"' border='0'/>"+b)}function ajax_request(a,b,c){var d=arguments;0<$("#"+b).attr("statu")?$("#"+b).show():(loading_gif(b,"\u6b63\u5728\u5904\u7406......"),$.ajax({type:"GET",url:a,async:!0,dataType:c,success:function(a){var f="",f="json"==c?a.retval:a;$("#"+b).html(f).attr("statu",1);slide_d(b);if(3<d.length&&"function"==typeof d[3])d[3]()}}))}
function slide_d(a){$("#"+a).find("ul").each(function(){5<$(this).children().length&&$(this).width(95*$(this).children().length+3)})}function dir_marquee(a,b,c,d,e){5>=$("."+a).children().length?$("#"+e).find(".prev,.next").remove():($("#"+e).find(".prev,.next").remove(),$("#"+e+" .tabbtn").eq($("#"+e+" .tabbtn").length-1).after("<a class='next' id='"+c+"'></a>").after("<a class='prev over' id='"+b+"'></a>"),scroll_marquee("#"+d,"."+a,"#"+c,"#"+b))}
function scroll_marquee(a,b,c,d){b="ul"+b;var e=$(a).find(b),f=parseInt(e.css("width"));$(c).click(function(){var a=parseInt(e.css("margin-left"));if(480>=f)return!1;if(85<f+2*a)e.animate({marginLeft:"-=430"},1E3),$(d).removeClass("over");else return $(this).addClass("over"),!1});$(d).click(function(){if(430<=0-parseInt(e.css("margin-left")))e.animate({marginLeft:"+=430"},1E3),$(c).removeClass("over");else return $(this).addClass("over"),!1})}
function scon(a){a=document.getElementById("mes-con-"+a).innerHTML;$("#t_n_c_news").html(a)}function re_button_statu(a){$(".tabtitle .tabbtn").each(function(){$(this).removeClass("tabcur")});$(".cont-bar").each(function(){$(this).hide()});a.addClass("tabcur")}
function clearFootMark(){$("#history_list_con").append("<div class='context'><p>\u4f60\u786e\u8ba4\u8981\u6e05\u7a7a\u6240\u6709\u6d4f\u89c8\u8fc7\u7684\u5546\u54c1\u8bb0\u5f55\u5417\uff1f</p><div><input class='ok' type='button' value='\u786e\u5b9a'><input class='cancel' type='button' value='\u53d6\u6d88'></div></div>");$(".context div input").bind("click",function(){"\u786e\u5b9a"==$(this).val()&&($("#history_list_con").append("<div class='del_statu'><img src='"+ldgif_url+"'/>\u6b63\u5728\u6e05\u7a7a\u3002\u3002\u3002</div>"),
$.ajax({type:"GET",url:SITE_URL+"/index.php?app=foot_mark&act=clearfootmark",async:!0,dataType:"json",success:function(a){$("#history_ft_list").html("<p style='padding:15px;text-align:center'>"+a.message+"</p>");$("#history_list_con .del_statu").remove();waring("\u4f60\u5df2\u7ecf\u6210\u529f\u6e05\u9664\u6240\u6709\u7684\u5546\u54c1\u6d4f\u89c8\u8bb0\u5f55!")}}));$("#history_list_con .context").remove()})}
function clearStoreMark(){$("#view_store_con").append("<div class='context'><p>\u4f60\u786e\u8ba4\u8981\u6e05\u7a7a\u6240\u6709\u6d4f\u89c8\u8fc7\u7684\u5e97\u94fa\u8bb0\u5f55\u5417\uff1f</p><div><input class='ok' type='button' value='\u786e\u5b9a'><input class='cancel' type='button' value='\u53d6\u6d88'></div></div>");$("#view_store_con .context div input").bind("click",function(){"\u786e\u5b9a"==$(this).val()&&($("#view_store_con").append("<div class='del_statu'><img src='"+ldgif_url+"'/>\u6b63\u5728\u6e05\u7a7a\u3002\u3002\u3002</div>"),
$.ajax({type:"GET",url:SITE_URL+"/index.php?app=foot_mark&act=clearstoremark",async:!0,dataType:"json",success:function(a){$("#history_store_list").html("<p style='padding:15px;text-align:center'>"+a.message+"</p>");$("#view_store_con .del_statu").remove();waring("\u4f60\u5df2\u7ecf\u6210\u529f\u6e05\u9664\u6240\u6709\u7684\u5e97\u94fa\u6d4f\u89c8\u8bb0\u5f55!")}}));$("#view_store_con .context").remove()})}
function addCartChecked(){var a=new ContrastList,b=[],c=[],a=new ContrastList;0==$('input[name="view"]:checked').length?waring("\u8bf7\u9009\u62e9\u5546\u54c1\uff01"):$('input[name="view"]:checked').each(function(){var a={};a.goods_id=$(this).val().split(",")[0];a.price=$(this).val().split(",")[1];a.image=$(this).val().split(",")[2];a.status=$(this).val().split(",")[3];a.divID=$(this).val().split(",")[4];a.showStatus=$(this).val().split(",")[5];c.push(a)});for(var d=0;d<c.length;d++){a.init(c[d].divID,
c[d].showStatus);var e=a.add(c[d].goods_id,c[d].price,c[d].image,c[d].status,c[d].divID,c[d].showStatus);scroll_marquee("#Roll",".goods_car_c","#goright","#goleft");0<e&&e&&b.push(e)}document.getElementById("e_mark")&&0<b.length&&waring("<b style='font-weight:bold;'>"+b.length+"</b>\u4ef6\u5546\u54c1\u5df2\u6210\u529f\u52a0\u5165\u6682\u5b58\u67b6\uff01");$('input[name="view"]:checked').each(function(){$(this).attr("checked",!1)})}
function btnchange(a){$("#collection_gd,#collection_dp").each(function(){$(this).removeClass("tabcur")});a.addClass("tabcur")}function waring(a){var b=$(".e_toolbar").height()+"px";$("<div id='waring' class='waring-mes'>"+a+"</div>").appendTo("body").floatdiv({"z-index":1E4,right:"55px",bottom:b}).fadeIn("slow").wait().fadeOut("slow",function(){$(this).parent().remove()})}var lisEvent={},isImDialogOpen=!1,isImOnlyFlash=!1,initFriendList=!0;lisEvent.TempHide=".t_footmark,.t_goods,.t_news,.webim-tool-con";
lisEvent.exe=function(a,b){void 0==gloab_store_id&&(gloab_store_id=0);1<=$("#e_mark "+b+":hidden").length?($(lisEvent.TempHide).hide(),$(b+":hidden").show()):($("#e_mark "+b+":visible").hide(),$("#im-con-display:visible").hide());isImDialogOpen=isImDialogOpen?!1:!0;".t_news"==b&&(0==$(b+":hidden").length?$("#icn-news").hide():1==$("#icn-news").find("em").length&&$("#icn-news").show())};
lisEvent.t_my_footmark=function(a){lisEvent.exe(a,".t_footmark");$(a).siblings("li").removeClass("selected , cselected");$(a).toggleClass("selected");ajax_request(SITE_URL+"/index.php?app=foot_mark&act=footmark_list","history_ft_list","html",function(){dir_marquee("all_vis","t_left","t_right","history_ft_list","history_list_con")})};lisEvent.t_my_car=function(a){lisEvent.exe(a,".t_goods")};var firstOpen=0;
lisEvent.open_web_im=function(a){if(1!=$.getCookie("known_im_tips")){var b=new Date;b.setTime(b.getTime()+31536E7);$.setCookie("known_im_tips","1",b.toGMTString(),"/");$("#e_mark .i-tips").remove()}initFriendList=!1;$(a).siblings("li").removeClass("selected");$(a).removeClass("newtx");obj_new_message.quick_show_close();1!=FROM_OP&&(lisEvent.exe(a,".webim-tool-con"),$(a).toggleClass("cselected"));var b=$(a).attr("to_id"),c=$(a).find("label").text();0<$(a).attr("to_id")&&startChat(b,c,"#on-line-statu_"+
b);FROM_OP=0;firstOpen=1;$(a).attr("to_id",0)};lisEvent.close_web_im=function(){$(".webim-tool-con").width("120px")};lisEvent.next_g=function(a){var b=parseInt($("#dir_page").val())+1;loading_gif("like_list","\u6b63\u5728\u5904\u7406");$.ajax({type:"GET",url:SITE_URL+"/index.php?app=foot_mark&act=find_like&page="+b+"&rand="+a,async:!0,dataType:"html",success:function(a){$("#like_list").html(a);$("#dir_page").val(b)}})};
function load_file(a,b,c){"css"==c?$("head").append($("<link />").attr({href:a,type:"text/css",rel:"stylesheet",id:b})):$("head").append($("<script>\x3c/script>").attr({src:a,type:"text/javascript",id:b}))}function getMousePos(a){return{x:a.clientX+document.documentElement.scrollLeft-document.documentElement.clientLeft,y:a.clientY+document.documentElement.scrollTop-document.documentElement.clientTop}}function getMubPos(){return{x:$("#e_mark").offset().left,y:$("#e_mark").offset().top}}
function moveToCart(a,b){var c=getMousePos(a),d=getMubPos();this.startX=c.x;this.startY=c.y;this.image=b;this.endX=0<d.x?d.x-2:$(window).width()-80;this.endY=d.y-95;this.creOBj=function(){return $("<div class='m-to'></div>").css({position:"absolute",width:"80px",height:"80px",left:this.startX,top:this.startY,zIndex:1E6}).html("<img src='"+this.image+"' width='80px' height='80px'/>").appendTo("body").animate({left:this.endX,top:this.endY},"slow","swing",function(){var a=$(this);setTimeout(function(){a.css("zIndex",
"999").animate({top:this.endY+80},"slow","swing",function(){a.remove();waring("\u5546\u54c1\u5df2\u7ecf\u6210\u529f\u52a0\u5165\u6682\u5b58\u67b6\uff01")})},800)})};(this.start=function(){this.creOBj()})()};

/* resmerge includes/libraries/javascript/orginjs/foot_mark_orgin.js end */
/* resmerge includes/libraries/javascript/json.js start */
this.JSON||(this.JSON={});
(function(){function m(a){return 10>a?"0"+a:a}function r(a){s.lastIndex=0;return s.test(a)?'"'+a.replace(s,function(a){var c=u[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function p(a,k){var c,d,h,q,g=e,f,b=k[a];b&&"object"===typeof b&&"function"===typeof b.toJSON&&(b=b.toJSON(a));"function"===typeof l&&(b=l.call(k,a,b));switch(typeof b){case "string":return r(b);case "number":return isFinite(b)?String(b):"null";case "boolean":case "null":return String(b);case "object":if(!b)return"null";
e+=n;f=[];if("[object Array]"===Object.prototype.toString.apply(b)){q=b.length;for(c=0;c<q;c+=1)f[c]=p(c,b)||"null";h=0===f.length?"[]":e?"[\n"+e+f.join(",\n"+e)+"\n"+g+"]":"["+f.join(",")+"]";e=g;return h}if(l&&"object"===typeof l)for(q=l.length,c=0;c<q;c+=1)d=l[c],"string"===typeof d&&(h=p(d,b))&&f.push(r(d)+(e?": ":":")+h);else for(d in b)Object.hasOwnProperty.call(b,d)&&(h=p(d,b))&&f.push(r(d)+(e?": ":":")+h);h=0===f.length?"{}":e?"{\n"+e+f.join(",\n"+e)+"\n"+g+"}":"{"+f.join(",")+"}";e=g;return h}}
"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+m(this.getUTCMonth()+1)+"-"+m(this.getUTCDate())+"T"+m(this.getUTCHours())+":"+m(this.getUTCMinutes())+":"+m(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var t=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s=
/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,e,n,u={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,k,c){var d;n=e="";if("number"===typeof c)for(d=0;d<c;d+=1)n+=" ";else"string"===typeof c&&(n=c);if((l=k)&&"function"!==typeof k&&("object"!==typeof k||"number"!==typeof k.length))throw Error("JSON.stringify");return p("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,e){function c(a,d){var g,f,b=a[d];if(b&&"object"===typeof b)for(g in b)Object.hasOwnProperty.call(b,g)&&(f=c(b,g),void 0!==f?b[g]=f:delete b[g]);return e.call(a,d,b)}var d;a=String(a);t.lastIndex=0;t.test(a)&&(a=a.replace(t,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof e?c({"":d},""):d;throw new SyntaxError("JSON.parse");})})();

/* resmerge includes/libraries/javascript/json.js end */
/* resmerge themes/mall/default/sidebar/js/e.sidebar.js start */
var sidebar=$("#J_sidebar"),sidebar_nav=$(".J_sidebar_btn"),sidebar_ctn=$(".J_sidebar_ctn"),sidebar_hide=$("#J_sidebar_hide");if("function"!==typeof getAjaxSiteUrl)var getAjaxSiteUrl=function(e){var l=window.location.origin,m=SITE_URL;l||(l="");0<l.indexOf("//www.eelly")&&(m="");if(""==e)return m;0!=e.indexOf("http")&&(e=m+e);return e};
var ajaxSiteUrl=getAjaxSiteUrl(""),elySidebar=function(){var e=$("#J_sidebar_ft"),l=$("#J_im_btn"),m=$("#J_sidebar_shop_btn"),q=$("#J_sidebar_history_btn"),r=$("#J_sidebar_favor_btn"),p=$("#J_sidebar_hide"),s=$(".J_sidebar_btn_def"),t="undefined"==typeof $.fn.prop,n={login:function(){return $.getCookie("uname")?!0:!1},show_login_box:function(){var a='<div id="J_login_mask" class="e-sidebar-mask e-sidebar-login none"><div class="mask-bg"></div><div class="mask-wrap"><a href="javascript:;" id="J_login_close" class="e-login-close"></a><iframe src="'+
SITE_URL+'/index.php?app=member&act=login&inajax=1" id="frame_login_register" frameborder="0" allowtransparency="true" style="width: 100%; height: 100%; border: 0px none;"></iframe></div></div>';$("body").append(a);var b=$("#J_login_mask");b.fadeIn();$("#J_login_close").click(function(){b.fadeOut(200,function(){b.remove()})})}},d={eAnimate:function(a){a.obj.stop().animate(a.attr,a.time,a.callback)},eAjaxJsonp:function(a){var b=a.fn;$.ajax({type:a.type||"GET",dataType:a.dataType||"jsonp",url:a.url,
success:function(a){b(a)}})},eTab:function(a){a.on("click",".J_tab_item",function(){var b=$(this),c=b.index(),g=a.find(".J_tab_ctn");b.addClass("active").siblings().removeClass("active");g.eq(c).fadeIn().siblings().fadeOut()})},addMaskHtml:function(a,b){b=b||"";var c=b.bg_color||"",g=b.mask_icon||"mask-icon",c=""!=c?"background-color:"+c:"";if(a.find(".J_sidebar_mask").length)return!1;a.append('<div id="J_load_mask" class="e-sidebar-mask J_sidebar_mask"><div style="'+c+'" class="mask-bg"></div><div class="'+
g+'"></div></div>')},delMaskHtml:function(a){a.find(".J_sidebar_mask").remove()},setScrollStyle:{loadJs:function(){var a=$(".J_sidebar_panel_b");try{d.setScrollStyle.set(a)}catch(b){$.ajax({url:STATIC_URL+"/includes/libraries/javascript/scrollbar/perfect-scrollbar.with-mousewheel.min.js",cache:!0,dataType:"script",success:function(){d.setScrollStyle.set(a)}})}},set:function(a){t?a.addClass("overflow-auto"):a.perfectScrollbar()}},hidePanel:function(a){this.eAnimate({obj:sidebar,attr:{right:"-280px"},
time:10,callback:function(){a.removeClass("active");sidebar_ctn.removeAttr("data-index").removeClass("active").hide(200);p.hide();a.find(".J_sidebar_box").show()}})},blankHide:function(a){$(document).bind("click",function(b){0==$(b.target).closest(a).length&&d.hidePanel(sidebar_nav);b.stopPropagation()})},showPanelAction:function(a,b){d.eAnimate({obj:sidebar,attr:{right:0},time:300,callback:function(){p.show()}});if(a.hasClass("active"))return d.hidePanel(a),!1;a.addClass("active").siblings("li").removeClass("active");
var c;sidebar_ctn.hasClass("active")?(c=$('.J_sidebar_ctn[data-index="pre"]'),d.eAnimate({obj:c,attr:{left:"280px"},time:200,callback:function(){sidebar_ctn.eq(b).attr("data-index","pre");sidebar_ctn.eq(b).fadeIn().addClass("active").siblings(".J_sidebar_ctn").removeAttr("data-index").css("left",0).hide().removeClass("active")}})):(sidebar_ctn.eq(b).attr("data-index","pre"),sidebar_ctn.eq(b).show().addClass("active"))},showPanel:function(a,b,c){a.bind("click",function(){var a=$(this),f=$("#J_sidebar_tab").find("li").index(a),
h=n.login();a.attr("data-lock")||a.attr("data-lock",0);if(b&&!h)return n.show_login_box(),!1;a.find(".J_sidebar_box").hide();a.siblings().find(".J_sidebar_box").show();$(".J_login_wrap").remove();d.getBtnAttr(a,c);d.showPanelAction(a,f);return!1})},loadPanelData:function(a){if(1==a.e_obj.attr("data-lock"))return!1;a.e_obj.attr("data-lock",1);var b=$("#J_sidebar_tab").find("li").index(a.e_obj),c=$(a.loading_wrap).eq(b),g=a.fn;0>=b&&(b=0);var f=$(a.data_wrap).eq(b);c.addClass("e-loading");this.eAjaxJsonp({url:a.url,
fn:function(a){a=a.retval;c.removeClass("e-loading");f.prepend(a);g&&g()}})},getBtnAttr:function(a,b){var c=a.attr("data-html");if(!c)return!1;d.loadPanelData({e_obj:a,data_wrap:".J_sidebar_data",loading_wrap:".J_sidebar_ctn",url:ajaxSiteUrl+"/index.php?app=navigation&act="+("sidebar_"+c),fn:b})},delShopItem:function(a){var b=a.url,c=a.type||"get",g=a.fn,f=a.wrap,h=this;f.on("click",".J_del_btn",function(){var a=$(this),k=a.parents("li"),d=a.attr("data-id");a.attr("data-lock")||a.attr("data-lock",
0);if(1==a.attr("data-lock"))return!1;a.attr("data-lock",1);"string"===typeof f&&(f=$(f));h.addMaskHtml(k,{bg_color:"#fff",mask_icon:"mask-icon1"});h.eAjaxJsonp({type:c,url:b+d,fn:function(b){h.delMaskHtml(k);h.eAnimate({obj:k,attr:{opacity:0,height:0},time:300,callback:function(){0>=k.siblings().length?k.parents(".J_list_wrap").remove():k.remove();0>=f.find("li").length&&f.find(".J_sidebar_panel_wrap").removeClass().addClass("e-sidebar-panel-none")}});g&&g.call(a)}})})},getCartNum:function(){$.getCookie("user_goods_nums");
var a=$("#J_sidebar_shop_num");this.eAjaxJsonp({url:ajaxSiteUrl+"/index.php?app=cart&act=get_nums",fn:function(b){a.text(b.retval)}});a.fadeIn(400).css("display","inline-block")},bindOtherBusiness:function(){function a(a){a=$(a);if(!a.attr("data-inited"))return a.fancybox({overlayShow:!1,cyclic:!1,autoScale:!0,titlePosition:"inside",showNavArrows:!1,titleFormat:function(a,b,f,h){return'<span id="fancybox-title-inside">'+(f+1)+" / "+b.length+(a.length?" &nbsp; "+a:"")+"</span>"}}),a.attr("data-inited",
1),a.click(),!1}$("body").on("showImg",".J_talkGoodsMagnify",function(){a(this)}).on("click",".J_talkGoodsMagnify",function(){a(this)})},init:function(){var a=n.login(),b=this;b.setScrollStyle.loadJs();this.getCartNum();this.showPanel(s,!0);this.showPanel(m,!0,function(){var a=$("#J_sidebar_shop"),c=a.find(".J_sidebar_panel_b");b.setScrollStyle.set(c);b.delShopItem({wrap:a,url:ajaxSiteUrl+"/index.php?app=cart&act=drop&goods_id=",fn:function(){var a=this.parents(".J_sidebar_shop_item"),a=parseInt(a.find(".J_shop_count_price").text()),
b=parseInt($("#J_sidebar_shop_num").text()),f=$("#J_shop_price");f.text().replace(/,/g,"");var c=this.parents(".J_list_wrap").find(".J_shop_price_total"),h=1*c.text().substr(1),g=$("#J_shop_goods_style"),d=parseInt(g.text());c.text("\u00a5"+Math.round(100*(h-a))/100);var e=0;$("#J_shop_list_wrap .J_shop_price_total").each(function(a,b){e+=1*$(b).text().substr(1)});f.text(Math.round(100*e)/100);--d;g.text(d);--b;$("#J_sidebar_shop_num,#min_cart_num").text(b)}})});this.showPanel(r,!0,function(){b.setScrollStyle.set($("#J_favor_goods,#J_favor_store"));
b.delShopItem({wrap:$("#J_favor_goods"),url:ajaxSiteUrl+"/index.php?app=my_favorite&act=drop&type=goods&item_id="});b.delShopItem({wrap:$("#J_favor_store"),url:ajaxSiteUrl+"/index.php?app=my_favorite&act=drop&type=store&item_id="})});this.showPanel(q,!1);this.showPanel(l,!1);this.eTab($("#J_sidebar_favor"));p.bind("click",function(){d.hidePanel(sidebar_nav)});this.blankHide("#J_sidebar");var c=$("#J_user"),g=$("#J_user_box");c.click(function(){if(!n.login())return n.show_login_box(),!1});a&&(a=ajaxSiteUrl+
"/index.php?app=navigation&act=sidebar_"+c.attr("data-html"),b.loadPanelData({e_obj:c,data_wrap:"#J_user_box",loading_wrap:"#J_user_box",url:a,fn:function(){var a=g.find(".J_user_pic").clone();a.addClass("e-user-img");c.addClass("e-user-show");c.append(a)}}),c.find(".J_sidebar_box").hide(),c.hover(function(){$(this).addClass("active")},function(){$(this).removeClass("active")}));a=$(window);510>=a.height()&&e.hide();a.resize(function(){$(".e-sidebar-b").hasClass("e-sidebar-turn")?730>=$(this).height()?
e.hide():e.show():510>=$(this).height()?e.hide():e.show()});$("#J_sidebar_back_top").click(function(){var a=$(this);a.addClass("active");$("html, body").animate({scrollTop:0},120,function(){a.removeClass("active")})});$("#J_tip_bottom").on("click",function(){$(this).hasClass("active")?($("#J_right_airnav").stop().animate({width:0}),$(this).removeClass("active")):($("#J_right_airnav").stop().animate({width:84}),$(this).addClass("active"))});$(window).scroll(function(){var a=$(window).height();$(document).scrollTop()>=
a?$("#J_sidebar_back_top").addClass("active"):$("#J_sidebar_back_top").removeClass("active")});this.bindOtherBusiness();d.checkBoxInit();d.revisecooks()},checkBoxInit:function(){function a(a,b,c){b=a.closest(b).find(c+" .check");c=!1;b.length==b.find(".checked").length&&(c=!0);c?a.children().addClass("checked"):a.children().removeClass("checked")}function b(a,b,c){b=a.closest(b).find(c+" .check");var d=a.children().hasClass("checked");d?a.children().removeClass("checked"):a.children().addClass("checked");
b.each(function(){var a=$(this);d?a.children().removeClass("checked"):a.children().addClass("checked")})}function c(a,b,c,d){a.closest(b).find(c+" .check").each(function(){var a=$(this);d?a.children().removeClass("checked"):a.children().addClass("checked")})}function d(){$page.find(".checked").length?$("#J_shop_balance").css("background-color","#e7183d").attr("href",SITE_URL+"/cart.html"):$("#J_shop_balance").css("background-color","#969696").attr("href","javascript:void(0);")}$page=$("#J_sidebar_shop");
$page.on("click",".J_e_sidebar_panel .check",function(){var a=$(this),b;a.children().hasClass("checked")?(a.children().removeClass("checked"),b=!0):(a.children().addClass("checked"),b=!1);c(a,"#J_sidebar_shop",".e-shop-store-h",b);c(a,"#J_sidebar_shop",".J_sidebar_shop_item",b);d()});$page.on("check",".J_e_sidebar_panel .check",function(){var b=$(this);a(b,"#J_sidebar_shop",".e-shop-store-h")});$page.on("click",".e-shop-store-h .check",function(){var a=$(this);b(a,".J_list_wrap",".J_sidebar_shop_item");
a.closest("#J_sidebar_shop").find(".J_e_sidebar_panel .icon-sidebar").trigger("check");d()});$page.on("check",".e-shop-store-h .check",function(){var b=$(this);a(b,".J_list_wrap",".J_sidebar_shop_item");b.closest("#J_sidebar_shop").find(".J_e_sidebar_panel .icon-sidebar").trigger("check")});$page.on("click",".J_sidebar_shop_item .check",function(){var a=$(this);a.children().hasClass("checked")?a.children().removeClass("checked"):a.children().addClass("checked");a.closest(".J_list_wrap").find(".e-shop-store-h .icon-sidebar").trigger("check");
d()})},revisecooks:function(){$page=$("#J_sidebar_shop");$page.on("click",".goods-revise",function(){var a=new Date;a.setTime(a.getTime()+31536E6);var b=$(this).attr("data-gid");$.setCookie("gooods_id_revise",b,a.toGMTString(),"/")})}};return{sidebarFn:d}}();elySidebar.sidebarFn.init();

/* resmerge themes/mall/default/sidebar/js/e.sidebar.js end */
/* resmerge themes/mall/default/sidebar/js/sidebar.compare.js start */
(function(){var e=window.location.hostname,h=e.slice(e.indexOf(".")+1),k=$("#J_sidebar_contrast_btn"),c="";sidebarFn=elySidebar.sidebarFn;compareGoods={add_compare_goods:function(a){var b=$("#J_contrast"),d=a.attr("data-img-src"),g=a.attr("data-id"),f=a.attr("data-href");a=a.attr("data-price");c.find(".J_contrast_link[def=true]").eq(0);d='<li>     <div class="e-list-img">         <a class="e-list-img-wrap J_contrast_link" data_goods_id="'+g+'" data-add="true" href="'+f+'" def="true" target="_blank">             <img src="'+
d+'" alt="">         </a>     </div>     <p class="J_contrast_price">'+a+"</p> </li>";6>c.find("li").length?(b.removeClass("e-contrast-none"),c.append(d),b=c.html(),this.set_cookie(b)):art.dialog('<div class="cont"><p>\u6700\u591a\u53ea\u80fd\u9009\u62e96\u4e2a\u5546\u54c1\u6bd4\u5bf9</p></div>')},clear_compare_goods:function(a,b){if(a.length){b=b||!1;a.remove();if(1==b)this.set_cookie(c.html());else{var d=new Date;d.setDate(d.getDate()-1);document.cookie="compare_cookie=; expires="+d.toGMTString()+
"; path=/; domain="+h}0>=c.find("li").length&&$("#J_contrast").addClass("e-contrast-none")}},set_cookie:function(a){var b=new Date;b.setDate(b.getDate()+1);$.setCookie("compare_cookie",a,b.toGMTString(),"/",h)},checkItemNum:function(a){a=a.find("li").length;var b=$("#J_contrast_btn");1>=a?b.addClass("e-btn-display"):b.removeClass("e-btn-display")},setListHeight:function(){var a=$("#J_like").height(),a=sidebar.height()-a-40;$("#J_contrast_box").css("min-height",a)},init:function(){var a=this;$("#J_contrast_list");
sidebarFn.showPanel(k,!1,function(){a.setListHeight();$("#J_sidebar_contrast").find(".J_sidebar_panel_b").perfectScrollbar();c=$("#J_contrast_list");var b=$.getCookie("compare_cookie");c.find("li");b?(c.html(b),a.checkItemNum(c)):$("#J_contrast").addClass("e-contrast-none");$("#J_contrast_num").text(c.find(".J_contrast_link[data-add=true]").length);eSidebarMayLike()});$("#J_compare_btn").click(function(){var b=-parseInt($("#J_sidebar").css("right")),d=$(this),g=d.attr("data-id"),f=function(){var b=
c.find(".J_contrast_link[data_goods_id="+g+"]"),e=$("#J_contrast_num"),f=parseInt(e.text());b.length?art.dialog('<div class="cont"><p>\u6211\u5df2\u7ecf\u5728\u8fdb\u8d27\u680f\u4e86\u54e6\uff01\uff1a)</p></div>'):(a.add_compare_goods(d),e.text(++f),a.checkItemNum(c))};if(b){$("#J_sidebar_contrast_btn").click();var e=setInterval(function(){$("#J_contrast_list").length&&(clearInterval(e),f())},1E3)}else f();return!1});$(document).on("click","#J_contrast_btn",function(){var b="",a=$("#J_contrast").find(".J_contrast_link");
if(1>=a.length)return!1;a.each(function(){var a=$(this).attr("data_goods_id");b=b?a+","+b:a});b?(contrast_url=NORMAL_URL+"/index.php?app=compare&gids="+b,window.open(contrast_url)):art.dialog('<div class="cont"><p class="tip-con">\u8bf7\u5148\u9009\u62e9\u5546\u54c1\u52a0\u5165\u6bd4\u8d27\u680f\u54e6\uff01</p></div>')});$(document).on("click","#J_contrast_clear",function(){$("#J_contrast_num").text(0);c.find("li").each(function(){a.clear_compare_goods($(this))})});$(document).on("click",".J_contrast_close",
function(){var b=$(this).parents("li"),d=$("#J_contrast_num"),e=parseInt(d.text());a.clear_compare_goods(b,!0);d.text(e-1);a.checkItemNum(c);return!1});$(document).on("mouseenter","#J_contrast li",function(){$(this).find(".J_contrast_link").parent().append('<a href="javascript:;" class="e-icon e-icon-close e-contrast-close J_contrast_close"></a>')});$(document).on("mouseleave","#J_contrast li",function(){$(this).find(".J_contrast_link").siblings(".J_contrast_close").remove()})}};compareGoods.init()})();

/* resmerge themes/mall/default/sidebar/js/sidebar.compare.js end */
/* resmerge themes/mall/default/sidebar/js/sidebar.feedback.js start */
(function(){var f=$("#J_feedback"),b=$("#J_feedback_ta"),e=$("#J_feedback_num");$("#J_feedback_btn");var c=b.find(".J_feedback_textarea"),k="";({fb_check_num:function(a){$("#J_feedback_m_num").text(a);c.bind("keyup",function(){var g=$(this),b=g.val();b.length>a?g.val(b.substring(0,a)):e.text(b.length)})},fb_placeholder:function(){b.append('<span class="J_feedback_ph e-feedback-ph">\u60a8\u7559\u4e0b\u7684\u6bcf\u4e00\u4e2a\u5efa\u8bae\u90fd\u662f\u6211\u4eec\u4e0d\u65ad\u6539\u8fdb\u7684\u52a8\u529b\uff01</span>');
var a=b.find(".J_feedback_ph");c.bind("focus",function(){a.hide()}).bind("blur",function(){""==c.val()&&a.show()})},fb_mask:function(a){var b=a.wrap,e=a.status,h=a.ctn;a=1E3*a.time||0;var d=b.find(".J_sidebar_mask");1==e?(d.remove(),b.append('<div class="J_sidebar_mask e-sidebar-mask"><div class="mask-bg"></div><div class="mask-ctn">'+h+"</div></div>"),0<a&&(clearInterval(k),k=setInterval(function(){b.find(".J_sidebar_mask").remove();c.focus()},a))):d.length&&d.remove()},init:function(){var a=this;
a.fb_check_num(500);a.fb_placeholder();f.find(".J_sidebar_tip").bind("click",function(){$(this).parent().toggleClass("active")});$("#J_feedback_close").bind("click",function(){f.removeClass("active")});$("#J_feedback_btn").bind("click",function(){var g=document.location.href,f=$("#J_feedback_type").val(),h=c.val();""==h?a.fb_mask({wrap:b,status:!0,ctn:"\u63d0\u4ea4\u524d\u5148\u7ed9\u70b9\u5efa\u8bae\u5427\uff01",time:3}):(a.fb_mask({wrap:b,status:!0,ctn:"\u6b63\u5728\u63d0\u4ea4"}),$.ajax({url:"/index.php?app=default&act=feedback",
data:{content:h,from_page:g,type:f,jsonp:1},dataType:"jsonp",success:function(d){if(0==d.retval.insert_id)return a.fb_mask({wrap:b,status:!0,ctn:d.msg,time:3}),e.text("0"),c.val(""),!1;a.fb_mask({wrap:b,status:!0,ctn:"\u63d0\u4ea4\u6210\u529f\uff0c\u611f\u8c22\u60a8\u5bf9\u8863\u8054\u7684\u652f\u6301\uff01",time:10});e.text("0");c.val("")}}))})}}).init()})();

/* resmerge themes/mall/default/sidebar/js/sidebar.feedback.js end */
/* resmerge themes/mall/default/sidebar/js/sidebar.may.like.js start */
function eSidebarMayLike(){var f=!1,e={LoadMask:function(a,c){var b=$("#J_load_mask");0<b.length&&!c?b.remove():elySidebar.sidebarFn.addMaskHtml(a)},likeHtml:function(a,c){var b="",d;for(d in c)b+='<li><div class="e-list-img"><a class="e-list-img-wrap" href="'+SITE_URL+"/goods/"+c[d].goods_id+'.html" target="_blank"><img src="'+IMAGE_URL+"/"+c[d].default_image+'" alt=""><em></em></a></div><p class="e-goods-price">&yen;'+c[d].price+"</p></li>";a.append(b)},loadLikeData:function(a,c,b){var d=$("#J_like_change_ctn");
if(c&&d.attr("data-first")||f)return!1;f=!0;var g=$("#J_like_change_wrap");e.LoadMask(g);$.ajax({type:"GET",dataType:"jsonp",url:a,success:function(a){a=a.retval;b&&b();d.html("");e.LoadMask(g,!1);e.likeHtml(d,a)},complete:function(){f=!1}})},init:function(){var a=this;a.loadLikeData("/index.php?app=navigation&act=sidebar_may_like&refresh=1");$(document).on("click","#J_like_change",function(){a.loadLikeData("/index.php?app=navigation&act=sidebar_may_like&refresh=1")})}};e.init()};

/* resmerge themes/mall/default/sidebar/js/sidebar.may.like.js end */
/* resmerge themes/mall/default/sidebar/js/jquery.md5.js start */
/*
 http://www.gnu.org/licenses/gpl.html [GNU General Public License]
 @param {jQuery} {md5:function(string))
 @return string
*/
(function(t){var m=function(a,c){var g,h,k,l,b;k=a&2147483648;l=c&2147483648;g=a&1073741824;h=c&1073741824;b=(a&1073741823)+(c&1073741823);return g&h?b^2147483648^k^l:g|h?b&1073741824?b^3221225472^k^l:b^1073741824^k^l:b^k^l},n=function(a,c,g,h,k,l,b){a=m(a,m(m(c&g|~c&h,k),b));return m(a<<l|a>>>32-l,c)},p=function(a,c,g,h,k,l,b){a=m(a,m(m(c&h|g&~h,k),b));return m(a<<l|a>>>32-l,c)},q=function(a,c,g,h,k,l,b){a=m(a,m(m(c^g^h,k),b));return m(a<<l|a>>>32-l,c)},r=function(a,c,g,h,k,l,b){a=m(a,m(m(g^(c|~h),
k),b));return m(a<<l|a>>>32-l,c)},s=function(a){var c="",g="",h;for(h=0;3>=h;h++)g=a>>>8*h&255,g="0"+g.toString(16),c+=g.substr(g.length-2,2);return c};t.extend({md5:function(a){var c=[],g,h,k,l,b,d,e,f,c=a.replace(/\x0d\x0a/g,"\n");a="";for(g=0;g<c.length;g++)h=c.charCodeAt(g),128>h?a+=String.fromCharCode(h):(127<h&&2048>h?a+=String.fromCharCode(h>>6|192):(a+=String.fromCharCode(h>>12|224),a+=String.fromCharCode(h>>6&63|128)),a+=String.fromCharCode(h&63|128));c=a;a=c.length;g=a+8;h=16*((g-g%64)/
64+1);k=Array(h-1);for(b=l=0;b<a;)g=(b-b%4)/4,l=b%4*8,k[g]|=c.charCodeAt(b)<<l,b++;g=(b-b%4)/4;k[g]|=128<<b%4*8;k[h-2]=a<<3;k[h-1]=a>>>29;c=k;b=1732584193;d=4023233417;e=2562383102;f=271733878;for(a=0;a<c.length;a+=16)g=b,h=d,k=e,l=f,b=n(b,d,e,f,c[a+0],7,3614090360),f=n(f,b,d,e,c[a+1],12,3905402710),e=n(e,f,b,d,c[a+2],17,606105819),d=n(d,e,f,b,c[a+3],22,3250441966),b=n(b,d,e,f,c[a+4],7,4118548399),f=n(f,b,d,e,c[a+5],12,1200080426),e=n(e,f,b,d,c[a+6],17,2821735955),d=n(d,e,f,b,c[a+7],22,4249261313),
b=n(b,d,e,f,c[a+8],7,1770035416),f=n(f,b,d,e,c[a+9],12,2336552879),e=n(e,f,b,d,c[a+10],17,4294925233),d=n(d,e,f,b,c[a+11],22,2304563134),b=n(b,d,e,f,c[a+12],7,1804603682),f=n(f,b,d,e,c[a+13],12,4254626195),e=n(e,f,b,d,c[a+14],17,2792965006),d=n(d,e,f,b,c[a+15],22,1236535329),b=p(b,d,e,f,c[a+1],5,4129170786),f=p(f,b,d,e,c[a+6],9,3225465664),e=p(e,f,b,d,c[a+11],14,643717713),d=p(d,e,f,b,c[a+0],20,3921069994),b=p(b,d,e,f,c[a+5],5,3593408605),f=p(f,b,d,e,c[a+10],9,38016083),e=p(e,f,b,d,c[a+15],14,3634488961),
d=p(d,e,f,b,c[a+4],20,3889429448),b=p(b,d,e,f,c[a+9],5,568446438),f=p(f,b,d,e,c[a+14],9,3275163606),e=p(e,f,b,d,c[a+3],14,4107603335),d=p(d,e,f,b,c[a+8],20,1163531501),b=p(b,d,e,f,c[a+13],5,2850285829),f=p(f,b,d,e,c[a+2],9,4243563512),e=p(e,f,b,d,c[a+7],14,1735328473),d=p(d,e,f,b,c[a+12],20,2368359562),b=q(b,d,e,f,c[a+5],4,4294588738),f=q(f,b,d,e,c[a+8],11,2272392833),e=q(e,f,b,d,c[a+11],16,1839030562),d=q(d,e,f,b,c[a+14],23,4259657740),b=q(b,d,e,f,c[a+1],4,2763975236),f=q(f,b,d,e,c[a+4],11,1272893353),
e=q(e,f,b,d,c[a+7],16,4139469664),d=q(d,e,f,b,c[a+10],23,3200236656),b=q(b,d,e,f,c[a+13],4,681279174),f=q(f,b,d,e,c[a+0],11,3936430074),e=q(e,f,b,d,c[a+3],16,3572445317),d=q(d,e,f,b,c[a+6],23,76029189),b=q(b,d,e,f,c[a+9],4,3654602809),f=q(f,b,d,e,c[a+12],11,3873151461),e=q(e,f,b,d,c[a+15],16,530742520),d=q(d,e,f,b,c[a+2],23,3299628645),b=r(b,d,e,f,c[a+0],6,4096336452),f=r(f,b,d,e,c[a+7],10,1126891415),e=r(e,f,b,d,c[a+14],15,2878612391),d=r(d,e,f,b,c[a+5],21,4237533241),b=r(b,d,e,f,c[a+12],6,1700485571),
f=r(f,b,d,e,c[a+3],10,2399980690),e=r(e,f,b,d,c[a+10],15,4293915773),d=r(d,e,f,b,c[a+1],21,2240044497),b=r(b,d,e,f,c[a+8],6,1873313359),f=r(f,b,d,e,c[a+15],10,4264355552),e=r(e,f,b,d,c[a+6],15,2734768916),d=r(d,e,f,b,c[a+13],21,1309151649),b=r(b,d,e,f,c[a+4],6,4149444226),f=r(f,b,d,e,c[a+11],10,3174756917),e=r(e,f,b,d,c[a+2],15,718787259),d=r(d,e,f,b,c[a+9],21,3951481745),b=m(b,g),d=m(d,h),e=m(e,k),f=m(f,l);return(s(b)+s(d)+s(e)+s(f)).toLowerCase()}})})(jQuery);

/* resmerge themes/mall/default/sidebar/js/jquery.md5.js end */
/* resmerge includes/libraries/javascript/jquery.zclip.min.js start */
(function(a){a.fn.zclip=function(b){if("object"==typeof b&&!b.length){var c=a.extend({path:"ZeroClipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:!0,setHandCursor:!0,setCSSEffects:!0},b);return this.each(function(){var b=a(this);if(b.is(":visible")&&("string"==typeof c.copy||a.isFunction(c.copy))){ZeroClipboard.setMoviePath(c.path);var d=new ZeroClipboard.Client;a.isFunction(c.copy)&&b.bind("zClip_copy",c.copy);a.isFunction(c.beforeCopy)&&b.bind("zClip_beforeCopy",c.beforeCopy);a.isFunction(c.afterCopy)&&
b.bind("zClip_afterCopy",c.afterCopy);d.setHandCursor(c.setHandCursor);d.setCSSEffects(c.setCSSEffects);d.addEventListener("mouseOver",function(a){b.trigger("mouseenter")});d.addEventListener("mouseOut",function(a){b.trigger("mouseleave")});d.addEventListener("mouseDown",function(h){b.trigger("mousedown");a.isFunction(c.copy)?d.setText(b.triggerHandler("zClip_copy")):d.setText(c.copy);a.isFunction(c.beforeCopy)&&b.trigger("zClip_beforeCopy")});d.addEventListener("complete",function(d,g){a.isFunction(c.afterCopy)?
b.trigger("zClip_afterCopy"):(500<g.length&&(g=g.substr(0,500)+"...\n\n("+(g.length-500)+" characters not shown)"),b.removeClass("hover"),alert("Copied text to clipboard:\n\n "+g));c.clickAfter&&b.trigger("click")});d.glue(b[0],b.parent()[0]);a(window).bind("load resize",function(){d.reposition()})}})}if("string"==typeof b)return this.each(function(){var c=a(this);b=b.toLowerCase();var d=c.data("zclipId"),d=a("#"+d+".zclip");"remove"==b?(d.remove(),c.removeClass("active hover")):"hide"==b?(d.hide(),
c.removeClass("active hover")):"show"==b&&d.show()})}})(jQuery);
var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(a){"string"==typeof a&&(a=document.getElementById(a));a.addClass||(a.hide=function(){this.style.display="none"},a.show=function(){this.style.display=""},a.addClass=function(a){this.removeClass(a);this.className+=" "+a},a.removeClass=function(a){for(var c=this.className.split(/\s+/),e=-1,d=0;d<c.length;d++)c[d]==a&&(e=d,d=c.length);-1<e&&(c.splice(e,1),this.className=c.join(" "));return this},a.hasClass=
function(a){return!!this.className.match(new RegExp("\\s*"+a+"\\s*"))});return a},setMoviePath:function(a){this.moviePath=a},dispatch:function(a,b,c){(a=this.clients[a])&&a.receiveEvent(b,c)},register:function(a,b){this.clients[a]=b},getDOMObjectPosition:function(a,b){var c={left:0,top:0,width:a.width?a.width:a.offsetWidth,height:a.height?a.height:a.offsetHeight};a&&a!=b&&(c.left+=a.offsetLeft,c.top+=a.offsetTop);return c},Client:function(a){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId=
"ZeroClipboardMovie_"+this.id;ZeroClipboard.register(this.id,this);a&&this.glue(a)}};
ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(a,b,c){this.domElement=ZeroClipboard.$(a);a=99;this.domElement.style.zIndex&&(a=parseInt(this.domElement.style.zIndex,10)+1);"string"==typeof b?b=ZeroClipboard.$(b):"undefined"==typeof b&&(b=document.getElementsByTagName("body")[0]);var e=ZeroClipboard.getDOMObjectPosition(this.domElement,b);this.div=document.createElement("div");this.div.className="zclip";this.div.id=
"zclip-"+this.movieId;$(this.domElement).data("zclipId","zclip-"+this.movieId);var d=this.div.style;d.position="absolute";d.left=""+e.left+"px";d.top=""+e.top+"px";d.width=""+e.width+"px";d.height=""+e.height+"px";d.zIndex=a;if("object"==typeof c)for(addedStyle in c)d[addedStyle]=c[addedStyle];b.appendChild(this.div);this.div.innerHTML=this.getHTML(e.width,e.height)},getHTML:function(a,b){var c="",e="id="+this.id+"&width="+a+"&height="+b;if(navigator.userAgent.match(/MSIE/))var d=location.href.match(/^https/i)?
"https://":"http://",c=c+('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+d+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+a+'" height="'+b+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+
e+'"/><param name="wmode" value="transparent"/></object>');else c+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+a+'" height="'+b+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+e+'" wmode="transparent" />';return c},hide:function(){this.div&&(this.div.style.left=
"-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML="";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div)}catch(b){}this.div=this.domElement=null}},reposition:function(a){a&&((this.domElement=ZeroClipboard.$(a))||this.hide());if(this.domElement&&this.div){a=ZeroClipboard.getDOMObjectPosition(this.domElement);var b=this.div.style;b.left=""+a.left+"px";b.top=""+a.top+"px"}},setText:function(a){this.clipText=
a;this.ready&&this.movie.setText(a)},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");this.handlers[a]||(this.handlers[a]=[]);this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a;this.ready&&this.movie.setHandCursor(a)},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(a,b){a=a.toString().toLowerCase().replace(/^on/,"");switch(a){case "load":this.movie=document.getElementById(this.movieId);if(!this.movie){var c=this;setTimeout(function(){c.receiveEvent("load",
null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){c=this;setTimeout(function(){c.receiveEvent("load",null)},100);this.ready=!0;return}this.ready=!0;try{this.movie.setText(this.clipText)}catch(e){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(d){}break;case "mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case "mouseout":this.domElement&&
this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case "mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case "mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[a])for(var h=0,g=this.handlers[a].length;h<g;h++){var f=this.handlers[a][h];if("function"==typeof f)f(this,
b);else if("object"==typeof f&&2==f.length)f[0][f[1]](this,b);else if("string"==typeof f)window[f](this,b)}}};

/* resmerge includes/libraries/javascript/jquery.zclip.min.js end */
/* resmerge themes/webim/static/sdk/strophe.js start */
(function(s){(function(f,q){"function"===typeof define&&define.amd?define("strophe-base64",function(){return q()}):f.Base64=q()})(this,function(){return{encode:function(f){var q="",b,d,g,n,c,a,k,r=0;do b=f.charCodeAt(r++),d=f.charCodeAt(r++),g=f.charCodeAt(r++),n=b>>2,c=(b&3)<<4|d>>4,a=(d&15)<<2|g>>6,k=g&63,isNaN(d)?(c=(b&3)<<4,a=k=64):isNaN(g)&&(k=64),q=q+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);while(r<f.length);return q},decode:function(f){var q="",b,d,g,n,c,a=0;f=f.replace(/[^A-Za-z0-9\+\/\=]/g,"");do b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++)),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++)),
c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(f.charAt(a++)),b=b<<2|d>>4,d=(d&15)<<4|n>>2,g=(n&3)<<6|c,q+=String.fromCharCode(b),64!=n&&(q+=String.fromCharCode(d)),64!=c&&(q+=String.fromCharCode(g));while(a<f.length);return q}}});(function(f,q){"function"===typeof define&&define.amd?define("strophe-sha1",function(){return q()}):f.SHA1=q()})(this,function(){function f(c,a){c[a>>5]|=128<<24-a%32;c[(a+64>>9<<4)+15]=a;var k=Array(80),r=1732584193,e=-271733879,m=-1732584194,
l=271733878,h=-1009589776,d,f,g,n,p,q,s,w;for(d=0;d<c.length;d+=16){n=r;p=e;q=m;s=l;w=h;for(f=0;80>f;f++){16>f?k[f]=c[d+f]:(g=k[f-3]^k[f-8]^k[f-14]^k[f-16],k[f]=g<<1|g>>>31);g=r<<5|r>>>27;var x;x=20>f?e&m|~e&l:40>f?e^m^l:60>f?e&m|e&l|m&l:e^m^l;g=b(b(g,x),b(b(h,k[f]),20>f?1518500249:40>f?1859775393:60>f?-1894007588:-899497514));h=l;l=m;m=e<<30|e>>>2;e=r;r=g}r=b(r,n);e=b(e,p);m=b(m,q);l=b(l,s);h=b(h,w)}return[r,e,m,l,h]}function q(c,a){var k=d(c);16<k.length&&(k=f(k,8*c.length));for(var b=Array(16),
e=Array(16),m=0;16>m;m++)b[m]=k[m]^909522486,e[m]=k[m]^1549556828;k=f(b.concat(d(a)),512+8*a.length);return f(e.concat(k),672)}function b(c,a){var k=(c&65535)+(a&65535);return(c>>16)+(a>>16)+(k>>16)<<16|k&65535}function d(c){for(var a=[],k=0;k<8*c.length;k+=8)a[k>>5]|=(c.charCodeAt(k/8)&255)<<24-k%32;return a}function g(c){for(var a="",k=0;k<32*c.length;k+=8)a+=String.fromCharCode(c[k>>5]>>>24-k%32&255);return a}function n(c){for(var a="",k,b,e=0;e<4*c.length;e+=3)for(k=(c[e>>2]>>8*(3-e%4)&255)<<
16|(c[e+1>>2]>>8*(3-(e+1)%4)&255)<<8|c[e+2>>2]>>8*(3-(e+2)%4)&255,b=0;4>b;b++)a=8*e+6*b>32*c.length?a+"=":a+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>6*(3-b)&63);return a}return{b64_hmac_sha1:function(c,a){return n(q(c,a))},b64_sha1:function(c){return n(f(d(c),8*c.length))},binb2str:g,core_hmac_sha1:q,str_hmac_sha1:function(c,a){return g(q(c,a))},str_sha1:function(c){return g(f(d(c),8*c.length))}}});(function(f,q){"function"===typeof define&&define.amd?define("strophe-md5",
function(){return q()}):f.MD5=q()})(this,function(f){var q=function(a,c){var e=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(e>>16)<<16|e&65535},b=function(a){for(var c=[],e=0;e<8*a.length;e+=8)c[e>>5]|=(a.charCodeAt(e/8)&255)<<e%32;return c},d=function(a,c,e,b,l,d){a=q(q(c,a),q(b,d));return q(a<<l|a>>>32-l,e)},g=function(a,c,e,b,l,h,f){return d(c&e|~c&b,a,c,l,h,f)},n=function(a,c,e,b,l,h,f){return d(c&b|e&~b,a,c,l,h,f)},c=function(a,c,e,b,l,h,f){return d(e^(c|~b),a,c,l,h,f)},a=function(a,b){a[b>>5]|=
128<<b%32;a[(b+64>>>9<<4)+14]=b;for(var e=1732584193,m=-271733879,l=-1732584194,h=271733878,f,u,v,t,p=0;p<a.length;p+=16)f=e,u=m,v=l,t=h,e=g(e,m,l,h,a[p+0],7,-680876936),h=g(h,e,m,l,a[p+1],12,-389564586),l=g(l,h,e,m,a[p+2],17,606105819),m=g(m,l,h,e,a[p+3],22,-1044525330),e=g(e,m,l,h,a[p+4],7,-176418897),h=g(h,e,m,l,a[p+5],12,1200080426),l=g(l,h,e,m,a[p+6],17,-1473231341),m=g(m,l,h,e,a[p+7],22,-45705983),e=g(e,m,l,h,a[p+8],7,1770035416),h=g(h,e,m,l,a[p+9],12,-1958414417),l=g(l,h,e,m,a[p+10],17,-42063),
m=g(m,l,h,e,a[p+11],22,-1990404162),e=g(e,m,l,h,a[p+12],7,1804603682),h=g(h,e,m,l,a[p+13],12,-40341101),l=g(l,h,e,m,a[p+14],17,-1502002290),m=g(m,l,h,e,a[p+15],22,1236535329),e=n(e,m,l,h,a[p+1],5,-165796510),h=n(h,e,m,l,a[p+6],9,-1069501632),l=n(l,h,e,m,a[p+11],14,643717713),m=n(m,l,h,e,a[p+0],20,-373897302),e=n(e,m,l,h,a[p+5],5,-701558691),h=n(h,e,m,l,a[p+10],9,38016083),l=n(l,h,e,m,a[p+15],14,-660478335),m=n(m,l,h,e,a[p+4],20,-405537848),e=n(e,m,l,h,a[p+9],5,568446438),h=n(h,e,m,l,a[p+14],9,-1019803690),
l=n(l,h,e,m,a[p+3],14,-187363961),m=n(m,l,h,e,a[p+8],20,1163531501),e=n(e,m,l,h,a[p+13],5,-1444681467),h=n(h,e,m,l,a[p+2],9,-51403784),l=n(l,h,e,m,a[p+7],14,1735328473),m=n(m,l,h,e,a[p+12],20,-1926607734),e=d(m^l^h,e,m,a[p+5],4,-378558),h=d(e^m^l,h,e,a[p+8],11,-2022574463),l=d(h^e^m,l,h,a[p+11],16,1839030562),m=d(l^h^e,m,l,a[p+14],23,-35309556),e=d(m^l^h,e,m,a[p+1],4,-1530992060),h=d(e^m^l,h,e,a[p+4],11,1272893353),l=d(h^e^m,l,h,a[p+7],16,-155497632),m=d(l^h^e,m,l,a[p+10],23,-1094730640),e=d(m^l^
h,e,m,a[p+13],4,681279174),h=d(e^m^l,h,e,a[p+0],11,-358537222),l=d(h^e^m,l,h,a[p+3],16,-722521979),m=d(l^h^e,m,l,a[p+6],23,76029189),e=d(m^l^h,e,m,a[p+9],4,-640364487),h=d(e^m^l,h,e,a[p+12],11,-421815835),l=d(h^e^m,l,h,a[p+15],16,530742520),m=d(l^h^e,m,l,a[p+2],23,-995338651),e=c(e,m,l,h,a[p+0],6,-198630844),h=c(h,e,m,l,a[p+7],10,1126891415),l=c(l,h,e,m,a[p+14],15,-1416354905),m=c(m,l,h,e,a[p+5],21,-57434055),e=c(e,m,l,h,a[p+12],6,1700485571),h=c(h,e,m,l,a[p+3],10,-1894986606),l=c(l,h,e,m,a[p+10],
15,-1051523),m=c(m,l,h,e,a[p+1],21,-2054922799),e=c(e,m,l,h,a[p+8],6,1873313359),h=c(h,e,m,l,a[p+15],10,-30611744),l=c(l,h,e,m,a[p+6],15,-1560198380),m=c(m,l,h,e,a[p+13],21,1309151649),e=c(e,m,l,h,a[p+4],6,-145523070),h=c(h,e,m,l,a[p+11],10,-1120210379),l=c(l,h,e,m,a[p+2],15,718787259),m=c(m,l,h,e,a[p+9],21,-343485551),e=q(e,f),m=q(m,u),l=q(l,v),h=q(h,t);return[e,m,l,h]};return{hexdigest:function(k){k=a(b(k),8*k.length);for(var c="",e=0;e<4*k.length;e++)c+="0123456789abcdef".charAt(k[e>>2]>>e%4*8+
4&15)+"0123456789abcdef".charAt(k[e>>2]>>e%4*8&15);return c},hash:function(k){k=a(b(k),8*k.length);for(var c="",e=0;e<32*k.length;e+=8)c+=String.fromCharCode(k[e>>5]>>>e%32&255);return c}}});Function.prototype.stropheBind||(Function.prototype.stropheBind=function(f){var q=this,b=Array.prototype.slice,d=Array.prototype.concat,g=b.call(arguments,1);return function(){return q.apply(f?f:this,d.call(g,b.call(arguments,0)))}});Array.isArray||(Array.isArray=function(f){return"[object Array]"===Object.prototype.toString.call(f)});
Array.prototype.indexOf||(Array.prototype.indexOf=function(f,q){var b=this.length,d=Number(q)||0,d=0>d?Math.ceil(d):Math.floor(d);for(0>d&&(d+=b);d<b;d++)if(d in this&&this[d]===f)return d;return-1});(function(f,q){if("function"===typeof define&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-polyfill"],function(){return q.apply(this,arguments)});else{var b=q(f.SHA1,f.Base64,f.MD5);window.Strophe=b.Strophe;window.$build=b.$build;window.$iq=b.$iq;window.$msg=
b.$msg;window.$pres=b.$pres;window.SHA1=b.SHA1;window.Base64=b.Base64;window.MD5=b.MD5;window.b64_hmac_sha1=b.SHA1.b64_hmac_sha1;window.b64_sha1=b.SHA1.b64_sha1;window.str_hmac_sha1=b.SHA1.str_hmac_sha1;window.str_sha1=b.SHA1.str_sha1}})(this,function(f,q,b){function d(a,k){return new c.Builder(a,k)}function g(a){return new c.Builder("iq",a)}function n(a){return new c.Builder("presence",a)}var c;c={VERSION:"1.2.2",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",
AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",
XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:"a blockquote br cite em img li ol p span strong ul body".split(" "),attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:"background-color color font-family font-size font-style font-weight margin-left margin-right text-align text-decoration".split(" "),
validTag:function(a){for(var k=0;k<c.XHTML.tags.length;k++)if(a==c.XHTML.tags[k])return!0;return!1},validAttribute:function(a,k){if("undefined"!==typeof c.XHTML.attributes[a]&&0<c.XHTML.attributes[a].length)for(var b=0;b<c.XHTML.attributes[a].length;b++)if(k==c.XHTML.attributes[a][b])return!0;return!1},validCSS:function(a){for(var k=0;k<c.XHTML.css.length;k++)if(a==c.XHTML.css[k])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,
ATTACHED:8,REDIRECT:9},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(a,k){c.NS[a]=k},forEachChild:function(a,k,b){var e,m;for(e=0;e<a.childNodes.length;e++)m=a.childNodes[e],m.nodeType!=c.ElementType.NORMAL||k&&!this.isTagEqual(m,k)||b(m)},isTagEqual:function(a,c){return a.tagName==c},_xmlGenerator:null,_makeGenerator:function(){var a;void 0===document.implementation.createDocument||document.implementation.createDocument&&
document.documentMode&&10>document.documentMode?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null);return a},xmlGenerator:function(){c._xmlGenerator||(c._xmlGenerator=c._makeGenerator());return c._xmlGenerator},_getIEXmlDom:function(){for(var a=null,c="Msxml2.DOMDocument.6.0 Msxml2.DOMDocument.5.0 Msxml2.DOMDocument.4.0 MSXML2.DOMDocument.3.0 MSXML2.DOMDocument MSXML.DOMDocument Microsoft.XMLDOM".split(" "),b=
0;b<c.length;b++)if(null===a)try{a=new ActiveXObject(c[b])}catch(e){a=null}else break;return a},xmlElement:function(a){if(!a)return null;var k=c.xmlGenerator().createElement(a),b,e,m;for(b=1;b<arguments.length;b++){var d=arguments[b];if(d)if("string"==typeof d||"number"==typeof d)k.appendChild(c.xmlTextNode(d));else if("object"==typeof d&&"function"==typeof d.sort)for(e=0;e<d.length;e++){var f=d[e];"object"==typeof f&&"function"==typeof f.sort&&void 0!==f[1]&&k.setAttribute(f[0],f[1])}else if("object"==
typeof d)for(m in d)d.hasOwnProperty(m)&&void 0!==d[m]&&k.setAttribute(m,d[m])}return k},xmlescape:function(a){a=a.replace(/\&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/'/g,"&apos;");return a=a.replace(/"/g,"&quot;")},xmlunescape:function(a){a=a.replace(/\&amp;/g,"&");a=a.replace(/&lt;/g,"<");a=a.replace(/&gt;/g,">");a=a.replace(/&apos;/g,"'");return a=a.replace(/&quot;/g,'"')},xmlTextNode:function(a){return c.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){var c;
window.DOMParser?c=(new DOMParser).parseFromString(a,"text/xml"):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a));return c},getText:function(a){if(!a)return null;var k="";0===a.childNodes.length&&a.nodeType==c.ElementType.TEXT&&(k+=a.nodeValue);for(var b=0;b<a.childNodes.length;b++)a.childNodes[b].nodeType==c.ElementType.TEXT&&(k+=a.childNodes[b].nodeValue);return c.xmlescape(k)},copyElement:function(a){var k,b;if(a.nodeType==c.ElementType.NORMAL){b=c.xmlElement(a.tagName);for(k=
0;k<a.attributes.length;k++)b.setAttribute(a.attributes[k].nodeName,a.attributes[k].value);for(k=0;k<a.childNodes.length;k++)b.appendChild(c.copyElement(a.childNodes[k]))}else a.nodeType==c.ElementType.TEXT&&(b=c.xmlGenerator().createTextNode(a.nodeValue));return b},createHtml:function(a){var k,b,e,d,f,h,g,n,q,t,p;if(a.nodeType==c.ElementType.NORMAL)if(d=a.nodeName.toLowerCase(),c.XHTML.validTag(d))try{b=c.xmlElement(d);for(k=0;k<c.XHTML.attributes[d].length;k++)if(f=c.XHTML.attributes[d][k],h=a.getAttribute(f),
"undefined"!=typeof h&&null!==h&&""!==h&&!1!==h&&0!==h)if("style"==f&&"object"==typeof h&&"undefined"!=typeof h.cssText&&(h=h.cssText),"style"==f){g=[];n=h.split(";");for(e=0;e<n.length;e++)q=n[e].split(":"),t=q[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(t)&&(p=q[1].replace(/^\s*/,"").replace(/\s*$/,""),g.push(t+": "+p));0<g.length&&(h=g.join("; "),b.setAttribute(f,h))}else b.setAttribute(f,h);for(k=0;k<a.childNodes.length;k++)b.appendChild(c.createHtml(a.childNodes[k]))}catch(y){b=
c.xmlTextNode("")}else for(b=c.xmlGenerator().createDocumentFragment(),k=0;k<a.childNodes.length;k++)b.appendChild(c.createHtml(a.childNodes[k]));else if(a.nodeType==c.ElementType.FRAGMENT)for(b=c.xmlGenerator().createDocumentFragment(),k=0;k<a.childNodes.length;k++)b.appendChild(c.createHtml(a.childNodes[k]));else a.nodeType==c.ElementType.TEXT&&(b=c.xmlTextNode(a.nodeValue));return b},escapeNode:function(a){return"string"!==typeof a?a:a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,
"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return"string"!==typeof a?a:a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return 0>a.indexOf("@")?null:
a.split("@")[0]},getDomainFromJid:function(a){a=c.getBareJidFromJid(a);if(0>a.indexOf("@"))return a;a=a.split("@");a.splice(0,1);return a.join("@")},getResourceFromJid:function(a){a=a.split("/");if(2>a.length)return null;a.splice(0,1);return a.join("/")},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(a,c){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,
a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"===typeof a.tree&&(a=a.tree());var d=a.nodeName,e,f;a.getAttribute("_realname")&&(d=a.getAttribute("_realname"));b="<"+d;for(e=0;e<a.attributes.length;e++)"_realname"!=a.attributes[e].nodeName&&(b+=" "+a.attributes[e].nodeName+"='"+a.attributes[e].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(0<a.childNodes.length){b+=">";for(e=0;e<
a.childNodes.length;e++)switch(f=a.childNodes[e],f.nodeType){case c.ElementType.NORMAL:b+=c.serialize(f);break;case c.ElementType.TEXT:b+=c.xmlescape(f.nodeValue);break;case c.ElementType.CDATA:b+="<![CDATA["+f.nodeValue+"]]\x3e"}b+="</"+d+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){c._connectionPlugins[a]=b},Builder:function(a,b){if("presence"==a||"message"==a||"iq"==a)b&&!b.xmlns?b.xmlns=c.NS.CLIENT:b||(b={xmlns:c.NS.CLIENT});this.node=this.nodeTree=
c.xmlElement(a,b)}};c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){this.node=this.node.parentNode;return this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&(void 0===a[b]?this.node.removeAttribute(b):this.node.setAttribute(b,a[b]));return this},c:function(a,b,d){a=c.xmlElement(a,b,d);this.node.appendChild(a);"string"!==typeof d&&(this.node=a);return this},cnode:function(a){var b,d=c.xmlGenerator();try{b=void 0!==
d.importNode}catch(e){b=!1}a=b?d.importNode(a,!0):c.copyElement(a);this.node.appendChild(a);this.node=a;return this},t:function(a){a=c.xmlTextNode(a);this.node.appendChild(a);return this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(a=c.createHtml(b);0<a.childNodes.length;)this.node.appendChild(a.childNodes[0]);return this}};c.Handler=function(a,b,d,e,f,l,h){this.handler=a;this.ns=b;this.name=d;this.type=e;this.id=f;this.options=h||{matchBare:!1};this.options.matchBare||(this.options.matchBare=
!1);this.from=this.options.matchBare?l?c.getBareJidFromJid(l):null:l;this.user=!0};c.Handler.prototype={isMatch:function(a){var b,d=null,d=this.options.matchBare?c.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from");b=!1;if(this.ns){var e=this;c.forEachChild(a,null,function(a){a.getAttribute("xmlns")==e.ns&&(b=!0)});b=b||a.getAttribute("xmlns")==this.ns}else b=!0;var f=a.getAttribute("type");return!b||this.name&&!c.isTagEqual(a,this.name)||this.type&&(Array.isArray(this.type)?-1==this.type.indexOf(f):
f!=this.type)||this.id&&a.getAttribute("id")!=this.id||this.from&&d!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(d){throw d.sourceURL?c.fatal("error: "+this.handler+" "+d.sourceURL+":"+d.line+" - "+d.name+": "+d.message):d.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",d,d.message)),c.fatal("error: "+this.handler+" "+d.fileName+":"+d.lineNumber+" - "+d.name+": "+d.message)):c.fatal("error: "+d.message+"\n"+d.stack),d;}return b},
toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};c.TimedHandler=function(a,b){this.period=a;this.handler=b;this.lastCalled=(new Date).getTime();this.user=!0};c.TimedHandler.prototype={run:function(){this.lastCalled=(new Date).getTime();return this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};c.Connection=function(a,b){this.service=a;this.options=b||{};
var d=this.options.protocol||"";0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===d.indexOf("ws")?this._proto=new c.Websocket(this):this._proto=new c.Bosh(this);this.jid="";this.features=this.domain=null;this._sasl_data={};this.do_bind=this.do_session=!1;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._authentication={};this._disconnectTimeout=this._idleTimeout=null;this.disconnecting=this.connected=this.authenticated=!1;
this.do_authentication=!0;this.restored=this.paused=!1;this._data=[];this._uniqueId=0;this._sasl_challenge_handler=this._sasl_failure_handler=this._sasl_success_handler=null;this.maxRetries=5;this._idleTimeout=setTimeout(this._onIdle.stropheBind(this),100);for(var e in c._connectionPlugins)c._connectionPlugins.hasOwnProperty(e)&&(d=function(){},d.prototype=c._connectionPlugins[e],this[e]=new d,this[e].init(this))};c.Connection.prototype={reset:function(){this._proto._reset();this.do_bind=this.do_session=
!1;this.timedHandlers=[];this.handlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._authentication={};this.restored=this.disconnecting=this.connected=this.authenticated=!1;this._data=[];this._requests=[];this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,d,e,f,l,h){this.jid=a;this.authzid=
c.getBareJidFromJid(this.jid);this.authcid=h||c.getNodeFromJid(this.jid);this.pass=b;this.servtype="xmpp";this.connect_callback=d;this.restored=this.authenticated=this.connected=this.disconnecting=!1;this.domain=c.getDomainFromJid(this.jid);this._changeConnectStatus(c.Status.CONNECTING,null);this._proto._connect(e,f,l)},attach:function(a,b,d,e,f,l,h){if(this._proto instanceof c.Bosh)this._proto._attach(a,b,d,e,f,l,h);else throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};
},restore:function(a,b,c,e,d){if(this._sessionCachingSupported())this._proto._restore(a,b,c,e,d);else throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};},_sessionCachingSupported:function(){if(this._proto instanceof c.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(a){return!1}return!0}return!1},xmlInput:function(a){},xmlOutput:function(a){},rawInput:function(a){},
rawOutput:function(a){},send:function(a){if(null!==a){if("function"===typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else"function"===typeof a.tree?this._queueData(a.tree()):this._queueData(a);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout);this._onIdle()},sendIQ:function(a,b,d,e){var f=null,l=this;"function"===typeof a.tree&&(a=a.tree());var h=a.getAttribute("id");h||(h=this.getUniqueId("sendIQ"),a.setAttribute("id",h));var g=a.getAttribute("to"),n=this.jid,
q=this.addHandler(function(a){f&&l.deleteTimedHandler(f);var e=!1,h=a.getAttribute("from");if(h===g||null===g&&(h===c.getBareJidFromJid(n)||h===c.getDomainFromJid(n)||h===n))e=!0;if(!e)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+h+"\nExpected jid: "+g};e=a.getAttribute("type");if("result"==e)b&&b(a);else if("error"==e)d&&d(a);else throw{name:"StropheError",message:"Got bad IQ type of "+e};},null,"iq",["error","result"],h);e&&(f=this.addTimedHandler(e,function(){l.deleteHandler(q);
d&&d(null);return!1}));this.send(a);return h},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart");this._proto._sendRestart();this._idleTimeout=setTimeout(this._onIdle.stropheBind(this),100)},addTimedHandler:function(a,b){var d=new c.TimedHandler(a,b);this.addTimeds.push(d);return d},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,
b,d,e,f,g,h){a=new c.Handler(a,b,d,e,f,g,h);this.addHandlers.push(a);return a},deleteHandler:function(a){this.removeHandlers.push(a);a=this.addHandlers.indexOf(a);0<=a&&this.addHandlers.splice(a,1)},disconnect:function(a){this._changeConnectStatus(c.Status.DISCONNECTING,a);c.info("Disconnect was called because: "+a);this.connected?(a=!1,this.disconnecting=!0,this.authenticated&&(a=n({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3E3,this._onDisconnectTimeout.stropheBind(this)),
this._proto._disconnect(a)):(c.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests())},_changeConnectStatus:function(a,b){for(var d in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(d)){var e=this[d];if(e.statusChanged)try{e.statusChanged(a,b)}catch(f){c.error(""+d+" plugin caused an exception changing status: "+f)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){c.error("User connection callback caused an exception: "+g)}},
_doDisconnect:function(a){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout);null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null);c.info("_doDisconnect was called");this._proto._doDisconnect();this.restored=this.disconnecting=this.authenticated=!1;this.handlers=[];this.timedHandlers=[];this.removeTimeds=[];this.removeHandlers=[];this.addTimeds=[];this.addHandlers=[];this._changeConnectStatus(c.Status.DISCONNECTED,a);this.connected=
!1},_dataRecv:function(a,b){c.info("_dataRecv called");var d=this._proto._reqToData(a);if(null!==d){this.xmlInput!==c.Connection.prototype.xmlInput&&(d.nodeName===this._proto.strip&&d.childNodes.length?this.xmlInput(d.childNodes[0]):this.xmlInput(d));this.rawInput!==c.Connection.prototype.rawInput&&(b?this.rawInput(b):this.rawInput(c.serialize(d)));for(var e;0<this.removeHandlers.length;)e=this.removeHandlers.pop(),e=this.handlers.indexOf(e),0<=e&&this.handlers.splice(e,1);for(;0<this.addHandlers.length;)this.handlers.push(this.addHandlers.pop());
if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else if(e=d.getAttribute("type"),null!==e&&"terminate"==e)this.disconnecting||(e=d.getAttribute("condition"),d=d.getElementsByTagName("conflict"),null!==e?("remote-stream-error"==e&&0<d.length&&(e="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,e)):this._changeConnectStatus(c.Status.CONNFAIL,"unknown"),this._doDisconnect(e));else{var f=this;c.forEachChild(d,null,function(a){var b,d;d=f.handlers;f.handlers=[];for(b=0;b<d.length;b++){var e=
d[b];try{!e.isMatch(a)||!f.authenticated&&e.user?f.handlers.push(e):e.run(a)&&f.handlers.push(e)}catch(k){c.warn("Removing Strophe handlers due to uncaught exception: "+k.message)}}})}}},mechanisms:{},_connect_cb:function(a,b,d){c.info("_connect_cb was called");this.connected=!0;if(a=this._proto._reqToData(a))if(this.xmlInput!==c.Connection.prototype.xmlInput&&(a.nodeName===this._proto.strip&&a.childNodes.length?this.xmlInput(a.childNodes[0]):this.xmlInput(a)),this.rawInput!==c.Connection.prototype.rawInput&&
(d?this.rawInput(d):this.rawInput(c.serialize(a))),this._proto._connect_cb(a)!==c.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1;this._authentication.sasl_plain=!1;this._authentication.sasl_digest_md5=!1;this._authentication.sasl_anonymous=!1;this._authentication.legacy_auth=!1;var e;e=a.getElementsByTagNameNS?0<a.getElementsByTagNameNS(c.NS.STREAM,"features").length:0<a.getElementsByTagName("stream:features").length||0<a.getElementsByTagName("features").length;d=a.getElementsByTagName("mechanism");
var f=[],g;g=!1;if(e){if(0<d.length)for(e=0;e<d.length;e++)g=c.getText(d[e]),this.mechanisms[g]&&f.push(this.mechanisms[g]);this._authentication.legacy_auth=0<a.getElementsByTagName("auth").length;(g=this._authentication.legacy_auth||0<f.length)?!1!==this.do_authentication&&this.authenticate(f):this._proto._no_auth_received(b)}else this._proto._no_auth_received(b)}},authenticate:function(a){var b;for(b=0;b<a.length-1;++b){for(var f=b,e=b+1;e<a.length;++e)a[e].prototype.priority>a[f].prototype.priority&&
(f=e);f!=b&&(e=a[b],a[b]=a[f],a[f]=e)}f=!1;for(b=0;b<a.length;++b)if(a[b].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.stropheBind(this),null,"success",null,null);this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.stropheBind(this),null,"failure",null,null);this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.stropheBind(this),null,"challenge",null,null);this._sasl_mechanism=new a[b];this._sasl_mechanism.onStart(this);a=d("auth",
{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});this._sasl_mechanism.isClientFirst&&(b=this._sasl_mechanism.onChallenge(this,null),a.t(q.encode(b)));this.send(a.tree());f=!0;break}f||(null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.stropheBind(this),null,null,null,"_auth_1"),this.send(g({type:"get",
to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(a){a=q.decode(c.getText(a));a=this._sasl_mechanism.onChallenge(this,a);var b=d("response",{xmlns:c.NS.SASL});""!==a&&b.t(q.encode(a));this.send(b.tree());return!0},_auth1_cb:function(a){a=g({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);c.getResourceFromJid(this.jid)||
(this.jid=c.getBareJidFromJid(this.jid)+"/strophe");a.up().c("resource",{}).t(c.getResourceFromJid(this.jid));this._addSysHandler(this._auth2_cb.stropheBind(this),null,null,null,"_auth_2");this.send(a.tree());return!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var b;a=q.decode(c.getText(a)).match(/([a-z]+)=([^,]+)(,|$)/);"v"==a[1]&&(b=a[2]);if(b!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&
(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}c.info("SASL authentication succeeded.");if(this._sasl_mechanism)this._sasl_mechanism.onSuccess();this.deleteHandler(this._sasl_failure_handler);this._sasl_failure_handler=null;this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var d=[],e=function(a,b){for(;a.length;)this.deleteHandler(a.pop());this._sasl_auth1_cb.stropheBind(this)(b);
return!1};d.push(this._addSysHandler(function(a){e.stropheBind(this)(d,a)}.stropheBind(this),null,"stream:features",null,null));d.push(this._addSysHandler(function(a){e.stropheBind(this)(d,a)}.stropheBind(this),c.NS.STREAM,"features",null,null));this._sendRestart();return!1},_sasl_auth1_cb:function(a){this.features=a;var b,d;for(b=0;b<a.childNodes.length;b++)d=a.childNodes[b],"bind"==d.nodeName&&(this.do_bind=!0),"session"==d.nodeName&&(this.do_session=!0);this.do_bind?(this._addSysHandler(this._sasl_bind_cb.stropheBind(this),
null,null,null,"_bind_auth_2"),(a=c.getResourceFromJid(this.jid))?this.send(g({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(a).tree()):this.send(g({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree())):this._changeConnectStatus(c.Status.AUTHFAIL,null);return!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){c.info("SASL binding failed.");var b;0<a.getElementsByTagName("conflict").length&&(b="conflict");this._changeConnectStatus(c.Status.AUTHFAIL,
b);return!1}a=a.getElementsByTagName("bind");if(0<a.length)a=a[0].getElementsByTagName("jid"),0<a.length&&(this.jid=c.getText(a[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.stropheBind(this),null,null,null,"_session_auth_2"),this.send(g({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)));else return c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),
!1},_sasl_session_cb:function(a){"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null));return!1},_sasl_failure_cb:function(a){this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null);this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=
null);if(this._sasl_mechanism)this._sasl_mechanism.onFailure();this._changeConnectStatus(c.Status.AUTHFAIL,null);return!1},_auth2_cb:function(a){"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null),this.disconnect("authentication failed"));return!1},_addSysTimedHandler:function(a,b){var d=new c.TimedHandler(a,b);d.user=!1;this.addTimeds.push(d);return d},_addSysHandler:function(a,
b,d,e,f){a=new c.Handler(a,b,d,e,f);a.user=!1;this.addHandlers.push(a);return a},_onDisconnectTimeout:function(){c.info("_onDisconnectTimeout was called");this._proto._onDisconnectTimeout();this._doDisconnect();return!1},_onIdle:function(){for(var a,b,c,d;0<this.addTimeds.length;)this.timedHandlers.push(this.addTimeds.pop());for(;0<this.removeTimeds.length;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),0<=a&&this.timedHandlers.splice(a,1);var f=(new Date).getTime();d=[];for(a=0;a<this.timedHandlers.length;a++)if(b=
this.timedHandlers[a],this.authenticated||!b.user)c=b.lastCalled+b.period,0>=c-f?b.run()&&d.push(b):d.push(b);this.timedHandlers=d;clearTimeout(this._idleTimeout);this._proto._onIdle();this.connected&&(this._idleTimeout=setTimeout(this._onIdle.stropheBind(this),100))}};c.SASLMechanism=function(a,b,c){this.name=a;this.isClientFirst=b;this.priority=c};c.SASLMechanism.prototype={test:function(a){return!0},onStart:function(a){this._connection=a},onChallenge:function(a,b){throw Error("You should implement challenge handling!");
},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}};c.SASLAnonymous=function(){};c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",!1,10);c.SASLAnonymous.test=function(a){return null===a.authcid};c.Connection.prototype.mechanisms[c.SASLAnonymous.prototype.name]=c.SASLAnonymous;c.SASLPlain=function(){};c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",!0,20);c.SASLPlain.test=function(a){return null!==a.authcid};c.SASLPlain.prototype.onChallenge=function(a){var b=
a.authzid,b=b+"\x00"+a.authcid,b=b+"\x00";return b+=a.pass};c.Connection.prototype.mechanisms[c.SASLPlain.prototype.name]=c.SASLPlain;c.SASLSHA1=function(){};c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",!0,40);c.SASLSHA1.test=function(a){return null!==a.authcid};c.SASLSHA1.prototype.onChallenge=function(a,c,d){c=d||b.hexdigest(1234567890*Math.random());d="n="+a.authcid;d=d+",r="+c;a._sasl_data.cnonce=c;a._sasl_data["client-first-message-bare"]=d;d="n,,"+d;this.onChallenge=function(a,b){var d,
c,g,k,n,r="c=biws,",p=a._sasl_data["client-first-message-bare"]+","+b+",";n=a._sasl_data.cnonce;for(k=/([a-z]+)=([^,]+)(,|$)/;b.match(k);){var s=b.match(k);b=b.replace(s[0],"");switch(s[1]){case "r":d=s[2];break;case "s":c=s[2];break;case "i":g=s[2]}}if(d.substr(0,n.length)!==n)return a._sasl_data={},a._sasl_failure_cb();r+="r="+d;p+=r;c=q.decode(c);d=c=f.core_hmac_sha1(a.pass,c+"\x00\x00\x00\u0001");for(n=1;n<g;n++){k=f.core_hmac_sha1(a.pass,f.binb2str(c));for(c=0;5>c;c++)d[c]^=k[c];c=k}d=f.binb2str(d);
g=f.core_hmac_sha1(d,"Client Key");c=f.str_hmac_sha1(d,"Server Key");d=f.core_hmac_sha1(f.str_sha1(f.binb2str(g)),p);a._sasl_data["server-signature"]=f.b64_hmac_sha1(c,p);for(c=0;5>c;c++)g[c]^=d[c];return r+=",p="+q.encode(f.binb2str(g))}.stropheBind(this);return d};c.Connection.prototype.mechanisms[c.SASLSHA1.prototype.name]=c.SASLSHA1;c.SASLMD5=function(){};c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",!1,30);c.SASLMD5.test=function(a){return null!==a.authcid};c.SASLMD5.prototype._quote=
function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'};c.SASLMD5.prototype.onChallenge=function(a,c,d){var e=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;d=d||b.hexdigest(""+1234567890*Math.random());for(var f="",g=null,h="",n;c.match(e);)switch(n=c.match(e),c=c.replace(n[0],""),n[2]=n[2].replace(/^"(.+)"$/,"$1"),n[1]){case "realm":f=n[2];break;case "nonce":h=n[2];break;case "host":g=n[2]}c=a.servtype+"/"+a.domain;null!==g&&(c=c+"/"+g);e=b.hash(a.authcid+":"+f+":"+this._connection.pass)+":"+
h+":"+d;g="AUTHENTICATE:"+c;a="charset=utf-8,"+("username="+this._quote(a.authcid)+",");a+="realm="+this._quote(f)+",";a+="nonce="+this._quote(h)+",";a+="nc=00000001,";a+="cnonce="+this._quote(d)+",";a+="digest-uri="+this._quote(c)+",";a+="response="+b.hexdigest(b.hexdigest(e)+":"+h+":00000001:"+d+":auth:"+b.hexdigest(g))+",";a+="qop=auth";this.onChallenge=function(){return""}.stropheBind(this);return a};c.Connection.prototype.mechanisms[c.SASLMD5.prototype.name]=c.SASLMD5;return{Strophe:c,$build:d,
$msg:function(a){return new c.Builder("message",a)},$iq:g,$pres:n,SHA1:f,Base64:q,MD5:b}});(function(f,q){if("function"===typeof define&&define.amd)define("strophe-bosh",["strophe-core"],function(b){return q(b.Strophe,b.$build)});else return q(Strophe,$build)})(this,function(f,q){f.Request=function(b,d,g,n){this.id=++f._requestId;this.xmlData=b;this.data=f.serialize(b);this.func=this.origFunc=d;this.rid=g;this.date=NaN;this.sends=n||0;this.abort=!1;this.dead=null;this.age=function(){return this.date?
(new Date-this.date)/1E3:0};this.timeDead=function(){return this.dead?(new Date-this.dead)/1E3:0};this.xhr=this._newXHR()};f.Request.prototype={getResponse:function(){var b=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(b=this.xhr.responseXML.documentElement,"parsererror"==b.tagName)throw f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)),"parsererror";}else this.xhr.responseText&&
(f.error("invalid response received"),f.error("responseText: "+this.xhr.responseText),f.error("responseXML: "+f.serialize(this.xhr.responseXML)));return b},_newXHR:function(){var b=null;window.XMLHttpRequest?(b=new XMLHttpRequest,b.overrideMimeType&&b.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(b=new ActiveXObject("Microsoft.XMLHTTP"));b.onreadystatechange=this.func.stropheBind(null,this);return b}};f.Bosh=function(b){this._conn=b;this.rid=Math.floor(4294967295*Math.random());
this.sid=null;this.hold=1;this.wait=60;this.window=5;this.errors=0;this._requests=[]};f.Bosh.prototype={strip:null,_buildBody:function(){var b=q("body",{rid:this.rid++,xmlns:f.NS.HTTPBIND});null!==this.sid&&b.attrs({sid:this.sid});this._conn.options.keepalive&&this._cacheSession();return b},_reset:function(){this.rid=Math.floor(4294967295*Math.random());this.sid=null;this.errors=0;window.sessionStorage.removeItem("strophe-bosh-session")},_connect:function(b,d,g){this.wait=b||this.wait;this.hold=d||
this.hold;this.errors=0;b=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":f.NS.BOSH});g&&b.attrs({route:g});g=this._conn._connect_cb;this._requests.push(new f.Request(b.tree(),this._onRequestStateChange.stropheBind(this,g.stropheBind(this._conn)),b.tree().getAttribute("rid")));this._throttledRequestHandler()},_attach:function(b,d,g,n,c,a,k){this._conn.jid=b;this.sid=d;this.rid=
g;this._conn.connect_callback=n;this._conn.domain=f.getDomainFromJid(this._conn.jid);this._conn.authenticated=!0;this._conn.connected=!0;this.wait=c||this.wait;this.hold=a||this.hold;this.window=k||this.window;this._conn._changeConnectStatus(f.Status.ATTACHED,null)},_restore:function(b,d,g,n,c){var a=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if("undefined"!==typeof a&&null!==a&&a.rid&&a.sid&&a.jid&&("undefined"===typeof b||f.getBareJidFromJid(a.jid)==f.getBareJidFromJid(b)))this._conn.restored=
!0,this._attach(a.jid,a.sid,a.rid,d,g,n,c);else throw{name:"StropheSessionError",message:"_restore: no restoreable session."};},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(b){var d=b.getAttribute("type");if(null!==d&&"terminate"==d)return d=b.getAttribute("condition"),
f.error("BOSH-Connection failed: "+d),b=b.getElementsByTagName("conflict"),null!==d?("remote-stream-error"==d&&0<b.length&&(d="conflict"),this._conn._changeConnectStatus(f.Status.CONNFAIL,d)):this._conn._changeConnectStatus(f.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(d),f.Status.CONNFAIL;this.sid||(this.sid=b.getAttribute("sid"));if(d=b.getAttribute("requests"))this.window=parseInt(d,10);if(d=b.getAttribute("hold"))this.hold=parseInt(d,10);if(b=b.getAttribute("wait"))this.wait=parseInt(b,
10)},_disconnect:function(b){this._sendTerminate(b)},_doDisconnect:function(){this.sid=null;this.rid=Math.floor(4294967295*Math.random());window.sessionStorage.removeItem("strophe-bosh-session")},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(b){this.errors++;f.warn("request errored, status: "+b+", number of errors: "+this.errors);4<this.errors&&this._conn._onDisconnectTimeout()},_no_auth_received:function(b){b=b?b.stropheBind(this._conn):this._conn._connect_cb.stropheBind(this._conn);
var d=this._buildBody();this._requests.push(new f.Request(d.tree(),this._onRequestStateChange.stropheBind(this,b.stropheBind(this._conn)),d.tree().getAttribute("rid")));this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var b;0<this._requests.length;)b=this._requests.pop(),b.abort=!0,b.xhr.abort(),b.xhr.onreadystatechange=function(){}},_onIdle:function(){var b=this._conn._data;this._conn.authenticated&&0===this._requests.length&&
0===b.length&&!this._conn.disconnecting&&(f.info("no requests during idle cycle, sending blank request"),b.push(null));if(!this._conn.paused){if(2>this._requests.length&&0<b.length){for(var d=this._buildBody(),g=0;g<b.length;g++)null!==b[g]&&("restart"===b[g]?d.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":f.NS.BOSH}):d.cnode(b[g]).up());delete this._conn._data;this._conn._data=[];this._requests.push(new f.Request(d.tree(),this._onRequestStateChange.stropheBind(this,
this._conn._dataRecv.stropheBind(this._conn)),d.tree().getAttribute("rid")));this._throttledRequestHandler()}0<this._requests.length&&(b=this._requests[0].age(),null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),b>Math.floor(f.TIMEOUT*this.wait)&&(f.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(f.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler()))}},_onRequestStateChange:function(b,
d){f.debug("request id "+d.id+"."+d.sends+" state changed to "+d.xhr.readyState);if(d.abort)d.abort=!1;else{var g;if(4==d.xhr.readyState){g=0;try{g=d.xhr.status}catch(n){}"undefined"==typeof g&&(g=0);if(this.disconnecting&&400<=g)this._hitError(g);else{var c=this._requests[0]==d,a=this._requests[1]==d;if(0<g&&500>g||5<d.sends)this._removeRequest(d),f.debug("request id "+d.id+" should now be removed");if(200==g)(a||c&&0<this._requests.length&&this._requests[0].age()>Math.floor(f.SECONDARY_TIMEOUT*
this.wait))&&this._restartRequest(0),f.debug("request id "+d.id+"."+d.sends+" got 200"),b(d),this.errors=0;else if(f.error("request id "+d.id+"."+d.sends+" error "+g+" happened"),0===g||400<=g&&600>g||12E3<=g)this._hitError(g),400<=g&&500>g&&(this._conn._changeConnectStatus(f.Status.DISCONNECTING,null),this._conn._doDisconnect());0<g&&500>g||5<d.sends||this._throttledRequestHandler()}}}},_processRequest:function(b){var d=this,g=this._requests[b],n=-1;try{4==g.xhr.readyState&&(n=g.xhr.status)}catch(c){f.error("caught an error in _requests["+
b+"], reqStatus: "+n)}"undefined"==typeof n&&(n=-1);if(g.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var a=g.age(),a=!isNaN(a)&&a>Math.floor(f.TIMEOUT*this.wait),k=null!==g.dead&&g.timeDead()>Math.floor(f.SECONDARY_TIMEOUT*this.wait),n=4==g.xhr.readyState&&(1>n||500<=n);if(a||k||n)k&&f.error("Request "+this._requests[b].id+" timed out (secondary), restarting"),g.abort=!0,g.xhr.abort(),g.xhr.onreadystatechange=function(){},this._requests[b]=new f.Request(g.xmlData,g.origFunc,
g.rid,g.sends),g=this._requests[b];if(0===g.xhr.readyState){f.debug("request id "+g.id+"."+g.sends+" posting");try{g.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0),g.xhr.setRequestHeader&&g.xhr.setRequestHeader("Content-Type","text/xml; charset=utf-8")}catch(q){f.error("XHR open failed.");this._conn.connected||this._conn._changeConnectStatus(f.Status.CONNFAIL,"bad-service");this._conn.disconnect();return}b=function(){g.date=new Date;if(d._conn.options.customHeaders){var a=d._conn.options.customHeaders,
b;for(b in a)a.hasOwnProperty(b)&&g.xhr.setRequestHeader(b,a[b])}g.xhr.send(g.data)};1<g.sends?(n=1E3*Math.min(Math.floor(f.TIMEOUT*this.wait),Math.pow(g.sends,3)),setTimeout(b,n)):b();g.sends++;this._conn.xmlOutput!==f.Connection.prototype.xmlOutput&&(g.xmlData.nodeName===this.strip&&g.xmlData.childNodes.length?this._conn.xmlOutput(g.xmlData.childNodes[0]):this._conn.xmlOutput(g.xmlData));this._conn.rawOutput!==f.Connection.prototype.rawOutput&&this._conn.rawOutput(g.data)}else f.debug("_processRequest: "+
(0===b?"first":"second")+" request has readyState of "+g.xhr.readyState)}},_removeRequest:function(b){f.debug("removing request");var d;for(d=this._requests.length-1;0<=d;d--)b==this._requests[d]&&this._requests.splice(d,1);b.xhr.onreadystatechange=function(){};this._throttledRequestHandler()},_restartRequest:function(b){var d=this._requests[b];null===d.dead&&(d.dead=new Date);this._processRequest(b)},_reqToData:function(b){try{return b.getResponse()}catch(d){if("parsererror"!=d)throw d;this._conn.disconnect("strophe-parsererror")}},
_sendTerminate:function(b){f.info("_sendTerminate was called");var d=this._buildBody().attrs({type:"terminate"});b&&d.cnode(b.tree());b=new f.Request(d.tree(),this._onRequestStateChange.stropheBind(this,this._conn._dataRecv.stropheBind(this._conn)),d.tree().getAttribute("rid"));this._requests.push(b);this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout);this._throttledRequestHandler();this._conn._idleTimeout=setTimeout(this._conn._onIdle.stropheBind(this._conn),100)},
_sendRestart:function(){this._throttledRequestHandler();clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?f.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):f.debug("_throttledRequestHandler called with undefined requests");this._requests&&0!==this._requests.length&&(0<this._requests.length&&this._processRequest(0),1<this._requests.length&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}};
return f});(function(f,q){if("function"===typeof define&&define.amd)define("strophe-websocket",["strophe-core"],function(b){return q(b.Strophe,b.$build)});else return q(Strophe,$build)})(this,function(f,q){f.Websocket=function(b){this._conn=b;this.strip="wrapper";var d=b.service;if(0!==d.indexOf("ws:")&&0!==d.indexOf("wss:")){var f="",f="ws"===b.options.protocol&&"https:"!==window.location.protocol?f+"ws":f+"wss",f=f+("://"+window.location.host),f=0!==d.indexOf("/")?f+(window.location.pathname+d):
f+d;b.service=f}};f.Websocket.prototype={_buildStream:function(){return q("open",{xmlns:f.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(b,d){var g;g=b.getElementsByTagNameNS?b.getElementsByTagNameNS(f.NS.STREAM,"error"):b.getElementsByTagName("stream:error");if(0===g.length)return!1;for(var n=g[0],c=g="",a=0;a<n.childNodes.length;a++){var k=n.childNodes[a];if("urn:ietf:params:xml:ns:xmpp-streams"!==k.getAttribute("xmlns"))break;"text"===k.nodeName?c=k.textContent:g=
k.nodeName}n="WebSocket stream error: ";n=g?n+g:n+"unknown";c&&(n+=" - "+g);f.error(n);this._conn._changeConnectStatus(d,g);this._conn._doDisconnect();return!0},_reset:function(){},_connect:function(){this._closeSocket();this.socket=new WebSocket(this._conn.service,"xmpp");this.socket.onopen=this._onOpen.stropheBind(this);this.socket.onerror=this._onError.stropheBind(this);this.socket.onclose=this._onClose.stropheBind(this);this.socket.onmessage=this._connect_cb_wrapper.stropheBind(this)},_connect_cb:function(b){if(this._check_streamerror(b,
f.Status.CONNFAIL))return f.Status.CONNFAIL},_handleStreamStart:function(b){var d=!1,g=b.getAttribute("xmlns");"string"!==typeof g?d="Missing xmlns in <open />":g!==f.NS.FRAMING&&(d="Wrong xmlns in <open />: "+g);b=b.getAttribute("version");"string"!==typeof b?d="Missing version in <open />":"1.0"!==b&&(d="Wrong version in <open />: "+b);return d?(this._conn._changeConnectStatus(f.Status.CONNFAIL,d),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(b){if(0===b.data.indexOf("<open ")||
0===b.data.indexOf("<?xml")){var d=b.data.replace(/^(<\?.*?\?>\s*)*/,"");""!==d&&(d=(new DOMParser).parseFromString(d,"text/xml").documentElement,this._conn.xmlInput(d),this._conn.rawInput(b.data),this._handleStreamStart(d)&&this._connect_cb(d))}else 0===b.data.indexOf("<close ")?(this._conn.rawInput(b.data),this._conn.xmlInput(b),(b=b.getAttribute("see-other-uri"))?(this._conn._changeConnectStatus(f.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=
b,this._connect()):(this._conn._changeConnectStatus(f.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())):(d=this._streamWrap(b.data),d=(new DOMParser).parseFromString(d,"text/xml").documentElement,this.socket.onmessage=this._onMessage.stropheBind(this),this._conn._connect_cb(d,null,b.data))},_disconnect:function(b){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){b&&this._conn.send(b);b=q("close",{xmlns:f.NS.FRAMING});this._conn.xmlOutput(b);b=f.serialize(b);this._conn.rawOutput(b);
try{this.socket.send(b)}catch(d){f.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){f.info("WebSockets _doDisconnect was called");this._closeSocket()},_streamWrap:function(b){return"<wrapper>"+b+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(b){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(f.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):
f.info("Websocket closed")},_no_auth_received:function(b){f.error("Server did not send any auth methods");this._conn._changeConnectStatus(f.Status.CONNFAIL,"Server did not send any auth methods");b&&(b=b.stropheBind(this._conn),b());this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(b){f.error("Websocket error "+b);this._conn._changeConnectStatus(f.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected.");this._disconnect()},
_onIdle:function(){var b=this._conn._data;if(0<b.length&&!this._conn.paused){for(var d=0;d<b.length;d++)if(null!==b[d]){var g,n;g="restart"===b[d]?this._buildStream().tree():b[d];n=f.serialize(g);this._conn.xmlOutput(g);this._conn.rawOutput(n);this.socket.send(n)}this._conn._data=[]}},_onMessage:function(b){var d;if('<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />'===b.data)this._conn.rawInput('<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />'),this._conn.xmlInput(b),this._conn.disconnecting||
this._conn._doDisconnect();else{if(0===b.data.search("<open ")){if(d=(new DOMParser).parseFromString(b.data,"text/xml").documentElement,!this._handleStreamStart(d))return}else d=this._streamWrap(b.data),d=(new DOMParser).parseFromString(d,"text/xml").documentElement;this._check_streamerror(d,f.Status.ERROR)||(this._conn.disconnecting&&"presence"===d.firstChild.nodeName&&"unavailable"===d.firstChild.getAttribute("type")?(this._conn.xmlInput(d),this._conn.rawInput(f.serialize(d))):this._conn._dataRecv(d,
b.data))}},_onOpen:function(){f.info("Websocket open");var b=this._buildStream();this._conn.xmlOutput(b.tree());b=f.serialize(b);this._conn.rawOutput(b);this.socket.send(b)},_reqToData:function(b){return b},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout);this._conn._onIdle.stropheBind(this._conn)()}};return f});if(s)return s(Strophe,$build,$msg,$iq,$pres)})(function(s,f,q,b,d){window.Strophe=s;window.$build=f;window.$msg=q;window.$iq=b;window.$pres=
d});

/* resmerge themes/webim/static/sdk/strophe.js end */
/* resmerge themes/webim/static/sdk/easemob.im-1.1.js start */
(function(l,C){if("undefined"===typeof Strophe)throw"need Strophe";var n=n||{};n.im=n.im||{};n.im.version="1.1";var J="https:"===location.protocol;l.URL=l.URL||l.webkitURL||l.mozURL||l.msURL;Strophe.Websocket.prototype._closeSocket=function(){var g=this;g.socket?setTimeout(function(){try{g.socket.close()}catch(h){}},0):g.socket=null};var m=function(){l.XDomainRequest&&(XDomainRequest.prototype.oldsend=XDomainRequest.prototype.send,XDomainRequest.prototype.send=function(){XDomainRequest.prototype.oldsend.apply(this,
arguments);this.readyState=2});Strophe.Request.prototype._newXHR=function(){var b=m.xmlrequest(!0);b.overrideMimeType&&b.overrideMimeType("text/xml");b.onreadystatechange=this.func.stropheBind(null,this);return b};var D=function(b){b=b||!0;var d;try{d=new l.XMLHttpRequest}catch(a){d=!1}if(!d)try{d=new l.ActiveXObject("Microsoft.XMLHTTP")}catch(e){d=!1}if("withCredentials"in d||!b||"undefined"===typeof l.XDomainRequest)return d;var c=new XDomainRequest;c.readyState=0;c.status=100;c.onreadystatechange=
g;c.onload=function(){c.readyState=4;c.status=200;var a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(c.responseText);c.responseXML=a;c.response=c.responseText;c.onreadystatechange()};c.ontimeout=c.onerror=function(){c.readyState=4;c.status=500;c.onreadystatechange()};return c},h=function(){if("ActiveXObject"in l)try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(b){}else if(navigator.plugins&&0<navigator.plugins.length)return navigator.plugins["Shockwave Flash"];
return 0}(),k=D(),v="undefined"!==typeof FormData,w="undefined"!==typeof Blob,r=k.setRequestHeader||!1,k=k.overrideMimeType||!1,s=r&&v;return{hasFormData:v,hasBlob:w,isCanSetRequestHeader:r,hasOverrideMimeType:k,isCanUploadFileAsync:s,isCanUploadFile:s||h,isCanDownLoadFile:r&&(w||k),isSupportWss:function(){var b=[/MQQBrowser[\/]5([.]\d+)?\sTBS/];if(!l.WebSocket)return!1;for(var d=l.navigator.userAgent,a=0,e=b.length;a<e;a++)if(b[a].test(d))return!1;return!0}(),stringify:function(b){if("undefined"!==
typeof JSON&&JSON.stringify)return JSON.stringify(b);var d="",a=[],e=function(c){var b=!1;"[object Array]"===Object.prototype.toString.call(c)?(a.push("]","["),b=!0):"[object Object]"===Object.prototype.toString.call(c)&&a.push("}","{");for(var f in c)"[object Null]"===Object.prototype.toString.call(c[f])?c[f]="null":"[object Undefined]"===Object.prototype.toString.call(c[f])&&(c[f]="undefined"),d=c[f]&&"object"===typeof c[f]?d+(","+(b?"":'"'+f+'":'+(b?'"':""))+e(c[f])+""):d+(',"'+(b?"":f+'":"')+
c[f]+'"');""!=d&&(d=d.slice(1));return a.pop()+d+a.pop()};return e(b)},registerUser:function(b){var d=b.orgName||"",a=b.appName||"",e=b.appKey||"";d||a||!e||(e=e.split("#"),2===e.length&&(d=e[0],a=e[1]));if(d||a){var c=b.https||c,d=(b.apiUrl||(c?"https":"http")+"://a1.easemob.com")+"/"+d+"/"+a+"/users",a=m.stringify({username:b.username,password:b.password,nickname:b.nickname||""});b={url:d,dataType:"json",data:a,success:b.success||g,error:b.error||g};return m.ajax(b)}b.error({type:EASEMOB_IM_RESISTERUSER_ERROR,
msg:"\u6ca1\u6709\u6307\u5b9a\u5f00\u53d1\u8005\u4fe1\u606f"})},login2UserGrid:function(b){b=b||{};var d=(b.appKey||"").split("#");if(2!==d.length)return p({type:EASEMOB_IM_CONNCTION_OPEN_USERGRID_ERROR,msg:"\u8bf7\u6307\u5b9a\u6b63\u786e\u7684\u5f00\u53d1\u8005\u4fe1\u606f(appKey)"}),!1;var a=d[0],d=d[1];if(!a||!d)return p({type:EASEMOB_IM_CONNCTION_OPEN_USERGRID_ERROR,msg:"\u8bf7\u6307\u5b9a\u6b63\u786e\u7684\u5f00\u53d1\u8005\u4fe1\u606f(appKey)"}),!1;var e=e||b.https,c=b.success||g,p=b.error||
g,e=b.apiUrl||(e?"https":"http")+"://a1.easemob.com";b=m.stringify({grant_type:"password",username:b.user||"",password:b.pwd||""});b={url:e+"/"+a+"/"+d+"/token",dataType:"json",data:b,success:c||g,error:p||g};return m.ajax(b)},getFileUrl:function(b){var d={url:"",filename:"",filetype:"",data:""},a=document.getElementById(b);if(!m.isCanUploadFileAsync||!a)return d;if(l.URL.createObjectURL)b=a.files,0<b.length&&(b=b.item(0),d.data=b,d.url=l.URL.createObjectURL(b),d.filename=b.name||"");else{b=document.getElementById(b).value;
d.url=b;var a=b.lastIndexOf("/"),e=b.lastIndexOf("\\"),a=Math.max(a,e);d.filename=0>a?b:b.substring(a+1)}b=d.filename.lastIndexOf(".");-1!=b&&(d.filetype=d.filename.substring(b+1).toLowerCase());return d},getFileSizeFn:function(b){b=document.getElementById(b);var d=0;b&&(b.files?0<b.files.length&&(d=b.files[0].size):b.select&&"ActiveXObject"in l&&(b.select(),b=(new ActiveXObject("Scripting.FileSystemObject")).GetFile(b.value),d=b.Size));return d},hasFlash:h,trim:function(b){b="string"===typeof b?
b:"";return b.trim?b.trim():b.replace(/^\s|\s$/g,"")},parseEmotions:function(b){if("undefined"!==typeof n.im.EMOTIONS&&"undefined"!==typeof n.im.EMOTIONS.map){var d=n.im.EMOTIONS;b=b.replace(/&amp;/g,"&");b=b.replace(/&#39;/g,"'");b=b.replace(/&lt;/g,"<");for(var a in d.map)if(d.map.hasOwnProperty(a))for(;-1<b.indexOf(a);)b=b.replace(a,'<img class="em-emotion" src="'+d.path+d.map[a]+'" alt="\u8868\u60c5">')}return b},parseLink:function(b){var d=/(https?\:\/\/|www\.)([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+)(\:[0-9]{2,4})?\/?((\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\/?)*\??[:_#@*&%0-9a-zA-Z-/=]*/gm,
a=b.match(d),e=a&&a[0]?a[0]:"";a&&a.length&&(a=/^https?:\/\//.test(e),b=b.replace(d,"<a href='"+(a?e:"//"+e)+"' target='_blank'>"+e+"</a>"));return b},parseJSON:function(b){if(l.JSON&&l.JSON.parse)return l.JSON.parse(b+"");var d,a=null,e=m.trim(b+"");return e&&!m.trim(e.replace(/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,function(e,b,f,q){d&&b&&(a=0);if(0===a)return e;d=f||b;a+=!q-!f;return""}))?Function("return "+
e)():Function("Invalid JSON: "+b)()},parseUploadResponse:function(b){return-1<b.indexOf("callback")?b.slice(9,-1):b},parseDownloadResponse:function(b){return b&&b.type&&"application/json"===b.type||0>Object.prototype.toString.call(b).indexOf("Blob")?this.url+"?token=":l.URL.createObjectURL(b)},uploadFile:function(b){b=b||{};b.onFileUploadProgress=b.onFileUploadProgress||g;b.onFileUploadComplete=b.onFileUploadComplete||g;b.onFileUploadError=b.onFileUploadError||g;b.onFileUploadCanceled=b.onFileUploadCanceled||
g;var d=b.accessToken||this.context.accessToken;if(d){orgName=b.orgName||this.context.orgName||"";appName=b.appName||this.context.appName||"";appKey=b.appKey||this.context.appKey||"";if(!orgName&&!appName&&appKey){var a=appKey.split("#");2==a.length&&(orgName=a[0],appName=a[1])}if(orgName||appName)if(a=(b.apiUrl||"//a1.easemob.com")+"/"+orgName+"/"+appName+"/chatfiles",m.isCanUploadFileAsync){var e=b.file.data?b.file.data.size:C;if(e>EASEMOB_IM_FILESIZE_LIMIT)b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,
msg:"\u4e0a\u4f20\u6587\u4ef6\u8d85\u8fc7\u670d\u52a1\u5668\u5927\u5c0f\u9650\u5236\uff0810M\uff09",id:b.id});else if(0>=e)b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,msg:"\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u4e3a0",id:b.id});else{var c=m.xmlrequest(),e=function(a){b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,msg:"\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25",id:b.id,xhr:c})};c.upload&&c.upload.addEventListener("progress",b.onFileUploadProgress,!1);c.addEventListener?(c.addEventListener("abort",
b.onFileUploadCanceled,!1),c.addEventListener("load",function(a){try{var e=m.parseJSON(c.responseText);b.onFileUploadComplete(e)}catch(d){b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,msg:"\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25,\u670d\u52a1\u7aef\u8fd4\u56de\u503c\u503c\u4e0d\u6b63\u786e",data:c.responseText,id:b.id,xhr:c})}},!1),c.addEventListener("error",e,!1)):c.onreadystatechange&&(c.onreadystatechange=function(){if(4===c.readyState)if(200===ajax.status)try{var a=m.parseJSON(c.responseText);
b.onFileUploadComplete(a)}catch(e){b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,msg:"\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25,\u670d\u52a1\u7aef\u8fd4\u56de\u503c\u4e0d\u6b63\u786e",data:c.responseText,id:b.id,xhr:c})}else b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,msg:"\u4e0a\u4f20\u6587\u4ef6\u5931\u8d25,\u670d\u52a1\u7aef\u8fd4\u56de\u5f02\u5e38",data:c.responseText,id:b.id,xhr:c});else c.abort(),b.onFileUploadCanceled()});c.open("POST",a);c.setRequestHeader("restrict-access","true");
c.setRequestHeader("Accept","*/*");c.setRequestHeader("Authorization","Bearer "+d);d=new FormData;d.append("file",b.file.data);c.send(d)}}else if(m.hasFlash&&"function"===typeof b.flashUpload)b.flashUpload&&b.flashUpload(a,b);else this.onError({type:EASEMOB_IM_UPLOADFILE_BROWSER_ERROR,msg:"\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5f02\u6b65\u4e0a\u4f20\uff01"});else b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_ERROR,msg:"\u6ca1\u6709\u6307\u5b9a\u5f00\u53d1\u8005\u4fe1\u606f",id:b.id})}else b.onFileUploadError({type:EASEMOB_IM_UPLOADFILE_NO_LOGIN,
msg:"\u7528\u6237\u672a\u767b\u5f55\u5230usergrid\u670d\u52a1\u5668,\u65e0\u6cd5\u4f7f\u7528\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd",id:b.id})},downloadFn:function(b){b.onFileDownloadComplete=b.onFileDownloadComplete||g;b.onFileDownloadError=b.onFileDownloadError||g;var d=b.accessToken||"";if(d){var a=function(a){b.onFileDownloadError({type:EASEMOB_IM_DOWNLOADFILE_ERROR,msg:"\u4e0b\u8f7d\u6587\u4ef6\u5931\u8d25",id:b.id,xhr:e})};if(m.isCanDownLoadFile){var e=m.xmlrequest();"addEventListener"in e?(e.addEventListener("load",
function(a){b.onFileDownloadComplete(e.response,e)},!1),e.addEventListener("error",a,!1)):"onreadystatechange"in e&&(e.onreadystatechange=function(){if(4===e.readyState)if(200===ajax.status)b.onFileDownloadComplete(e.response,e);else b.onFileDownloadError({type:EASEMOB_IM_DOWNLOADFILE_ERROR,msg:"\u4e0b\u8f7d\u6587\u4ef6\u5931\u8d25,\u670d\u52a1\u7aef\u8fd4\u56de\u5f02\u5e38",id:b.id,xhr:e});else e.abort(),b.onFileDownloadError({type:EASEMOB_IM_DOWNLOADFILE_ERROR,msg:"\u9519\u8bef\u7684\u4e0b\u8f7d\u72b6\u6001,\u9000\u51fa\u4e0b\u8f7d",
id:b.id,xhr:e})});var a=b.responseType||"blob",c=b.mimeType||"text/plain; charset=x-user-defined";e.open(b.method||"GET",b.url);"undefined"!==typeof Blob?e.responseType=a:e.overrideMimeType(c);var d={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":b.secret,Authorization:"Bearer "+d},a=b.headers||{},p;for(p in a)d[p]=a[p];for(p in d)d[p]&&e.setRequestHeader(p,d[p]);e.send(null)}else b.onFileDownloadComplete()}else b.onFileDownloadError({type:EASEMOB_IM_DOWNLOADFILE_NO_LOGIN,
msg:"\u7528\u6237\u672a\u767b\u5f55\u5230usergrid\u670d\u52a1\u5668,\u65e0\u6cd5\u4f7f\u7528\u6587\u4ef6\u4e0b\u8f7d\u529f\u80fd",id:b.id})},parseTextMessage:function(b,d){if("string"!==typeof b)conn.onError({type:EASEMOB_IM_MESSAGE_REC_TEXT_ERROR,msg:"\u4e0d\u5408\u6cd5\u7684\u6d88\u606f\u5185\u5bb9\u683c\u5f0f\uff0c\u8bf7\u68c0\u67e5\u53d1\u9001\u6d88\u606f\u5185\u5bb9\uff01"});else{if("[object Object]"!==Object.prototype.toString.call(d))return{isemotion:!1,body:[{type:"txt",data:b}]};var a=b,
e=[],c=a.match(/\[[^[\]]{2,3}\]/mg);if(!c||1>c.length)return{isemotion:!1,body:[{type:"txt",data:b}]};for(var p=!1,f=0;f<c.length;f++){var q=a.substring(0,a.indexOf(c[f])),u=n.im.EMOTIONS.map[c[f]];q&&e.push({type:"txt",data:q});u?((q=n.im.EMOTIONS.map?n.im.EMOTIONS.path+u:null)?(p=!0,e.push({type:"emotion",data:q})):e.push({type:"txt",data:c[f]}),q=a.indexOf(c[f])+c[f].length,a=a.substring(q)):e.push({type:"txt",data:c[f]})}a&&e.push({type:"txt",data:a});return p?{isemotion:p,body:e}:{isemotion:!1,
body:[{type:"txt",data:b}]}}},xmlrequest:D,ajax:function(b){var d=b.dataType||"text",a=b.success||g,e=b.error||g,c=m.xmlrequest();c.onreadystatechange=function(){if(4===c.readyState)if(200===(c.status||0))if("text"===d)a(c.responseText,c);else if("json"===d)try{var b=m.parseJSON(c.responseText);a(b,c)}catch(f){e(c.responseText,c,"\u9519\u8bef\u7684\u6570\u636e,\u65e0\u6cd5\u8f6c\u6362\u4e3ajson")}else"xml"===d?c.responseXML&&c.responseXML.documentElement?a(c.responseXML.documentElement,c):e(c.responseText,
c,"\u6d4f\u89c8\u5668\u4e0d\u652f\u6301ajax\u8fd4\u56dexml\u5bf9\u8c61"):a(c.response||c.responseText,c);else if("json"===d)try{b=m.parseJSON(c.responseText),e(b,c,"\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\u4fe1\u606f")}catch(p){e(c.responseText,c,"\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\u4fe1\u606f")}else"xml"===d?c.responseXML&&c.responseXML.documentElement?e(c.responseXML.documentElement,c,"\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\u4fe1\u606f"):e(c.responseText,c,"\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\u4fe1\u606f"):
e(c.responseText,c,"\u670d\u52a1\u5668\u8fd4\u56de\u9519\u8bef\u4fe1\u606f");else 0===c.readyState&&e(c.responseText,c,"\u670d\u52a1\u5668\u5f02\u5e38")};if(b.responseType)if(c.responseType)c.responseType=b.responseType;else return e("",c,"\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u8bbe\u7f6e\u54cd\u5e94\u7c7b\u578b"),null;if(b.mimeType)if(m.hasOverrideMimeType)c.overrideMimeType(b.mimeType);else return e("",c,"\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u8bbe\u7f6emimeType"),null;var p=
b.type||"POST",f=b.data||null,q="";if("get"===p.toLowerCase()&&f){for(var u in f)f.hasOwnProperty(u)&&(q+=u+"="+f[u]+"&");q=q?q.slice(0,-1):q;b.url+=(0<b.url.indexOf("?")?"&":"?")+(q?q+"&":q)+"_v="+(new Date).getTime();q=f=null}c.open(p,b.url);if(m.isCanSetRequestHeader){b=b.headers||{};for(var h in b)b.hasOwnProperty(h)&&c.setRequestHeader(h,b[h])}c.send(f);return c}}}(),s=function(g,h){if(!this instanceof s)return new s(g);this._msg={};"function"===typeof s[g]&&(s[g].prototype.setGroup=this.setGroup,
this._msg=new s[g](h));return this._msg};s.prototype.setGroup=function(g){this.body.group=g};var k={},x=function(g){if(!this instanceof x)return new x(g,conn);this.msg=g};x.prototype.send=function(g){var h=this,l=function(h){h.ext=h.ext||{};h.ext.weichat=h.ext.weichat||{};h.ext.weichat.originType=h.ext.weichat.originType||"webim";var n=m.stringify({from:g.context.userId||"",to:h.to,bodies:[h.body],ext:h.ext||{}}),n=$msg({type:h.group||"chat",to:h.toJid,id:h.id,xmlns:"jabber:client"}).c("body").t(n);
h.roomType&&n.up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});g.retry&&setTimeout(function(){k[h.id]&&("undefined"===typeof k[h.id].timeout&&(k[h.id].timeout=2),0===k[h.id].timeout?(k[h.id].timeout=2,k[h.id].msg.fail instanceof Function&&k[h.id].msg.fail(h.id)):(--k[h.id].timeout,l(h)))},2E4);g.sendCommand(n.tree(),h.id)};if(h.msg.file)if(h.msg.body&&h.msg.body.url)l(h.msg);else{var n=h.msg.onFileUploadComplete;h.msg.onFileUploadComplete=function(g){if(g.entities[0]["file-metadata"]){var m=
g.entities[0]["file-metadata"]["content-length"];h.msg.file_length=m;h.msg.filetype=g.entities[0]["file-metadata"]["content-type"];204800<m&&(h.msg.thumbnail=!0)}h.msg.body={type:h.msg.type||"file",url:g.uri+"/"+g.entities[0].uuid,secret:g.entities[0]["share-secret"],filename:h.msg.file.filename||h.msg.filename,size:{width:h.msg.width||0,height:h.msg.height||0},length:h.msg.file_length||0,file_length:h.msg.file_length||0,filetype:h.msg.filetype};l(h.msg);n instanceof Function&&n(g,h.msg.id)};m.uploadFile.call(g,
h.msg)}else h.msg.body={type:"chat"===h.msg.type?"txt":h.msg.type,msg:h.msg.msg},"cmd"===h.msg.type?h.msg.body.action=h.msg.action:"loc"===h.msg.type&&(h.msg.body.addr=h.msg.addr,h.msg.body.lat=h.msg.lat,h.msg.body.lng=h.msg.lng),l(h.msg)};var z=function(){var s=function(a){var e={errorMsg:!0,data:[]},c=a.getElementsByTagName("body");if(c){for(var b=0;b<c.length;b++){var f=c[b],d=f.childNodes;if(d&&0<d.length&&(f=f.childNodes[0],f.nodeType==Strophe.ElementType.TEXT)){f=f.wholeText||f.nodeValue;f=
f.replace("\n","<br>");try{var g=eval("("+f+")");e.errorMsg=!1;e.data=[g]}catch(h){}}}(g=a.getElementsByTagName("delay"))&&0<g.length&&(g=g[0].getAttribute("stamp"))&&(e.delayTimeStamp=g)}else if((c=a.childNodes)&&0<c.length&&(a=a.childNodes[0],a.nodeType==Strophe.ElementType.TEXT))try{g=eval("("+a.nodeValue+")"),e.errorMsg=!1,e.data=[g]}catch(m){}return e},h=function(a,e){e=e||"";var c=a,b=c.indexOf("_");-1!==b&&(c=c.substring(b+1));b=c.indexOf("@"+e);-1!==b&&(c=c.substring(0,b));return c},E=function(a){var e=
[];if(a=a.getElementsByTagName("item"))for(var c=0;c<a.length;c++){var b=a[c],f=b.getAttribute("jid");if(f){var d={subscription:b.getAttribute("subscription"),jid:f},g=b.getAttribute("ask");g&&(d.ask=g);(g=b.getAttribute("name"))?d.name=g:(f=h(f),d.name=f);var t=[];Strophe.forEachChild(b,"group",function(a){t.push(Strophe.getText(a))});d.groups=t;e.push(d)}}return e},v=function(a,e){var c=a.access_token||"";if(""==c)c=m.stringify(a),e.onError({type:EASEMOB_IM_CONNCTION_OPEN_USERGRID_ERROR,msg:"\u767b\u5f55\u5931\u8d25,"+
c,data:a,xhr:xhr});else{e.context.accessToken=a.access_token;e.context.accessTokenExpires=a.expires_in;var b=null;if(e.isOpening()&&e.context.stropheConn)b=e.context.stropheConn;else{if(e.isOpened()&&e.context.stropheConn)return;b=new Strophe.Connection(e.url,{inactivity:e.inactivity,maxRetries:e.maxRetries,pollingTime:e.pollingTime})}var f=function(a,c){w(a,c,e)};e.context.stropheConn=b;e.route?b.connect(e.context.jid,"$t$"+c,f,e.wait,e.hold,e.route):b.connect(e.context.jid,"$t$"+c,f,e.wait,e.hold)}},
w=function(a,e,c){if(a==Strophe.Status.CONNFAIL)c.onError({type:EASEMOB_IM_CONNCTION_SERVER_CLOSE_ERROR,msg:e,reconnect:!0});else if(a==Strophe.Status.ATTACHED||a==Strophe.Status.CONNECTED)c.addHandler(function(a){var e;e="normal";var b=a.getElementsByTagName("received");b&&0<b.length&&"urn:xmpp:receipts"===b[0].namespaceURI?e="received":(b=a.getElementsByTagName("invite"))&&0<b.length&&(e="invite");"received"===e?c.handleReceivedMessage(a):"invite"===e?c.handleInviteMessage(a):c.handleMessage(a);
return!0},null,"message",null,null,null),c.addHandler(function(a){c.handlePresence(a);return!0},null,"presence",null,null,null),c.addHandler(function(a){c.handlePing(a);return!0},"urn:xmpp:ping","iq","get",null,null),c.addHandler(function(a){c.handleIq(a);return!0},"jabber:iq:roster","iq","set",null,null),c.context.status=G,a=[EASEMOB_IM_MESSAGE_REC_TEXT,EASEMOB_IM_MESSAGE_REC_EMOTION],m.isCanDownLoadFile&&(a.push(EASEMOB_IM_MESSAGE_REC_PHOTO),a.push(EASEMOB_IM_MESSAGE_REC_AUDIO_FILE)),e=[EASEMOB_IM_MESSAGE_SED_TEXT],
m.isCanUploadFile&&(e.push(EASEMOB_IM_MESSAGE_REC_PHOTO),e.push(EASEMOB_IM_MESSAGE_REC_AUDIO_FILE)),c.notifyVersion(),c.onOpened({canReceive:a,canSend:e,accessToken:c.context.accessToken});else if(a==Strophe.Status.DISCONNECTING)c.isOpened()&&(c.context.status=y,c.onError({type:EASEMOB_IM_CONNCTION_SERVER_CLOSE_ERROR,msg:e,reconnect:!0}));else if(a==Strophe.Status.DISCONNECTED)c.context.status=H,c.clear(),c.onClosed();else if(a==Strophe.Status.AUTHFAIL)c.onError({type:EASEMOB_IM_CONNCTION_AUTH_ERROR,
msg:"\u767b\u5f55\u5931\u8d25,\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801"}),c.clear();else if(a==Strophe.Status.ERROR)c.onError({type:EASEMOB_IM_CONNCTION_SERVER_ERROR,msg:e||"\u670d\u52a1\u5668\u5f02\u5e38"})},r=function(a,e){var c=a.toJid||"";""===c&&(c=(e.context.appKey||"")+"_"+a.to+"@"+e.domain,a.resource&&(c=c+"/"+a.resource));return c},F=function(a,e){a=a||{};if(""==a.user)return e.onError({type:EASEMOB_IM_CONNCTION_USER_NOT_ASSIGN_ERROR,msg:"\u672a\u6307\u5b9a\u7528\u6237"}),
!1;var c=a.user||"",b=a.appKey||"",f=b.split("#");if(2!==f.length)return e.onError({type:EASEMOB_IM_CONNCTION_OPEN_ERROR,msg:"\u8bf7\u6307\u5b9a\u6b63\u786e\u7684\u5f00\u53d1\u8005\u4fe1\u606f(appKey)"}),!1;var d=f[0],f=f[1];if(!d||!f)return e.onError({type:EASEMOB_IM_CONNCTION_OPEN_ERROR,msg:"\u8bf7\u6307\u5b9a\u6b63\u786e\u7684\u5f00\u53d1\u8005\u4fe1\u606f(appKey)"}),!1;var g=b+"_"+c.toLowerCase()+"@"+e.domain,h=a.resource||"webim";e.multiResources&&(h+=c+(new Date).getTime()+Math.floor(1E6*Math.random().toFixed(6)));
e.context.jid=g+"/"+h;e.context.userId=c;e.context.appKey=b;e.context.appName=f;e.context.orgName=d;return!0},b=function(a,e){if(/^(ws|http)s:\/\/?/.test(a))return a;var c="http",b="/http-bind/";e&&m.isSupportWss?(c="wss",b="/ws/"):e?c="https":l.WebSocket&&(c="ws",b="/ws/");return c+("://"+(a||"im-api.easemob.com"))+b},d=function(a){if(!this instanceof z)return new z(a);a=a||{};this.multiResources=a.multiResources||!1;this.wait=a.wait||30;this.retry=a.retry||!1;this.https=a.https||J;this.url=b(a.url,
this.https);this.hold=a.hold||1;this.route=a.route||null;this.domain=a.domain||"easemob.com";this.inactivity=a.inactivity||30;this.maxRetries=a.maxRetries||5;this.pollingTime=a.pollingTime||800;this.stropheConn=!1;this.context={status:A}};d.prototype.listen=function(a){a.url&&(this.url=b(a.url,this.https));this.onOpened=a.onOpened||g;this.onClosed=a.onClosed||g;this.onTextMessage=a.onTextMessage||g;this.onEmotionMessage=a.onEmotionMessage||g;this.onPictureMessage=a.onPictureMessage||g;this.onAudioMessage=
a.onAudioMessage||g;this.onVideoMessage=a.onVideoMessage||g;this.onFileMessage=a.onFileMessage||g;this.onLocationMessage=a.onLocationMessage||g;this.onCmdMessage=a.onCmdMessage||g;this.onPresence=a.onPresence||g;this.onRoster=a.onRoster||g;this.onError=a.onError||g;this.onReceivedMessage=a.onReceivedMessage||g;this.onInviteMessage=a.onInviteMessage||g};d.prototype.heartBeat=function(a){var e={to:a.domain,type:"normal"};a.heartBeatID=setInterval(function(){a.sendHeartBeatMessage(e)},6E4)};d.prototype.sendHeartBeatMessage=
function(a){var e=m.stringify({});a=$msg({to:a.to,type:a.type,id:this.getUniqueId(),xmlns:"jabber:client"}).c("body").t(e);this.sendCommand(a.tree())};d.prototype.stopHeartBeat=function(a){clearInterval(a.heartBeatID)};d.prototype.sendReceiptsMessage=function(a){a=$msg({from:this.context.jid||"",to:"easemob.com",id:a.id||""}).c("received",{xmlns:"urn:xmpp:receipts",id:a.id||""});this.sendCommand(a.tree())};d.prototype.open=function(a){if(F(a,this)){var e=this;if(!e.isOpening()&&!e.isOpened())if(a.accessToken)a.access_token=
a.accessToken,v(a,e);else{var c=a.apiUrl||(this.https?"https":"http")+"://a1.easemob.com",b=this.context.userId,f=a.pwd||"";a=this.context.appName;var d=this.context.orgName;this.context.status=I;b=m.stringify({grant_type:"password",username:b,password:f});a={url:c+"/"+d+"/"+a+"/token",dataType:"json",data:b,success:function(a,b){e.context.status=B;v(a,e)}||g,error:function(a,b,c){e.clear();if(a.error&&a.error_description)e.onError({type:EASEMOB_IM_CONNCTION_OPEN_USERGRID_ERROR,msg:"\u767b\u5f55\u5931\u8d25,"+
a.error_description,data:a,xhr:b});else e.onError({type:EASEMOB_IM_CONNCTION_OPEN_USERGRID_ERROR,msg:"\u767b\u5f55\u5931\u8d25",data:a,xhr:b})}||g};m.ajax(a)}}};d.prototype.attach=function(a){if(F(a,this)){a=a||{};var e=a.accessToken||"";if(""==e)this.onError({type:EASEMOB_IM_CONNCTION_ATTACH_USERGRID_ERROR,msg:"\u672a\u6307\u5b9a\u7528\u6237\u7684accessToken"});else{var b=a.sid||"";if(""===b)this.onError({type:EASEMOB_IM_CONNCTION_ATTACH_ERROR,msg:"\u672a\u6307\u5b9a\u7528\u6237\u7684\u4f1a\u8bdd\u4fe1\u606f"});
else if(a=a.rid||"",""===a)this.onError({type:EASEMOB_IM_CONNCTION_ATTACH_ERROR,msg:"\u672a\u6307\u5b9a\u7528\u6237\u7684\u6d88\u606fid"});else{var d=new Strophe.Connection(this.url,{inactivity:this.inactivity,maxRetries:this.maxRetries,pollingTime:this.pollingTime});this.context.accessToken=e;this.context.stropheConn=d;this.context.status=B;var f=this;d.attach(this.context.jid,b,a,function(a,e){w(a,e,f)},this.wait,this.hold,this.wind||5)}}}};d.prototype.close=function(){this.context.status==A||this.isClosed()||
this.isClosing()||(this.context.status=y,this.context.stropheConn.disconnect())};d.prototype.addHandler=function(a,e,b,d,f,g,h){this.context.stropheConn.addHandler(a,e,b,d,f,g,h)};d.prototype.notifyVersion=function(a,e){r({},this);var b=$iq({from:this.context.jid||"",to:this.domain,type:"result"}).c("query",{xmlns:"jabber:iq:version"}).c("name").t("easemob").up().c("version").t(n.im.version).up().c("os").t("webim");a=a||g;error=e||this.onError;this.context.stropheConn.sendIQ(b.tree(),a,function(a){error({type:EASEMOB_IM_CONNCTION_NOTIFYVERSION_ERROR,
msg:"\u53d1\u9001\u7248\u672c\u4fe1\u606f\u7ed9\u670d\u52a1\u5668\u65f6\u5931\u8d25",data:a})})};d.prototype.handlePresence=function(a){if(!this.isClosed()){var e=a.getAttribute("from")||"",b=a.getAttribute("to")||"",d=a.getAttribute("type")||"",f=h(e),g=h(b),e={from:f,to:g,fromJid:e,toJid:b,type:d,chatroom:a.getElementsByTagName("roomtype").length?!0:!1,destroy:a.getElementsByTagName("destroy").length?!0:!1};(b=a.getElementsByTagName("show"))&&0<b.length&&(e.show=Strophe.getText(b[0]));(b=a.getElementsByTagName("status"))&&
0<b.length&&(e.status=Strophe.getText(b[0]));(b=a.getElementsByTagName("priority"))&&0<b.length&&(e.priority=Strophe.getText(b[0]));this.onPresence(e,a)}};d.prototype.handlePing=function(a){if(!this.isClosed()){var e=a.getAttribute("id"),b=a.getAttribute("from");a=a.getAttribute("to");e=$iq({from:a,to:b,id:e,type:"result"});this.sendCommand(e.tree())}};d.prototype.handleIq=function(a){var b=a.getAttribute("id"),c=a.getAttribute("from")||"",d=h(c),f=this.context.jid,g=this.context.userId;if(""!==c&&
c!==f&&g!==d)return!0;b=$iq({type:"result",id:b,from:f});this.sendCommand(b.tree());(a=a.getElementsByTagName("query"))&&0<a.length&&(a=E(a[0]),this.onRoster(a));return!0};d.prototype.handleMessage=function(a){if(!this.isClosed()){var b=a.getAttribute("id")||"";this.sendReceiptsMessage({id:b});var c=s(a);if(!c.errorMsg){var c=c.data,d;for(d in c)if(c.hasOwnProperty(d)){var f=c[d];if(f.from&&f.to){var g=f.from.toLowerCase(),h=f.to.toLowerCase(),t=f.ext||{},l="",l=a.getElementsByTagName("roomtype"),
l=l.length?l[0].getAttribute("type")||"chat":a.getAttribute("type")||"chat",k=f.bodies;if(k&&0!=k.length)if(f=f.bodies[0],k=f.type,"txt"===k)if(f=f.msg,k=m.parseTextMessage(f,n.im.EMOTIONS),k.isemotion)this.onEmotionMessage({id:b,type:l,from:g,to:h,data:k.body,ext:t});else this.onTextMessage({id:b,type:l,from:g,to:h,data:f,ext:t});else if("img"===k){var r=k=0;f.size&&(k=f.size.width,r=f.size.height);f={id:b,type:l,from:g,to:h,url:f.url,secret:f.secret,filename:f.filename,thumb:f.thumb,thumb_secret:f.thumb_secret,
file_length:f.file_length||"",width:k,height:r,filetype:f.filetype||"",accessToken:this.context.accessToken||"",ext:t};this.onPictureMessage(f)}else if("audio"===k)this.onAudioMessage({id:b,type:l,from:g,to:h,url:f.url,secret:f.secret,filename:f.filename,length:f.length||"",file_length:f.file_length||"",filetype:f.filetype||"",accessToken:this.context.accessToken||"",ext:t});else if("file"===k)this.onFileMessage({id:b,type:l,from:g,to:h,url:f.url,secret:f.secret,filename:f.filename,file_length:f.file_length,
accessToken:this.context.accessToken||"",ext:t});else if("loc"===k)this.onLocationMessage({id:b,type:l,from:g,to:h,addr:f.addr,lat:f.lat,lng:f.lng,ext:t});else if("video"===k)this.onVideoMessage({id:b,type:l,from:g,to:h,url:f.url,secret:f.secret,filename:f.filename,file_length:f.file_length,accessToken:this.context.accessToken||"",ext:t});else if("cmd"===k)this.onCmdMessage({id:b,from:g,to:h,action:f.action,ext:t})}}}}};d.prototype.handleReceivedMessage=function(a){this.onReceivedMessage(a);a=a.getElementsByTagName("received");
var b=C;0<a.length&&(b=a[0].childNodes&&0<a[0].childNodes.length?a[0].childNodes[0].nodeValue:a[0].innerHTML||a[0].innerText);k[b]&&(k[b].msg.success instanceof Function&&k[b].msg.success(b),delete k[b])};d.prototype.handleInviteMessage=function(a){var b=null,c=a.getElementsByTagName("invite");c&&0<c.length&&(b=c[0].getAttribute("from"),b=h(b));a=a.getElementsByTagName("x");var d=null;if(a&&0<a.length)for(c=0;c<a.length;c++)"jabber:x:conference"===a[c].namespaceURI&&(d=a[c].getAttribute("jid"),d=
h(d));this.onInviteMessage({type:"invite",from:b,roomid:d})};d.prototype.sendCommand=function(a,b){if(this.isOpened())this.context.stropheConn.send(a);else this.onError({type:EASEMOB_IM_CONNCTION_OPEN_ERROR,msg:"\u8fde\u63a5\u8fd8\u672a\u5efa\u7acb,\u8bf7\u5148\u767b\u5f55\u6216\u7b49\u5f85\u767b\u5f55\u5904\u7406\u5b8c\u6bd5",reconnect:!0})};d.prototype.getUniqueId=function(a){var b=new Date(2010,1,1),b=(new Date).getTime()-b.getTime(),b=parseInt(b).toString(16);return"string"===typeof a||"number"===
typeof a?a+"_"+b:"WEBIM_"+b};d.prototype.send=function(a){if("[object Object]"===Object.prototype.toString.call(a)){var b=this.context.appKey||"",c=b+"_"+a.to+"@"+this.domain;a.group&&(c=b+"_"+a.to+"@conference."+this.domain);a.resource&&(c=c+"/"+a.resource);a.toJid=c;a.id=a.id||this.getUniqueId();k[a.id]=new x(a);k[a.id].send(this)}else"string"===typeof a&&k[a]&&k[a].send(this)};d.prototype.addRoster=function(a){var b=r(a,this),c=a.name||"",d=a.groups||"",f=$iq({type:"set"});f.c("query",{xmlns:"jabber:iq:roster"});
f.c("item",{jid:b,name:c});if(d)for(b=0;b<d.length;b++)f.c("group").t(d[b]).up();d=a.success||g;a=a.error||g;this.context.stropheConn.sendIQ(f.tree(),d,a)};d.prototype.removeRoster=function(a){var b=r(a,this),b=$iq({type:"set"}).c("query",{xmlns:"jabber:iq:roster"}).c("item",{jid:b,subscription:"remove"});this.context.stropheConn.sendIQ(b,a.success||g,a.error||g)};d.prototype.getRoster=function(a){var b=$iq({type:"get"}).c("query",{xmlns:"jabber:iq:roster"});a=a||{};suc=a.success||this.onRoster;var c=
function(a){var b=[],c=a.getElementsByTagName("query");c&&0<c.length&&(b=E(c[0]));suc(b,a)};error=a.error||this.onError;a=function(a){error({type:EASEMOB_IM_CONNCTION_GETROSTER_ERROR,msg:"\u83b7\u53d6\u8054\u7cfb\u4eba\u4fe1\u606f\u5931\u8d25",data:a})};this.isOpened()?this.context.stropheConn.sendIQ(b.tree(),c,a):error({type:EASEMOB_IM_CONNCTION_OPEN_ERROR,msg:"\u8fde\u63a5\u8fd8\u672a\u5efa\u7acb,\u8bf7\u5148\u767b\u5f55\u6216\u7b49\u5f85\u767b\u5f55\u5904\u7406\u5b8c\u6bd5"})};d.prototype.subscribe=
function(a){var b=r(a,this),b=$pres({to:b,type:"subscribe"});a.message&&b.c("status").t(a.message).up();a.nick&&b.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(a.nick);this.sendCommand(b.tree())};d.prototype.subscribed=function(a){var b=r(a,this),b=$pres({to:b,type:"subscribed"});a.message&&b.c("status").t(a.message).up();this.sendCommand(b.tree())};d.prototype.unsubscribe=function(a){var b=r(a,this),b=$pres({to:b,type:"unsubscribe"});a.message&&b.c("status").t(a.message);this.sendCommand(b.tree())};
d.prototype.unsubscribed=function(a){var b=r(a,this),b=$pres({to:b,type:"unsubscribed"});a.message&&b.c("status").t(a.message).up();this.sendCommand(b.tree())};d.prototype.createRoom=function(a){var b=a.success||g,c=a.error||g;a=$iq({to:a.rooomName,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"});return this.context.stropheConn.sendIQ(a.tree(),b,c)};d.prototype.join=function(a){var b=a.success||g,c=a.error||g;a=$pres({from:this.context.jid,to:this.context.appKey+
"_"+a.roomId+"@conference."+this.domain+"/"+this.context.userId}).c("x",{xmlns:Strophe.NS.MUC});this.context.stropheConn.sendIQ(a.tree(),b,function(a){c({type:EASEMOB_IM_CONNCTION_JOINROOM_ERROR,msg:"\u52a0\u5165\u623f\u95f4\u5931\u8d25",data:a})})};d.prototype.listRooms=function(a){var b=$iq({to:a.server||"conference."+this.domain,from:this.context.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),c=a.success||g,d=a.error||g;this.context.stropheConn.sendIQ(b.tree(),function(a){var b=[];
if(a=a.getElementsByTagName("item"))for(var e=0;e<a.length;e++){var d=a[e],g=d.getAttribute("jid"),h=g.split("@")[0],d={jid:g,name:d.getAttribute("name"),roomId:h.split("_")[1]};b.push(d)}c(b)},function(a){d({type:EASEMOB_IM_CONNCTION_GETROOM_ERROR,msg:"\u83b7\u53d6\u7fa4\u7ec4\u5217\u8868\u5931\u8d25",data:a})})};d.prototype.queryRoomMember=function(a){var b=[],c=$iq({to:this.context.appKey+"_"+a.roomId+"@conference."+this.domain,type:"get"}).c("query",{xmlns:Strophe.NS.MUC+"#admin"}).c("item",{affiliation:"member"}),
d=a.success||g,f=a.error||g;this.context.stropheConn.sendIQ(c.tree(),function(a){if(a=a.getElementsByTagName("item"))for(var c=0;c<a.length;c++){var f={jid:a[c].getAttribute("jid"),affiliation:"member"};b.push(f)}d(b)},function(a){f({type:EASEMOB_IM_CONNCTION_GETROOMMEMBER_ERROR,msg:"\u83b7\u53d6\u7fa4\u7ec4\u6210\u5458\u5217\u8868\u5931\u8d25",data:a})})};d.prototype.queryRoomInfo=function(a){var b=this.domain,c=$iq({to:this.context.appKey+"_"+a.roomId+"@conference."+b,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_INFO}),
d=a.success||g,f=[],h=a.error||g;this.context.stropheConn.sendIQ(c.tree(),function(a){if(a=a.getElementsByTagName("field"))for(var c=0;c<a.length;c++){var g=a[c];"owner"===g.getAttribute("label")&&f.push({jid:(g.textContent||g.text)+"@"+b,affiliation:"owner"})}d(f)},function(a){h({type:EASEMOB_IM_CONNCTION_GETROOMINFO_ERROR,msg:"\u83b7\u53d6\u7fa4\u7ec4\u4fe1\u606f\u5931\u8d25",data:a})})};d.prototype.queryRoomOccupants=function(a){var b=a.success||g,c=a.error||g,d={xmlns:Strophe.NS.DISCO_ITEMS};
a=$iq({from:this.context.jid,to:this.context.appKey+"_"+a.roomId+"@conference."+this.domain,type:"get"}).c("query",d);this.context.stropheConn.sendIQ(a.tree(),function(a){var c=[];if(a=a.getElementsByTagName("item"))for(var d=0;d<a.length;d++){var g=a[d],g={jid:g.getAttribute("jid"),name:g.getAttribute("name")};c.push(g)}b(c)},function(a){c({type:EASEMOB_IM_CONNCTION_GETROOMOCCUPANTS_ERROR,msg:"\u83b7\u53d6\u7fa4\u7ec4\u51fa\u5e2d\u8005\u5217\u8868\u5931\u8d25",data:a})})};d.prototype.setUserSig=
function(a){var b=$pres({xmlns:"jabber:client"});a=a||"";b.c("status").t(a);this.sendCommand(b.tree())};d.prototype.setPresence=function(a,b){var c=$pres({xmlns:"jabber:client"});a&&(b?(c.c("show").t(a),c.up().c("status").t(b)):c.c("show").t(a));this.sendCommand(c.tree())};d.prototype.getPresence=function(){var a=$pres({xmlns:"jabber:client"});this.sendCommand(a.tree())};d.prototype.ping=function(a){a=a||{};var b=r(a,this),b=$iq({from:this.context.jid||"",to:b,type:"get"}).c("ping",{xmlns:"urn:xmpp:ping"});
suc=a.success||g;error=a.error||this.onError;a=function(a){error({type:EASEMOB_IM_CONNCTION_PING_ERROR,msg:"ping\u5931\u8d25",data:a})};this.isOpened()?this.context.stropheConn.sendIQ(b.tree(),suc,a):error({type:EASEMOB_IM_CONNCTION_OPEN_ERROR,msg:"\u8fde\u63a5\u8fd8\u672a\u5efa\u7acb,\u8bf7\u5148\u767b\u5f55\u6216\u7b49\u5f85\u767b\u5f55\u5904\u7406\u5b8c\u6bd5"})};d.prototype.isOpened=function(){return this.context.status==G};d.prototype.isOpening=function(){var a=this.context.status;return a==
I||a==B};d.prototype.isClosing=function(){return this.context.status==y};d.prototype.isClosed=function(){return this.context.status==H};d.prototype.clear=function(){this.context={status:A,appKey:this.context.appKey}};d.prototype.getChatRooms=function(a){if(m.isCanSetRequestHeader){var b=this,c=a.accessToken||this.context.accessToken;if(c){var d=a.apiUrl||(this.https?"https":"http")+"://a1.easemob.com",f=this.context.appName,h=this.context.orgName;if(f&&h)m.ajax({url:d+"/"+h+"/"+f+"/chatrooms",dataType:"json",
type:"get",headers:{Authorization:"Bearer "+c},success:function(b,c){"function"===typeof a.success&&a.success(b)}||g,error:function(a,c,d){if(a.error&&a.error_description)b.onError({type:EASEMOB_IM_LOAD_CHATROOM_ERROR,msg:"\u83b7\u53d6\u804a\u5929\u5ba4\u5931\u8d25,"+a.error_description,data:a,xhr:c})}||g});else b.onError({type:EASEMOB_IM_CONNCTION_AUTH_ERROR,msg:"token\u65e0\u6548",data:null})}else b.onError({type:EASEMOB_IM_CONNCTION_AUTH_ERROR,msg:"token\u65e0\u6548",data:null})}else b.onError({type:EASEMOB_IM_CONNCTION_AUTH_ERROR,
msg:"\u5f53\u524d\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u804a\u5929\u5ba4\u529f\u80fd"})};d.prototype.joinChatRoom=function(a){var b=a.success||g,c=a.error||g;a=$pres({from:this.context.jid,to:this.context.appKey+"_"+a.roomId+"@conference."+this.domain+"/"+this.context.userId}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"member",role:"participant"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(a.tree(),b,function(a){c({type:EASEMOB_IM_CONNCTION_JOINROOM_ERROR,
msg:"\u52a0\u5165\u804a\u5929\u5ba4\u5931\u8d25",data:a})})};d.prototype.quitChatRoom=function(a){var b=a.success||g,c=a.error||g;a=$pres({from:this.context.jid,to:this.context.appKey+"_"+a.roomId+"@conference."+this.domain+"/"+this.context.userId,type:"unavailable"}).c("x",{xmlns:Strophe.NS.MUC+"#user"}).c("item",{affiliation:"none",role:"none"}).up().up().c("roomtype",{xmlns:"easemob:x:roomtype",type:"chatroom"});this.context.stropheConn.sendIQ(a.tree(),b,function(a){c({type:EASEMOB_IM_CONNCTION_JOINROOM_ERROR,
msg:"\u9000\u51fa\u623f\u95f4\u5931\u8d25",data:a})})};return d}(),g=function(){};tempIndex=0;EASEMOB_IM_CONNCTION_USER_NOT_ASSIGN_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_OPEN_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_AUTH_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_OPEN_USERGRID_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_ATTACH_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_ATTACH_USERGRID_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_REOPEN_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_SERVER_CLOSE_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_SERVER_ERROR=
tempIndex++;EASEMOB_IM_CONNCTION_IQ_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_PING_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_NOTIFYVERSION_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_GETROSTER_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_CROSSDOMAIN_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_LISTENING_OUTOF_MAXRETRIES=tempIndex++;EASEMOB_IM_CONNCTION_RECEIVEMSG_CONTENTERROR=tempIndex++;EASEMOB_IM_CONNCTION_JOINROOM_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_GETROOM_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_GETROOMINFO_ERROR=
tempIndex++;EASEMOB_IM_CONNCTION_GETROOMMEMBER_ERROR=tempIndex++;EASEMOB_IM_CONNCTION_GETROOMOCCUPANTS_ERROR=tempIndex++;EASEMOB_IM_UPLOADFILE_BROWSER_ERROR=tempIndex++;EASEMOB_IM_UPLOADFILE_ERROR=tempIndex++;EASEMOB_IM_UPLOADFILE_NO_LOGIN=tempIndex++;EASEMOB_IM_UPLOADFILE_NO_FILE=tempIndex++;EASEMOB_IM_DOWNLOADFILE_ERROR=tempIndex++;EASEMOB_IM_DOWNLOADFILE_NO_LOGIN=tempIndex++;EASEMOB_IM_DOWNLOADFILE_BROWSER_ERROR=tempIndex++;EASEMOB_IM_RESISTERUSER_ERROR=tempIndex++;EASEMOB_IM_LOAD_CHATROOM_ERROR=
tempIndex++;EASEMOB_IM_JOIN_CHATROOM_ERROR=tempIndex++;EASEMOB_IM_QUIT_CHATROOM_ERROR=tempIndex++;tempIndex=0;EASEMOB_IM_MESSAGE_REC_TEXT=tempIndex++;EASEMOB_IM_MESSAGE_REC_TEXT_ERROR=tempIndex++;EASEMOB_IM_MESSAGE_REC_EMOTION=tempIndex++;EASEMOB_IM_MESSAGE_REC_PHOTO=tempIndex++;EASEMOB_IM_MESSAGE_REC_AUDIO=tempIndex++;EASEMOB_IM_MESSAGE_REC_AUDIO_FILE=tempIndex++;EASEMOB_IM_MESSAGE_REC_VEDIO=tempIndex++;EASEMOB_IM_MESSAGE_REC_VEDIO_FILE=tempIndex++;EASEMOB_IM_MESSAGE_REC_FILE=tempIndex++;EASEMOB_IM_MESSAGE_SED_TEXT=
tempIndex++;EASEMOB_IM_MESSAGE_SED_EMOTION=tempIndex++;EASEMOB_IM_MESSAGE_SED_PHOTO=tempIndex++;EASEMOB_IM_MESSAGE_SED_AUDIO=tempIndex++;EASEMOB_IM_MESSAGE_SED_AUDIO_FILE=tempIndex++;EASEMOB_IM_MESSAGE_SED_VEDIO=tempIndex++;EASEMOB_IM_MESSAGE_SED_VEDIO_FILE=tempIndex++;EASEMOB_IM_MESSAGE_SED_FILE=tempIndex++;EASEMOB_IM_FILESIZE_LIMIT=10485760;tempIndex=0;var A=tempIndex++,I=tempIndex++,B=tempIndex++,G=tempIndex++,y=tempIndex++,H=tempIndex++;delete tempIndex;n.im.Connection=z;n.im.EmMessage=s;n.im.Helper=
n.im.Utils=m;l.Easemob=n})(window,void 0);

/* resmerge themes/webim/static/sdk/easemob.im-1.1.js end */
/* resmerge themes/webim/static/sdk/easemob.im-1.1.shim.js start */
(function(){var c=Easemob.im,e=c.Connection,d=c.EmMessage,m=function(){};c.version="2.0shim";c.Helper.download=c.Helper.downloadFn;c.EMOTIONS={path:"static/img/faces/",map:{"[):]":"ee_1.png","[:D]":"ee_2.png","[;)]":"ee_3.png","[:-o]":"ee_4.png","[:p]":"ee_5.png","[(H)]":"ee_6.png","[:@]":"ee_7.png","[:s]":"ee_8.png","[:$]":"ee_9.png","[:(]":"ee_10.png","[:'(]":"ee_11.png","[:|]":"ee_12.png","[(a)]":"ee_13.png","[8o|]":"ee_14.png","[8-|]":"ee_15.png","[+o(]":"ee_16.png","[<o)]":"ee_17.png","[|-)]":"ee_18.png",
"[*-)]":"ee_19.png","[:-#]":"ee_20.png","[:-*]":"ee_21.png","[^o)]":"ee_22.png","[8-)]":"ee_23.png","[(|)]":"ee_24.png","[(u)]":"ee_25.png","[(S)]":"ee_26.png","[(*)]":"ee_27.png","[(#)]":"ee_28.png","[(R)]":"ee_29.png","[({)]":"ee_30.png","[(})]":"ee_31.png","[(k)]":"ee_32.png","[(F)]":"ee_33.png","[(W)]":"ee_34.png","[(D)]":"ee_35.png"}};c.Helper.EmotionPicData=function(){var a={},b;for(b in c.EMOTIONS.map)c.EMOTIONS.map.hasOwnProperty(b)&&(a[b]=c.EMOTIONS.map[b]);return a}();c.Helper.getIEVersion=
function(){var a=navigator.userAgent,b,f={4:8,5:9,6:10,7:11};return(b=a.match(/MSIE (\d+)/i))&&b[1]?+b[1]:(b=a.match(/Trident\/(\d+)/i))&&b[1]?f[b[1]]||null:null}();d.txt=function(a){this.id=a;this.type="txt";this.brief="";this.body={}};d.txt.prototype.set=function(a){if(this.value=a.msg)this.brief=this.value.replace(/\n/mg,""),this.brief=15<this.brief.length?this.brief.slice(0,15)+"...":this.brief;this.body={id:this.id,to:a.to,msg:this.value,type:this.type,roomType:a.roomType,ext:a.ext||{},success:a.success,
fail:a.fail}};d.cmd=function(a){this.id=a;this.type="cmd";this.body={}};d.cmd.prototype.set=function(a){this.value="";this.body={to:a.to,action:a.action,msg:this.value,type:this.type,roomType:a.roomType,ext:a.ext||{}}};d.location=function(a){this.id=a;this.type="loc";this.body={}};d.location.prototype.set=function(a){this.body={to:a.to,type:this.type,roomType:a.roomType,addr:a.addr,lat:a.lat,lng:a.lng,ext:a.ext||{}}};d.img=function(a){this.id=a;this.type="img";this.brief="\u56fe\u7247";this.body=
{}};d.img.prototype.set=function(a){a.file=a.file||c.Utils.getFileUrl(a.fileInputId);this.value=a.file;this.body={id:this.id,file:this.value,apiUrl:a.apiUrl,to:a.to,type:this.type,ext:a.ext||{},roomType:a.roomType,onFileUploadError:a.onFileUploadError,onFileUploadComplete:a.onFileUploadComplete,success:a.success,fail:a.fail,flashUpload:a.flashUpload}};d.audio=function(a){this.id=a;this.type="audio";this.brief="\u97f3\u9891";this.body={}};d.audio.prototype.set=function(a){a.file=a.file||c.Utils.getFileUrl(a.fileInputId);
this.value=a.file;this.filename=a.filename||this.value.filename||"\u97f3\u9891";this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:a.apiUrl,to:a.to,type:this.type,ext:a.ext||{},roomType:a.roomType,onFileUploadError:a.onFileUploadError,onFileUploadComplete:a.onFileUploadComplete,success:a.success,fail:a.fail,flashUpload:a.flashUpload}};d.file=function(a){this.id=a;this.type="file";this.brief="\u6587\u4ef6";this.body={}};d.file.prototype.set=function(a){a.file=a.file||c.Utils.getFileUrl(a.fileInputId);
this.value=a.file;this.filename=a.filename||this.value.filename||"\u6587\u4ef6";this.body={id:this.id,file:this.value,filename:this.filename,apiUrl:a.apiUrl,to:a.to,type:this.type,ext:a.ext||{},roomType:a.roomType,onFileUploadError:a.onFileUploadError,onFileUploadComplete:a.onFileUploadComplete,success:a.success,fail:a.fail,flashUpload:a.flashUpload}};e.prototype.init=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);this.listen(a)};var h=function(a,b){var f=new d(a);b.id&&(f.id=b.id);
f.set(b);"groupchat"===b.type&&f.setGroup(b.type);this.send(f.body)};e.prototype.sendTextMessage=function(a){h.call(this,"txt",a)};e.prototype.sendPicture=function(a){h.call(this,"img",a)};e.prototype.sendAudio=function(a){h.call(this,"audio",a)};e.prototype.sendFile=function(a){h.call(this,"file",a)};e.prototype.sendLocationMessage=function(a){h.call(this,"location",a)};e.prototype.sendCmdMessage=function(a){h.call(this,"cmd",a)};e.prototype.sendPictureMessage=m;e.prototype.sendAudioMessage=m;e.prototype.sendFileMessage=
m;c.Helper.innerBase64=function(){return{encode:function(a){var b="",f,c,d,e,k,g,l=0;do f=a.charCodeAt(l++),c=a.charCodeAt(l++),d=a.charCodeAt(l++),e=f>>2,f=(f&3)<<4|c>>4,k=(c&15)<<2|d>>6,g=d&63,isNaN(c)?k=g=64:isNaN(d)&&(g=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g);
while(l<a.length);return b},byteEncode:function(a){var b="",f,c,d,e,k,g,l=0;do f=a[l++],c=a[l++],d=a[l++],e=f>>2,f=(f&3)<<4|c>>4,k=(c&15)<<2|d>>6,g=d&63,isNaN(c)?k=g=64:isNaN(d)&&(g=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g);
while(l<a.length);return b},decode:function(a){var b="",c,d,e,h,k,g=0;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),k="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(g++)),c=c<<2|d>>4,d=(d&15)<<
4|h>>2,e=(h&3)<<6|k,b+=String.fromCharCode(c),64!=h&&(b+=String.fromCharCode(d)),64!=k&&(b+=String.fromCharCode(e));while(g<a.length);return b}}}()})();

/* resmerge themes/webim/static/sdk/easemob.im-1.1.shim.js end */
/* resmerge themes/webim/static/js/easemob.im.config.js start */
Easemob.im.config={xmppURL:"wss://im-api.easemob.com/ws/",apiURL:"",appkey:"eelly#eellybuyer",https:!0};(function(){var a=location.host;if(-1<a.indexOf(".local"))Easemob.im.config.appkey="www-eelly-com#eellylocal";else if(-1<a.indexOf(".test")||-1<a.indexOf(".dev"))Easemob.im.config.appkey="www-eelly-com#buyerdevelopment"})();

/* resmerge themes/webim/static/js/easemob.im.config.js end */
/* resmerge themes/webim/static/js/webim.js start */
$(function(){var z=function(){var h=window.user.username,k=null,d={},m=null,n=null,s=!1,z=[];(new Date).getTime();var t=0,A=!0,p={},B="",x=window.localStorage;localStorage.getItem(h)&&(p=JSON.parse(localStorage.getItem(h)));var y={uuid:window.user.uuid,avatar:window.user.avatar,nick:window.user.nick,type:window.user.type,uid:window.user.uid,role:window.user.type,user_id:window.user.uid},F=function(a){if(!a||0===a.length)return"";var b="",b=a.replace(/&amp;/g,"&"),b=b.replace(/<(?=[^o][^)])/g,"&lt;"),
b=b.replace(/>/g,"&gt;"),b=b.replace(/\"/g,"&quot;");return b=b.replace(/\n/g,"<br>")},Q=function(a,b,f){var c=$(a),q=c.next(),g=q.next();c.jPlayer&&(9>Easemob.im.Helper.getIEVersion&&z.push(c),c.jPlayer({ready:function(){$(this).jPlayer("setMedia",{mp3:b})},solution:9!=Easemob.im.Helper.getIEVersion?"html, flash":"flash",swfPath:"sdk/jplayer",supplied:"mp3",ended:function(){g.hide();q.show()}}),q.on("click",function(){c.jPlayer("play");q.hide();g.show()}),g.on("click",function(){c.jPlayer("pause");
q.show();g.hide()}))},R=function(a,b){(void 0).setUploadURL(a);(void 0).startUpload()},S=function(a,b){(void 0).setUploadURL(a);(void 0).startUpload()};window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;$(function(){$("textarea").keydown(function(a){if(a.altKey&&13==a.keyCode)e=$(this).val(),$(this).val(e+"\n");else if(a.ctrlKey&&13==a.keyCode||13==a.keyCode)return a.returnValue=!1,C(),!1});$(".chat02-bar .send").on("click",function(){C()});$(".bt-close,.topcontact .close").on("click",
function(){open(SITE_URL,"_self").close()});$("#J_open_emo").click(function(a){T()});$("#J_send_pic").click(function(a){a=a||window.event;a=a.target||a.srcElement;$("#fileInput").val("").attr("data-type",a.getAttribute("type")).click()});$("#J_moreHistory span").on("click",function(){var a=-1;r[d.uid+"_"+d.type]&&(a=r[d.uid+"_"+d.type]);d.uid&&d.type&&G(d.uid,d.type,a,d.username)})});var U=function(){var a=window.location.href;-1<a.indexOf("storeid")&&(d.uid=a.substring(a.indexOf("id=")+3,a.length),
d.type=a.substring(a.indexOf("type=")+5,a.indexOf("type=")+6));d.uid==window.user.uid&&(alert("\u4e0d\u80fd\u8ddf\u81ea\u5df1\u804a\u5929"),history.go(-1));""==window.user.uuid&&""==window.user.username?window.location.href=SITE_URL+"/index.php?app=member&act=login":(d.uid&&d.type&&(H(d.uid,d.type,!1),k=d.username),m.open({apiUrl:Easemob.im.config.apiURL,user:window.user.username,accessToken:window.user.token,appKey:Easemob.im.config.appkey}))};$(document).ready(function(){m=new Easemob.im.Connection({multiResources:Easemob.im.config.multiResources,
https:Easemob.im.config.https,url:Easemob.im.config.xmppURL});m.listen({onOpened:function(){V();W(m)},onClosed:function(){X();Y()},onTextMessage:function(a){var b=a.from;l(b,b,a.data,a,void 0)},onEmotionMessage:function(a){I(a)},onPictureMessage:function(a){J(a)},onAudioMessage:function(a){},onFileMessage:function(a){},onVideoMessage:function(a){},onError:function(a){if(Easemob.im.config.multiResources&&window.localStorage)try{localStorage.clear()}catch(b){}m.stopHeartBeat(m)}});U()});var V=function(){$.ajax({url:SITE_URL+
"/index.php?app=webim&act=updateLoginStatus&status=1",type:"GET",dataType:"jsonp",success:function(a){}})},X=function(){$.ajax({url:SITE_URL+"/index.php?app=webim&act=updateLoginStatus&status=0",type:"GET",dataType:"jsonp",success:function(a){}})},H=function(a,b,f){$.ajax({url:SITE_URL+"/index.php?app=webim&act=userDetail",type:"GET",dataType:"jsonp",async:f,data:{uid:a,type:b},success:function(c){d.uuid=c.content.uuid;d.uid=c.content.uid;d.username=c.content.username;d.nick=c.content.nick;d.type=
c.content.type;d.avatar=c.content.avatar;d.status=c.content.status;Z(a,b)}})},Z=function(a,b){var f="/index.php?app=webim&act=personInfo",c="",q="";2==b&&(f="/index.php?app=webim&act=storeInfo");$.ajax({url:f,type:"GET",dataType:"json",data:{id:a},success:function(a){a=a.content;"offline"==d.status?(c="\u79bb\u7ebf",$(".state").html('<span class="off"></span>\u5bf9\u65b9\u79bb\u7ebf\uff0c\u60a8\u53ef\u4ee5\u7ed9TA\u7559\u8a00\u6216\u76f4\u63a5\u62e8\u6253\u7535\u8bdd\u8054\u7cfbTA\uff01')):(c="\u5728\u7ebf",
$(".state").html("<span></span>\u5f53\u524d\u7528\u6237\u5904\u4e8e\u5728\u7ebf\u72b6\u6001\uff01"));2==b?(q='<p class="title">'+a.storeName+"\u3010<em>"+c+'</em>\u3011</p>\r\n                                            <a class="href" target="_blank" href="'+a.storeUrl+'">'+a.storeUrl+"</a>",storemsg_html='<div class="top">\u5e97\u94fa\u4fe1\u606f</div>\r\n                                         <div class="store-msg">\r\n                                             <div class="title clearfix">\r\n                                                 <p class="name">'+
a.storeName+'</p>\r\n                                                 <p class="year">'+a.old+'</p>\r\n                                             </div>\r\n                                             <div class="msg clearfix">\r\n                                                <p class="name">\u6ee1\u610f\u5ea6\uff1a</p>\r\n                                                <p class="text ps">'+a.satisfaction+'%</p>\r\n                                             </div>\r\n                                             <div class="msg clearfix">\r\n                                                 <p class="name">\u8054\u7cfb\u59d3\u540d\uff1a</p>\r\n                                                <p class="text">'+
a.contactName+'</p>\r\n                                             </div>\r\n                                             <div class="msg clearfix">\r\n                                                <p class="name">\u8054\u7cfb\u65b9\u5f0f\uff1a</p>\r\n                                                <div class="text">\r\n                                                    <p>'+a.mobile+"</p>\r\n                                                    <p>"+a.tel+'</p>\r\n                                                </div>\r\n                                             </div>\r\n                                             <div class="msg clearfix">\r\n                                                 <p class="name">\u6240\u5728\u5730\u533a\uff1a</p>\r\n                                                <p class="text">'+
a.address+"</p>\r\n                                             </div>\r\n                                         </div>"):(q='<p class="title">'+d.nick+"\u3010<em>"+c+"</em>\u3011</p>",storemsg_html='<div class="top person">\u5ba2\u6237\u4fe1\u606f</div>\r\n                                         <div class="store-msg">\r\n                                             <div class="msg clearfix">\r\n                                                <p class="name">\u7528\u6237\u540d\uff1a</p>\r\n                                                <p class="text ps">'+
a.userName+'</p>\r\n                                             </div>\r\n                                             <div class="msg clearfix">\r\n                                                 <p class="name">\u4e70\u5bb6\u6635\u79f0\uff1a</p>\r\n                                                <p class="text">'+a.nickName+'</p>\r\n                                             </div>\r\n                                             <div class="msg clearfix">\r\n                                                 <p class="name">\u6240\u5728\u5730\u533a\uff1a</p>\r\n                                                <p class="text">'+
a.address+"</p>\r\n                                             </div>\r\n                                         </div>");$(".storeTitle").html(q);$(".rightcontact").html(storemsg_html)}})},r={},G=function(a,b,f,c){var q="";$("#J_moreHistory span").text("\u6b63\u5728\u52a0\u8f7d\u4e2d...");A=!1;$.ajax({url:"/index.php?app=webim&act=historyMessage",type:"GET",dataType:"json",data:{uid:a,type:b,timestamp:f,limit:10},success:function(g){$.each(g.content,function(g,f){if(""==B||f.msg_id<B){if("txt"==
f.payload.bodies[0].type)var d=Easemob.im.Utils.parseLink(Easemob.im.Utils.parseEmotions(F(f.payload.bodies[0].msg)));else"img"==f.payload.bodies[0].type?d={data:[{type:"pic",filename:f.payload.bodies[0].filename,data:{src:f.payload.bodies[0].url}}]}:"file"==f.payload.bodies[0].type&&(d={data:[{type:"file",data:"\u6536\u5230\u6587\u4ef6\u6d88\u606f:"+f.payload.bodies[0].filename,url:f.payload.bodies[0].url}]});q+=l(f.from,c,d,f.payload,"history").outerHTML;0==g&&(r[a+"_"+b]=f.timestamp)}});$("#J_moreHistory span").text("\u67e5\u770b\u66f4\u591a\u6d88\u606f");
var d=document.getElementById(h+"-"+c);$(d).prepend(q);A=!0;0==g.content.length&&-1==f&&(r[a+"_"+b]=+new Date)},error:function(){$("#J_moreHistory span").text("\u4fe1\u606f\u52a0\u8f7d\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5")}})},W=function(a){h=a.context.userId;a.getRoster({success:function(b){b={ext:{uuid:d.uuid,uid:d.uid,nick:d.nick,type:d.type,avatar:d.avatar,role:d.type}};k&&!p[k]&&(p[k]={msg_id:[],extobj:b},x[h]=JSON.stringify(p));p&&$.each(p,function(a,b){K(a,"",b.extobj);b.msg_id&&$.each(b.msg_id,
function(a,b){if(b.data)if("string"==typeof b.data){var c=b.from;l(c,c,b.data,b,"unread")}else I(b,"unread");else 0==b.height?J(b,"unread"):aa(b,"unread")})});null!=k&&ba(k);a.setPresence()}});a.isOpened()&&a.heartBeat(a)},Y=function(){$("body").one("click",function(a){localStorage.getItem(h)&&(p=JSON.parse(localStorage.getItem(h)));$("#momogrouplistUL").html("");$(".all-list em").text("0");t=0;r={};$("#J_service_news").removeClass("service_news");$("#chat01 .chat01_content").remove();m.open({apiUrl:Easemob.im.config.apiURL,
user:window.user.username,accessToken:window.user.token,appKey:Easemob.im.config.appkey})})};Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b].name==a.name)return b;return-1};Array.prototype.remove=function(a){a=this.indexOf(a);-1<a&&this.splice(a,1)};var ba=function(a){D(a);null==k&&$("#null-nouser").css({display:"none"});k=a},L=function(a){a=h+"-"+a;var b=document.createElement("div");$(b).attr({id:a,"class":"chat01_content",className:"chat01_content",style:"display:none"});
return b},D=function(a){var b=document.getElementById(h+"-"+a);null==b&&(b=L(a),0<location.href.indexOf("app=webim")&&document.getElementById("chat01").appendChild(b));b.style.display="block";b=document.getElementById(a);null!=b&&(b.style.backgroundColor="#2e2e2e",0<=a.indexOf("groupchat")?($(b).attr("displayname"),n=$(b).attr("roomid"),$("#roomMemberImg").css("display","block")):0<=a.indexOf("chatroom")?($(b).attr("displayname"),n=$(b).attr("roomid"),$("#roomMemberImg").css("display","block")):$("#roomMemberImg").css("display",
"none"),0<location.href.indexOf("app=webim")&&(r[d.uid+"_"+d.type]||G(d.uid,d.type,-1,a),d.username=a,""!=p[a].msg_id&&(B=p[a].msg_id[0].id),p[a].msg_id=[],x[h]=JSON.stringify(p)))},E=!1,M=!0,T=function(){if(E)N(),E=!1;else{E=!0;var a=Easemob.im.EMOTIONS,b=a.map,a=a.path;if(M){for(var f in b){var c=$("<img>").attr({id:f,src:a+b[f],style:"cursor:pointer;"}).click(function(){var a=document.getElementById("talkInputId"),b=a.value;if(a.setSelectionRange){var c=a.selectionEnd;a.value=b.substring(0,a.selectionStart)+
this.id+b.substring(c,b.length)}else document.selection?(a.focus(),a=document.selection.createRange(),a.text=this.id,a.setEndPoint("StartToEnd",a),a.select()):a.value+=this.id});$("<li>").append(c).appendTo($("#emotionUL"))}M=!1}$(".chat02-title .one").addClass("active");$("#wl_faces_box").css({display:"block"})}},N=function(){$("#wl_faces_box").fadeOut("slow");$(".chat02-title .one").removeClass("active")},C=function(){if(!s){s=!0;var a=document.getElementById("talkInputId"),b=a.value;if(null==b||
0==b.length)s=!1;else{var f=k;if(null==f)s=!1;else{var c={to:f,msg:b,type:"chat",ext:y};0<=k.indexOf("groupchat")?(c.type="groupchat",c.to=n):0<=k.indexOf("chatroom")&&(c.type="groupchat",c.roomType="chatroom",c.to=n);m.sendTextMessage(c);b=Easemob.im.Utils.parseLink(Easemob.im.Utils.parseEmotions(F(b)));l(h,f,b);N();a.value="";a.focus();setTimeout(function(){s=!1},1E3)}}}},ca={jpg:!0,gif:!0,png:!0,bmp:!0};$("#fileInput").on("change",function(){switch(this.getAttribute("data-type")){case "img":da();
break;case "audio":ea();break;default:fa()}});var da=function(){var a=k;if(null!=a){var b=Easemob.im.Helper.getFileUrl("fileInput");if(!Easemob.im.Helper.isCanUploadFileAsync||null!=b.url&&""!=b.url){var f=b.filetype,c=b.filename;!Easemob.im.Helper.isCanUploadFileAsync||f in ca?(b={type:"chat",fileInputId:"fileInput",filename:c,to:a,apiUrl:Easemob.im.config.apiURL,onFileUploadError:function(b){l(h,a,(b.msg||"")+",\u53d1\u9001\u56fe\u7247\u6587\u4ef6\u5931\u8d25:"+(c||""))},onFileUploadComplete:function(b){var f=
document.getElementById("fileInput");if(Easemob.im.Helper.isCanUploadFileAsync&&f&&f.files){if(b=O(f.files[0])){var d=document.createElement("img");d.src=b;d.width=200}}else c=b.filename||"",d=document.createElement("img"),d.src=b.uri+"/"+b.entities[0].uuid,d.width=200;l(h,a,{data:[{type:"pic",filename:c,data:d}]})},flashUpload:R,ext:y},0<=k.indexOf("groupchat")?(b.type="groupchat",b.to=n):0<=k.indexOf("chatroom")&&(b.type="groupchat",b.roomType="chatroom",b.to=n),m.sendPicture(b)):alert("\u4e0d\u652f\u6301\u6b64\u56fe\u7247\u7c7b\u578b"+
f)}else alert("\u8bf7\u5148\u9009\u62e9\u56fe\u7247")}},ga={mp3:!0,wma:!0,wav:!0,amr:!0,avi:!0},ea=function(){var a=k;if(null!=a){var b=Easemob.im.Helper.getFileUrl("fileInput");if(!Easemob.im.Helper.isCanUploadFileAsync||null!=b.url&&""!=b.url){var f=b.filetype,c=b.filename;!Easemob.im.Helper.isCanUploadFileAsync||f in ga?(b={type:"chat",fileInputId:"fileInput",filename:c,to:a,apiUrl:Easemob.im.config.apiURL,onFileUploadError:function(b){l(h,a,(b.msg||"")+",\u53d1\u9001\u97f3\u9891\u5931\u8d25:"+
(c||""))},onFileUploadComplete:function(b){var f=document.getElementById("fileInput"),d=document.createElement("audio");d.controls=!0;Easemob.im.Helper.isCanUploadFileAsync&&f&&f.files?(b=O(f.files[0]))&&d.setAttribute("src",b):d.setAttribute("src",b.uri+"/"+b.entities[0].uuid);l(h,a,{data:[{type:"audio",filename:c,data:d,audioShim:!window.Audio}]})},flashUpload:flashAudioUpload,ext:y},0<=k.indexOf("groupchat")?(b.type="groupchat",b.to=n):0<=k.indexOf("chatroom")&&(b.type="groupchat",b.roomType="chatroom",
b.to=n),m.sendAudio(b)):alert("\u4e0d\u652f\u6301\u6b64\u97f3\u9891\u7c7b\u578b"+f)}else alert("\u8bf7\u5148\u9009\u62e9\u97f3\u9891")}},ha={mp3:!0,wma:!0,wav:!0,amr:!0,avi:!0,jpg:!0,gif:!0,png:!0,bmp:!0,zip:!0,rar:!0,doc:!0,docx:!0,pdf:!0},fa=function(){var a=k;if(null!=a){var b=Easemob.im.Helper.getFileUrl("fileInput");if(!Easemob.im.Helper.isCanUploadFileAsync||null!=b.url&&""!=b.url){var f=b.filetype,c=b.filename;!Easemob.im.Helper.isCanUploadFileAsync||f in ha?(b={type:"chat",fileInputId:"fileInput",
filename:c||"",to:a,apiUrl:Easemob.im.config.apiURL,onFileUploadError:function(b){l(h,a,(b.msg||"")+",\u53d1\u9001\u6587\u4ef6\u5931\u8d25:"+(c||""))},onFileUploadComplete:function(b){var c="\u53d1\u9001\u6210\u529f"+b.filename;void 0==b.filename&&(c="\u53d1\u9001\u6210\u529f");l(h,a,c)},flashUpload:S,ext:y},0<=k.indexOf("groupchat")?(b.type="groupchat",b.to=n):0<=k.indexOf("chatroom")&&(b.type="groupchat",b.roomType="chatroom",b.to=n),m.sendFile(b)):alert("\u4e0d\u652f\u6301\u6b64\u6587\u4ef6\u7c7b\u578b"+
f)}else alert("\u8bf7\u9009\u62e9\u53d1\u9001\u97f3\u9891")}},I=function(a,b){var f=a.from,c=a.type;"groupchat"==c||"chatroom"==c?l(a.from,c+a.to,a,a):l(f,f,a,a,b)},J=function(a,b){var f=a.filename,c=a.from,d=a.type,g=c;if("groupchat"==d||"chatroom"==d)g=d+a.to;d=document.createElement("img");d.src=a.url;l(c,g,{data:[{type:"pic",filename:f||"",data:d}]},a,b)},aa=function(a,b){var f=a.filename,c=a.from,d=a.type,g=c;if("groupchat"==d||"chatroom"==d)g=d+a.to;a.onFileDownloadComplete=function(d,q){l(c,
g,{data:[{type:"file",data:"\u6536\u5230\u6587\u4ef6\u6d88\u606f:"+f,url:a.url}]},a,b)};a.onFileDownloadError=function(b){l(c,g,b.msg+",\u4e0b\u8f7d\u6587\u4ef6"+f+"\u5931\u8d25",a)};Easemob.im.Helper.download(a)},K=function(a,b,f){b=document.getElementById("momogrouplistUL");var c={};a in c||a==window.user.username||(c[a]=!0,c=document.createElement("li"),$(c).attr({id:a,type:"chat",displayName:a,uid_type:f.ext.type||f.ext.role,uid:f.ext.uid||f.ext.user_id}),c.onclick=function(){if(A){var a=this.id;
d.type=$(this).attr("uid_type");d.uid=$(this).attr("uid");if(a!=k&&0<location.href.indexOf("app=webim")){if(null==k)D(a);else{D(a);var b=k,c=document.getElementById(b);c&&(c.style.backgroundColor="");if(b=document.getElementById(h+"-"+b))b.style.display="none"}H(d.uid,d.type,!0);k=a}$("#null-nouser").css({display:"none"});(a=$(this).children(".badge"))&&0<a.length&&(a=a.text(),this.removeChild(this.children[1]),t-=a);$(".all-list em").text(t);"0"==t&&$("#J_service_news").removeClass("service_news");
0>location.href.indexOf("app=webim")&&window.open(SITE_URL+"/index.php?app=webim&type="+d.type+"&storeid="+d.uid+"");(a=$(this).parent().parent().parent().parent().find(".badge"))&&0==a.length&&$(this).parent().parent().parent().parent().prev().children().children().children().remove()}},a=document.createElement("span"),a.innerHTML=f.ext.nick,c.appendChild(a),b.appendChild(c))},l=function(a,b,f,c,d){document.getElementById("contactlistUL");var g=document.getElementById(b);null!=g||void 0==c||1!=c.ext.type&&
2!=c.ext.type&&1!=c.ext.role&&2!=c.ext.role||(K(a,f,c),p[a]={msg_id:[],extobj:c},x[h]=JSON.stringify(p));if(0<location.href.indexOf("app=webim")){g=null;"string"==typeof f?(g=Easemob.im.Helper.parseTextMessage(f),g=g.body):g=f.data;var l;h==a?(f=window.user.nick,l=window.user.avatar):(f=c.ext.nick,l=c.ext.avatar);var m=$(""+("<img class='img' src="+l+">"));l=document.createElement("div");for(var n=0;n<m.length;n++)l.appendChild(m[n]);m="";for(n=0;n<g.length;n++){var r=g[n],u=r.type,v=r.data;if("emotion"==
u)m+="<img src='"+v+"'/>";else if("pic"==u||"audio"==u||"video"==u){if(m="<a target='_blank' href='"+v.src+"'><img src="+v.src+" style='max-width:400px;'></a>","audio"==u&&r.audioShim){var s=$(l),w=(new Date).getTime();s.append($('<div class="'+w+'"></div>\r\n                                <button class="play'+w+'">\u64ad\u653e</button><button style="display:none" class="play'+w+'">\u6682\u505c</button>'))}}else m="file"==u?"<a target='_blank' href='"+r.url+"' title='\u70b9\u51fb\u4e0b\u8f7d'>"+
v+"</a>":m+v}l.appendChild($("<div class='msg'>\r\n                        <p>"+f+"</p>\r\n                        <div class='message clearfix'><span></span>"+m+"</div>\r\n                      </div>")[0])}null==k&&(k="");if(0>k.indexOf(b)){g=document.getElementById(b);if(null==g)return;g.style.backgroundColor="#393939";(f=$(g).children(".badge"))&&0<f.length?(g=f.text(),g=new Number(g),g++,f.text(g)):$(g).append('<span class="badge">1</span>');t++;$(".all-list em").text(t);$("#J_service_news").addClass("service_news");
"unread"!=d&&(f=[],p[b]?p[b].msg_id.push(c):(f.push(c),p[b]={msg_id:f,extobj:c}),x[h]=JSON.stringify(p))}else void 0!=c&&($(".storeTitle em").text("\u5728\u7ebf"),$(".state").html("<span></span>\u5f53\u524d\u7528\u6237\u5904\u4e8e\u5728\u7ebf\u72b6\u6001\uff01"));if(0<location.href.indexOf("app=webim"))return c=document.getElementById(h+"-"+b),h==a?l.setAttribute("class","my"):l.setAttribute("class","opposite"),a=!1,null==c&&(c=L(b),a=!0),"history"!=d&&(c.appendChild(l),a&&document.getElementById("chat01").appendChild(c)),
"audio"==u&&r.audioShim&&setTimeout(function(){Q(s.find("."+w),v.currentSrc,w)},0),"history"!=d&&(document.getElementById("chat01").scrollTop=document.getElementById("chat01").scrollHeight),l},O=function(a){var b=null;void 0!=window.createObjectURL?b=window.createObjectURL(a):void 0!=window.URL?b=window.URL.createObjectURL(a):void 0!=window.webkitURL&&(b=window.webkitURL.createObjectURL(a));return b};Easemob.im.EMOTIONS={path:STATIC_URL+"/themes/webim/static/img/faces/",map:{"[):]":"ee_1.png","[:D]":"ee_2.png",
"[;)]":"ee_3.png","[:-o]":"ee_4.png","[:p]":"ee_5.png","[(H)]":"ee_6.png","[:@]":"ee_7.png","[:s]":"ee_8.png","[:$]":"ee_9.png","[:(]":"ee_10.png","[:'(]":"ee_11.png","[:|]":"ee_12.png","[(a)]":"ee_13.png","[8o|]":"ee_14.png","[8-|]":"ee_15.png","[+o(]":"ee_16.png","[<o)]":"ee_17.png","[|-)]":"ee_18.png","[*-)]":"ee_19.png","[:-#]":"ee_20.png","[:-*]":"ee_21.png","[^o)]":"ee_22.png","[8-)]":"ee_23.png","[(|)]":"ee_24.png","[(u)]":"ee_25.png","[(S)]":"ee_26.png","[(*)]":"ee_27.png","[(#)]":"ee_28.png",
"[(R)]":"ee_29.png","[({)]":"ee_30.png","[(})]":"ee_31.png","[(k)]":"ee_32.png","[(F)]":"ee_33.png","[(W)]":"ee_34.png","[(D)]":"ee_35.png"}};if(0<location.href.indexOf("app=webim")){if("function"!==typeof P)var P=function(a){var b=window.location.origin,f=SITE_URL;b||(b="");0<b.indexOf("//www.eelly")&&(f="");if(""==a)return f;0!=a.indexOf("http")&&(a=f+a);return a};var ia=P("");$(function(){var a=document.location.href,b="act=login app=free_ticket act=advantage app=cashier app=store_decoration act=add_step4 app=datapacket act=register".split(" "),
f=!1;({show:function(){setTimeout(function(){$("#J_sidebar").show().animate({right:-280},200)},2E3)},requestSidebar:function(){var a=this;$.ajax({url:ia+"/index.php?app=navigation&act=sidebar&webim=1",dataType:"jsonp",cache:!0,success:function(b){function f(){d=$(".service_icon_father").offset().top;0>=d?setTimeout(function(){f()},1E3):$("#J_service_icon").css("top",d).hover(function(){$(".service_icon_father").addClass("active")},function(){$(".service_icon_father").removeClass("active")})}$.appendScriptReWrite(b.retval);
a.show();$(".e-accordion-inner").remove();var d=$(".service_icon_father").offset().top;f()}})},init:function(){for(var c=this,d=0,g=b.length;d<g&&(f=-1!=a.indexOf(b[d])?!1:!0,f);d++);f&&setTimeout(function(){c.requestSidebar()},3E3)}}).init()})}};0<location.href.indexOf("app=webim")?z():(window.user={},$.ajax({url:SITE_URL+"/index.php?app=webim&act=userDetail",type:"GET",dataType:"jsonp",success:function(h){200==h.code&&(window.user={uuid:h.content.uuid,uid:h.content.uid,type:h.content.type,avatar:h.content.avatar,
nick:h.content.nick,status:h.content.status,username:h.content.username,token:h.content.token},z())}}))});

/* resmerge themes/webim/static/js/webim.js end */
